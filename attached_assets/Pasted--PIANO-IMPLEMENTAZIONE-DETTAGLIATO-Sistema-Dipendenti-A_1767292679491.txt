üìã PIANO IMPLEMENTAZIONE DETTAGLIATO
Sistema "Dipendenti AI" con Licenze e Pagamenti
üî∑ FASE 1: DATABASE & FONDAMENTA
Obiettivo: Creare la struttura dati per supportare il sistema di livelli e licenze

1.1 Schema Agenti
Aggiungere campo level (nullable: "1" | "2" | null) a consultantWhatsappConfig
Aggiungere campo publicSlug (unique) per link pubblici Level 1
Aggiungere campo dailyMessageLimit (default 15) per Level 1
1.2 Tabella Licenze Consulente
Creare consultant_licenses:
consultantId (FK)
level2Total (default 20)
level2Used (default 0)
level3Total (default 10)
level3Used (default 0)
stripeCustomerId (per acquisti extra)
1.3 Tabella Abbonamenti Clienti
Creare client_level_subscriptions:
clientId (FK)
consultantId (FK)
level ("2" | "3")
stripeSubscriptionId
status (active, canceled, expired)
startDate, endDate
1.4 Schema Super Admin Licenze
Aggiungere a superadmin_settings:
platformStripeSecretKey
platformStripeWebhookSecret
licensePackagePriceL2 (es: ‚Ç¨99 per 10 licenze)
licensePackagePriceL3 (es: ‚Ç¨149 per 5 licenze)
1.5 Schema Stripe Consulente
Aggiungere a tabella consulente o nuova tabella:
consultantStripeSecretKey
consultantStripeWebhookSecret
priceLevel2 (prezzo mensile L2)
priceLevel3 (prezzo mensile L3)
üî∑ FASE 2: REBRANDING UI
Obiettivo: Aggiornare l'interfaccia con il nuovo branding "Dipendenti AI"

2.1 Componente LevelBadge
Creare client/src/components/whatsapp/LevelBadge.tsx
Varianti: Level 1 (ü•â bronzo), Level 2 (ü•à argento), null (nessun badge)
Stili: compact (per roster), large (per profilo)
2.2 Rebranding Testi
Header pagina: "Gestione Agenti WhatsApp" ‚Üí "ü§ñ Dipendenti AI"
Sidebar: aggiornare icona (gi√† dice "I tuoi dipendenti")
Tutti i riferimenti sparsi nel codice
2.3 AgentRoster con Livelli
Mostrare badge livello nella card agente
Indicatore accesso: "üåê Pubblico" per L1, "üîê Client" per L2
2.4 AgentProfilePanel con Livelli
Badge livello grande nel header profilo
Sezione "Condividi" con link appropriato per livello
Per L1: mostrare link pubblico + limite messaggi
üî∑ FASE 3: TAB LICENZE CONSULENTE
Obiettivo: Dashboard per gestire licenze e clienti con abbonamento

3.1 Nuova Tab "Licenze"
Aggiungere tab in /consultant/whatsapp
Layout: Dashboard + Lista Clienti
3.2 Dashboard Licenze
Progress bar licenze L2 (usate/totali)
Progress bar licenze L3 (usate/totali)
Alert se licenze in esaurimento
3.3 Bottone Acquisto Licenze
"Compra altre licenze" ‚Üí Stripe checkout
Modale con pacchetti disponibili
3.4 Lista Clienti con Licenza
Tabella: Nome, Livello, Data Attivazione, Stato, Azioni
Filtri per livello e stato
Azioni: Revoca, Upgrade, Rinnova
3.5 Sezione Link Pricing
Mostrare URL pagina pricing personalizzata
Bottone copia link
Bottone "Personalizza Pagina"
üî∑ FASE 4: WIZARD CREAZIONE AGENTE
Obiettivo: Permettere selezione livello durante creazione agente

4.1 Step Selezione Livello
Opzione "Nessun livello" (default)
Opzione "Level 1 - Pubblico"
Opzione "Level 2 - Knowledge Base"
Spiegazione differenze
4.2 Configurazione Level 1
Campo: slug pubblico (es: "silvia")
Campo: limite messaggi giornaliero (default 15)
Preview link: orbitale.it/ai/silvia
4.3 Configurazione Level 2
Selezione categorie Knowledge Base
Configurazione booking
Spiegazione: "Richiede abbonamento client"
üî∑ FASE 5: PAGINA PRICING PUBBLICA
Obiettivo: Pagina per clienti per scegliere e acquistare pacchetto

5.1 Route e Layout
Nuova pagina: /c/:consultantSlug/pricing
Design: 3 card affiancate (L1, L2, L3)
Responsive per mobile
5.2 Card Level 1 (Free)
Titolo, descrizione, features
Bottone "Inizia Gratis"
Redirect a /ai/:agentSlug
5.3 Card Level 2 (Paid)
Titolo, prezzo mensile, features
Bottone "Abbonati" ‚Üí Stripe Checkout
Badge "Pi√π Popolare"
5.4 Card Level 3 / Deluxe (Paid)
Titolo, prezzo mensile, features
Bottone "Abbonati" ‚Üí Stripe Checkout
Badge "Accesso Completo"
5.5 Personalizzazione Consulente
Pagina settings per personalizzare:
Colori tema
Logo
Descrizioni pacchetti
Prezzi (da Stripe products)
üî∑ FASE 6: INTEGRAZIONE STRIPE
Obiettivo: Gestire pagamenti clienti e acquisto licenze

6.1 Setup Stripe Consulente
Pagina settings per inserire Stripe keys
Creazione Products/Prices per L2 e L3
Webhook per gestire subscription events
6.2 Checkout Clienti
API /api/stripe/create-checkout-session
Parametri: consultantId, clientEmail, level
Success/Cancel URLs
6.3 Webhook Clienti
customer.subscription.created ‚Üí attiva licenza
customer.subscription.deleted ‚Üí revoca accesso
invoice.payment_failed ‚Üí notifica consulente
6.4 Setup Stripe Piattaforma (Super Admin)
Pagina per inserire Stripe keys piattaforma
Products per pacchetti licenze extra
6.5 Acquisto Licenze Consulenti
Checkout per comprare pacchetti licenze
Webhook: incrementa licenze disponibili
üî∑ FASE 7: SUPER ADMIN
Obiettivo: Gestione centralizzata licenze e Stripe

7.1 Sezione Licenze Consulenti
Lista tutti i consulenti con licenze
Colonne: Nome, L2 Tot/Usate, L3 Tot/Usate
Azioni: Modifica, Aggiungi Licenze Gratis
7.2 Modifica Licenze
Modal per modificare totali L2/L3 per consulente
Log delle modifiche
7.3 Configurazione Stripe Piattaforma
Form per Secret Key e Webhook Secret
Test connessione
Gestione Products/Prices
7.4 Impostazioni Prezzi
Prezzo pacchetto 10 licenze L2
Prezzo pacchetto 5 licenze L3
Sconti volume (opzionale)
üî∑ FASE 8: CHAT PUBBLICA LEVEL 1
Obiettivo: Pagina chat accessibile senza login per Level 1

8.1 Route Pubblica
Pagina: /ai/:slug
No autenticazione richiesta
Carica config agente da slug
8.2 UI Chat
Header con nome agente e branding consulente
Area messaggi
Input messaggio
Design pulito e professionale
8.3 Limite Messaggi
Contatore messaggi rimanenti
Storage locale per tracciare uso giornaliero
Messaggio quando limite raggiunto
CTA: "Sblocca messaggi illimitati ‚Üí Upgrade"
8.4 Backend API
/api/public/ai/:slug/info - info agente
/api/public/ai/:slug/chat - invio messaggio
Rate limiting per IP
Validazione limite giornaliero