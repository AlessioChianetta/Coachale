tatus: waiting_approval).
ğŸ§  [AUTONOMOUS-GEN] [Personalizza] Frequency not reached (30min configured, last run 27min ago, next in ~3min), skipping
ğŸ§  [AUTONOMOUS-GEN] Total: 0 tasks  created across 8 roles for consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b
ğŸ§  [AUTONOMOUS-GEN] Completed. Total tasks generated: 0
ğŸ”“ [CronLock] Released lock for "ai-autonomous-generation"
âœ… [TokenTracker] Flushed 1 entries to DB
ğŸ”Œ [GEMINI TRACKER] ACTIVE GEMINI STREAMS: 0
2:00:46 PM [express] GET /api/user/profile 200 in 33ms
2:00:47 PM [express] GET /api/auth/my-profiles 304 in 407ms :: {"profiles":[{"id":"fd732f27-d63b-4e8â€¦
2:00:47 PM [express] GET /api/ai-assistant/preferences 200 in 412ms :: {"writingStyle":"eccentric","â€¦
2:00:47 PM [express] GET /api/consultant/ai/daily-summaries 200 in 504ms :: {"dailySummaries":[{"id"â€¦
2:00:47 PM [express] GET /api/ai-assistant/consultant/agents-for-assistant 304 in 317ms :: []
2:00:48 PM [express] GET /api/ai/active-provider 304 in 1165ms :: {"provider":"Google AI Studio","soâ€¦
2:00:48 PM [express] GET /api/consultant/ai/conversations 200 in 1202ms :: [{"id":"d83b270e-d499-496â€¦
ğŸš€ [API] /api/consultant/ai/chat received - isOnboardingMode: undefined, hasOnboardingStatuses: false
ğŸ“ [User Preferences] Applying preferences - Style: eccentric, Length: comprehensive
ğŸ§  [Memory Context] Daily summaries: 10 days, 8034 chars, ~2009 tokens
ğŸ§  [Conversation Memory] Loaded daily summaries: 20 conversations across multiple days
ğŸ§  [Conversation Memory] Loaded 5 recent detailed conversations

======================================================================
ğŸ§‘â€ğŸ’¼ CONSULTANT AI ASSISTANT - New Chat Message
======================================================================
Consultant ID: 0c73bbe5-51e1-4108-866b-6be7a52fce3b
Message: mi spieghi tutto a 360 gradi
======================================================================

ğŸ§¹ Cache cleanup: removed 1 expired entries

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” FILE SEARCH MODE: Switching to Google AI Studio (required for File Search)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“¦ Provider: Google AI Studio (@google/genai)
   âœ… File Search API: SUPPORTED
   âš ï¸  Vertex AI: NOT compatible with File Search
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Using SuperAdmin Gemini key for File Search (1/1)
ğŸ” [Intent Detection] Detected intent from message: general
ğŸ”‘ [Cache Key] Using cache key: 0c73bbe5-51e1-4108-866b-6be7a52fce3b-general
ğŸ”„ Building fresh consultant context (intent: general)
ğŸ” [DEBUG] Query flags: {
  shouldLoadClients: true,
  shouldLoadExercises: true,
  shouldLoadClientData: true,
  shouldLoadEmail: true,
  shouldLoadWhatsApp: true,
  shouldLoadCalendar: true,
  shouldLoadConsultations: true,
  shouldLoadEmailDetailed: false,
  shouldLoadWhatsAppDetailed: true,
  shouldLoadAIAgents: false,
  shouldLoadLeads: true,
  shouldLoadCampaigns: true,
  shouldLoadApiSettings: true,
  shouldLoadWhatsAppConfig: true
}
ğŸ” [Q1] Fetching consultant info...
ğŸ” [Q2] Fetching all clients...
ğŸ” [Q3] Fetching pending exercise reviews...
ğŸ” [Q4] Fetching recently created exercises...
ğŸ” [Q5] Fetching exercise stats...
ğŸ” [Q6] Fetching email drafts...
ğŸ” [Q7] Fetching scheduler logs...
ğŸ” [Q8] Fetching WhatsApp leads...
ğŸ” [Q9] Fetching WhatsApp conversations...
ğŸ” [Q10] Fetching upcoming appointments...
ğŸ” [Q11] Fetching today appointments...
ğŸ” [Q12] Fetching all consultations...
ğŸ” [Q13] Fetching consultation tasks...
ğŸ” [Q13a] Fetching client goals...
ğŸ” [Q13b] Fetching client state tracking data (latest per client)...
ğŸ” [Q14] Fetching SMTP settings...
ğŸ” [Q15] Fetching email journey templates...
ğŸ” [Q16] Fetching WhatsApp custom templates...
ğŸ” [Q17] Fetching library documents...
ğŸ” [Q18] Fetching exercise feedback...
ğŸ” [Q19] Fetching university year assignments with detailed structure...
ğŸ” [Q20] Fetching exercise templates...
ğŸ” [Q21] Fetching university templates...
ğŸ” [Q27] Fetching detailed WhatsApp conversations (last 24h)...
ğŸ” [Q28] Fetching recent WhatsApp messages (last 24h)...
ğŸ” [Q29] Fetching WhatsApp agent configs...
ğŸ” [Q40] Fetching proactive leads (last 24h)...
ğŸ” [Q41] Fetching lead stats by status...
ğŸ” [Q42] Fetching lead stats by category...
ğŸ” [Q43] Fetching lead stats by campaign...
ğŸ” [Q44] Fetching marketing campaigns with agent names...
ğŸ” [Q44] Building query with leftJoin...
ğŸ” [Q45] Fetching campaign analytics (last 30 days)...
ğŸ” [Q46] Fetching external API configs...
ğŸ” [Q46] Building query with leftJoin...
ğŸ” [Q47] Fetching external lead import logs (last 30 days)...
ğŸ” [Q48] Fetching WhatsApp/Twilio configuration (FULL)...
ğŸ” [Q49] Fetching WhatsApp custom templates with versions...
ğŸ” [Q50] Fetching WhatsApp template assignments...
ğŸ” [Q51] Fetching Twilio WhatsApp templates from Content API...
ğŸ” [Q52] Fetching calendar settings...
âœ… [Q1] Consultant info fetched
âœ… [Q5] Exercise stats fetched
âœ… [Q4] Recently created exercises fetched: 50
âœ… [Q2] All clients fetched: 29
âœ… [Q3] Pending exercise reviews fetched: 37
âœ… [Q21] University templates fetched: 4
âœ… [Q27] Detailed WhatsApp conversations fetched (24h): 2
âœ… [Q28] Recent WhatsApp messages fetched (24h): 16
âœ… [Q29] WhatsApp agent configs fetched: 5
âœ… [Q19] University year assignments raw data fetched: 1128 rows
âœ… [Q40] Proactive leads fetched (24h): 0
âœ… [Q41] Lead stats by status fetched: 2 statuses
âœ… [Q42] Lead stats by category fetched: 4 categories
âœ… [Q43] Lead stats by campaign fetched: 3 campaigns
âœ… [Q20] Exercise templates fetched: 84
âœ… [Q44] Marketing campaigns fetched: 3
âœ… [Q46] External API configs fetched: 1
âœ… [Q47] External lead import logs fetched: 0
âœ… [Q48] WhatsApp/Twilio configuration (FULL) fetched: 1 record(s)
âœ… [Q45] Campaign analytics fetched: 0 records
âœ… [Q50] WhatsApp template assignments fetched: 0
âœ… [Q52] Calendar settings fetched: Found
âœ… [Q9] WhatsApp conversations fetched: 20
âœ… [Q8] WhatsApp leads fetched: 8
âœ… [Q11] Today appointments fetched: 0
âœ… [Q10] Upcoming appointments fetched: 0
âœ… [Q16] WhatsApp custom templates fetched: 50
âœ… [Q13] Consultation tasks fetched: 29
âœ… [Q18] Exercise feedback fetched: 10
âœ… [Q49] WhatsApp custom templates fetched: 65
âœ… [Q12] All consultations fetched: 30
âœ… [Q17] Library documents fetched: 20
âœ… [Q13b] Client state tracking fetched (unique clients): 26
âœ… [Q15] Email journey templates fetched: 31
âœ… [Q14] SMTP settings fetched: 1
âœ… [Q13a] Client goals fetched: 0
âœ… [Q7] Scheduler logs fetched: 1
âœ… [Q6] Email drafts fetched: 1188
âœ… [Q51] Twilio WhatsApp templates fetched: 27 from 5 agent(s)
ğŸ“§ [EMAIL MAPPING] Created email mapping for 88 consultations
ğŸ” [WhatsApp Config] Populated with masked credentials (Account SID: NULL, Auth Token: NULL)
ğŸ“š [Knowledge Base] Loading ALL knowledge content for consultant (no filtering)...
[PUBLER POLLING] Running scheduled post status sync...
ğŸ“š [Knowledge Base] Loaded 4 documents and 0 APIs for consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b
âœ… [Knowledge Base] Loaded ALL content: 4 documents, 0 API sources

ğŸ“Š Token Usage Breakdown (Intent: general):
   Dashboard: 27 tokens
   Clients (29 clients): 2,305 tokens
   Exercises: 4,323 tokens
   Email Marketing: 590 tokens
   WhatsApp Leads: 1,059 tokens
   Calendar: 627 tokens
   Consultations: 490 tokens
   Consultation Tasks: 1,019 tokens
   Client Goals: 19 tokens
   Client States (26 states): 7,971 tokens
   SMTP Configuration: 0 tokens
   Email Templates: 0 tokens
   WhatsApp Templates: 0 tokens
   Library Documents: 0 tokens
   Exercise Feedback: 2,795 tokens
   University: 43,945 tokens
   Exercise Templates: 13,460 tokens
   ğŸ’¬ WhatsApp (Detailed): 2,275 tokens
   ğŸ¯ Lead Management: 167 tokens
   ğŸ“Š Campaign Marketing: 581 tokens
   ğŸ”Œ API Settings: 189 tokens
   ğŸ“± WhatsApp Config: 244 tokens
   ğŸ“ WhatsApp Templates (Detailed): 7,816 tokens
   ğŸ”— WhatsApp Template Assignments: 1 tokens
   ğŸ“² Twilio WhatsApp Templates: 4,781 tokens
   ğŸ“… Calendar Settings: 184 tokens
   ğŸ“š Knowledge Base: 25,929 tokens
   Base (prompts + metadata): 5,052 tokens
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ¯ TOTAL ESTIMATED: 125,849 tokens

âœ… Built and cached consultant context (intent: general)
â±ï¸  [TIMING] Consultant context building: 2357ms
ğŸ”Œ [GEMINI TRACKER] ACTIVE GEMINI STREAMS: 0
ğŸ§¹ [Consultant Cache] Cleaned up 1 expired entries
[PUBLER SYNC] Synced 2 consultants, updated 0 posts
[PUBLER POLLING] Sync complete: 2 consultants, 0 posts updated
â±ï¸  [TIMING] Consultant prompt building: 14ms

ğŸ“Š Token Usage Estimation:
  - System Prompt: ~103,333 tokens
  - ğŸ§  Conversation Memory: ~2,185 tokens (included in System Prompt)
  - User Message: ~7 tokens
  - Conversation History: ~0 tokens
  - Total Estimated: ~103,340 tokens

âœ… [FileSearch] Store name valid: fileSearchStores/knowledge-base-consulente-juw371zchi3s

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” AI MODE: FILE SEARCH SEMANTIC (Gemini RAG) [CONSULTANT]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“¦ Stores disponibili: 1
      1. fileSearchStores/knowledge-base-consulente-juw371zchi3s

   ğŸ“Š BREAKDOWN DOCUMENTI PER STORE:

   ğŸ‘¤ Knowledge Base Consulente (490 documenti):
      ğŸ“ Lezioni: 217
      ğŸ‹ï¸ Esercizi: 178
      ğŸ“– Libreria: 86
      ğŸ§  Knowledge Base: 4
      ğŸ“„ dynamic_context: 3
      ğŸ“„ system_prompt_document: 1
      ğŸ“„ consultant_guide: 1
   âœ… Tool fileSearch: ATTIVO
   ğŸ“„ Il modello cercherÃ  semanticamente nei documenti indicizzati
   ğŸ“‰ System prompt ridotto grazie a File Search
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[AI] Using model: gemini-3-flash-preview with thinking_level: low [CONSULTANT STREAMING]
[AI] Provider: Google AI Studio, User-selected: YES
ğŸ› ï¸  [TOOLS] Consultant chat: codeExecution=YES, fileSearch=YES
ğŸ”„ AI stream attempt 1/6...
ğŸ”’ [Semaphore] Acquired slot (1/3 in use)
â³ [CronLock] Lock for "ai-task-scheduler" held by another process, skipping...
ğŸ”“ [Semaphore] Released slot (0/3 in use)