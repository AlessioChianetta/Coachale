Sì: l’impostazione del tuo programmatore è giusta come concetto, ma così com’è scritta NON combacia con i nomi delle variabili del tuo bridge (nei file TypeScript che mi hai caricato). Se segui alla lettera le sue variabili (REPLIT_SERVICE_TOKEN, BRIDGE_PORT, REPLIT_WS_URL con /ws/ai-voice) rischi che il bridge non parta o si colleghi all’URL sbagliato.

Qui sotto trovi la versione “copy-paste” corretta per partire subito (produzione), coerente con il tuo codice.

1) Token VPS (ok come ti ha detto lui)

Nell’app su Replit vai su /consultant/voice-calls → Token VPS → Genera Nuovo Token.
Copia il token (valido 30 giorni).

2) .env corretto per il tuo bridge (NOMI GIUSTI)

Nel tuo codice, le variabili attese sono queste:

REPLIT_API_TOKEN (non REPLIT_SERVICE_TOKEN)

WS_PORT (non BRIDGE_PORT)

REPLIT_WS_URL deve essere la base URL (il codice aggiunge già "/ws/ai-voice")

Crea /opt/alessia-voice/.env sulla VPS Hostinger:

# Bridge WS server
WS_HOST=0.0.0.0
WS_PORT=9090
# consigliato in produzione se 9090 non è solo localhost:
WS_AUTH_TOKEN=METTI_UN_TOKEN_LUNGO_RANDOM

# Replit
# IMPORTANTISSIMO: qui NON mettere /ws/ai-voice (lo aggiunge già il codice)
REPLIT_WS_URL=https://TUO-DOMINIO-REPLIT.app
REPLIT_API_TOKEN=IL_TOKEN_VPS_GENERATO
REPLIT_API_URL=https://TUO-DOMINIO-REPLIT.app

# Audio / sessioni
AUDIO_SAMPLE_RATE_IN=8000
AUDIO_SAMPLE_RATE_OUT=8000
SESSION_TIMEOUT_MS=120000
MAX_CONCURRENT_CALLS=10
LOG_LEVEL=info

# Voce
GEMINI_VOICE_ID=Puck


Se metti REPLIT_WS_URL=wss://.../ws/ai-voice come ti ha scritto lui, nel tuo codice diventa .../ws/ai-voice/ws/ai-voice e si rompe.

3) Build + avvio bridge (production)

Nella cartella del progetto:

cd /opt/alessia-voice
npm install
npm run build


Poi avvio con systemd (hai già alessia-voice.service):

cp /opt/alessia-voice/alessia-voice.service /etc/systemd/system/alessia-voice.service
systemctl daemon-reload
systemctl enable --now alessia-voice
systemctl status alessia-voice --no-pager


Log live:

journalctl -u alessia-voice -f


Check che ascolta:

ss -lntp | grep 9090


Health:

curl -s "http://127.0.0.1:9090/health?token=METTI_UN_TOKEN_LUNGO_RANDOM"

4) FreeSWITCH: riga audio_stream (consigliata esplicita)

Nel dialplan usa (come dice il programmatore) i parametri espliciti:

<action application="audio_stream" data="ws://127.0.0.1:9090?token=METTI_UN_TOKEN_LUNGO_RANDOM mono 8000"/>


Se invece il container non vede 127.0.0.1 dell’host, usa l’IP gateway docker (di solito 172.17.0.1):

<action application="audio_stream" data="ws://172.17.0.1:9090?token=METTI_UN_TOKEN_LUNGO_RANDOM mono 8000"/>

5) Test chiamata

Quando chiami, nei log del bridge dovresti vedere:

“Call started …”

“Connecting to Replit WebSocket …”

“Replit WebSocket connected …”

Mini-nota “produzione vera”

Se vuoi andare davvero pulito: appena confermi che funziona, ti consiglio di far ascoltare il bridge su WS_HOST=127.0.0.1 (non 0.0.0.0) se FreeSWITCH riesce a raggiungerlo localmente, così la 9090 non è esposta.

Se vuoi partire senza perdere tempo: fai solo i punti 2→3→4 e dimmi cosa esce da:

systemctl status alessia-voice --no-pager
journalctl -u alessia-voice -n 50 --no-pager