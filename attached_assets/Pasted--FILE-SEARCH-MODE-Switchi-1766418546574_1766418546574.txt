â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” FILE SEARCH MODE: Switching to Google AI Studio (required for File Search)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“¦ Provider: Google AI Studio (@google/genai)
   âœ… File Search API: SUPPORTED
   âš ï¸  Vertex AI: NOT compatible with File Search
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… [SuperAdmin Gemini] Loaded 1 API keys from config
âœ… Using SuperAdmin Gemini key for File Search (1/1)
ğŸ”„ Building context for client 7e40b56c-2cc8-4515-b843-dc105e478f38 (intent: general, sessionType: normal)
ğŸ“š Including ALL 87 exercises in context (no limits applied)
ğŸ“š Prepared 87 exercise metadata (content will be loaded on-demand when asked)
ğŸ“š Found 81 documents linked to exercises
â° [FOLLOWUP-SCHEDULER] Processing cycle triggered
ğŸ“¤ [FOLLOWUP-SCHEDULER] Processing scheduled messages...
ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...
ğŸ“¬ [FOLLOWUP-SCHEDULER] Found 0 pending messages to send
ğŸ’¤ [FOLLOWUP-SCHEDULER] No pending messages
ğŸ“š Total library documents included in context: 5 (intent: general)
ğŸ¦ Fetching finance data for giusy.dattilo@gmail.com
[PercorsoCapitale] Client initialized for user: gi***@gmail.com
[PercorsoCapitale] req-1 Cache MISS for dashboard (user: gi***@gmail.com), fetching from API... (stats: 0/1 hits)
[PercorsoCapitale] req-2 Cache MISS for categoryBudgets (user: gi***@gmail.com), fetching from API... (stats: 0/2 hits)
[PercorsoCapitale] req-3 Cache MISS for transactions (user: gi***@gmail.com), fetching from API... (stats: 0/3 hits)
[PercorsoCapitale] req-4 Cache MISS for accountArchitecture (user: gi***@gmail.com), fetching from API... (stats: 0/4 hits)
[PercorsoCapitale] req-5 Cache MISS for budgetSettings (user: gi***@gmail.com), fetching from API... (stats: 0/5 hits)
[PercorsoCapitale] req-6 Cache MISS for investments (user: gi***@gmail.com), fetching from API... (stats: 0/6 hits)
[PercorsoCapitale] req-7 Cache MISS for goals (user: gi***@gmail.com), fetching from API... (stats: 0/7 hits)
ğŸ“Š [WHATSAPP POLLING] Polling 9 consultant(s) sequentially...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 42105c6d-d065-4f4e-b5b2-290742b4dd1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
[PercorsoCapitale] req-6 Cached investments for 86400s (886ms response time)
[PercorsoCapitale] req-5 Cached budgetSettings for 86400s (891ms response time)
[PercorsoCapitale] req-2 Cached categoryBudgets for 86400s (1161ms response time)
[PercorsoCapitale] req-3 Cached transactions for 86400s (1157ms response time)
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
[PercorsoCapitale] req-7 Cached goals for 86400s (1396ms response time)
[PercorsoCapitale] req-1 Cached dashboard for 86400s (1541ms response time)
[PercorsoCapitale] req-4 Cached accountArchitecture for 86400s (1532ms response time)
ğŸ“Š [ProcessBudgets] Month 2025-12: Found 32 expense transactions
ğŸ“Š [ProcessBudgets] Month 2025-12: Found 32 expense transactions
ğŸ“Š [ProcessBudgets] Month 2025-11: Found 42 expense transactions
ğŸ“Š [ProcessBudgets] Month 2025-10: Found 27 expense transactions
ğŸ“Š [MultiMonth] Analyzing 185 transactions
ğŸ“… [MultiMonth] Date range: 2025-08-08 â†’ 2026-01-02
ğŸ“… [MultiMonth] Target months: 2025-07, 2025-08, 2025-09, 2025-10, 2025-11, 2025-12
ğŸ” [FilterTransactions] Filtering for month 2025-07:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 0
ğŸ“Š [ProcessBudgets] Month 2025-07: Found 0 expense transactions
ğŸ” [FilterTransactions] Filtering for month 2025-08:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 4
   - Date range: 2025-08-27 â†’ 2025-08-08
ğŸ“Š [ProcessBudgets] Month 2025-08: Found 3 expense transactions
ğŸ” [FilterTransactions] Filtering for month 2025-09:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 43
   - Date range: 2025-09-29 â†’ 2025-09-02
ğŸ“Š [ProcessBudgets] Month 2025-09: Found 33 expense transactions
ğŸ” [FilterTransactions] Filtering for month 2025-10:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 43
   - Date range: 2025-10-31 â†’ 2025-10-01
ğŸ“Š [ProcessBudgets] Month 2025-10: Found 27 expense transactions
ğŸ” [FilterTransactions] Filtering for month 2025-11:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 53
   - Date range: 2025-11-29 â†’ 2025-11-01
ğŸ“Š [ProcessBudgets] Month 2025-11: Found 42 expense transactions
ğŸ” [FilterTransactions] Filtering for month 2025-12:
   - Total transactions before filter: 185
   - Transactions after type filter: 185
   - Transactions matching month: 41
   - Date range: 2025-12-21 â†’ 2025-12-01
ğŸ“Š [ProcessBudgets] Month 2025-12: Found 32 expense transactions
âœ… Finance data fetched and transformed successfully (5 accounts, 8 budgets, 10 transactions)
ğŸ“Š Momentum stats: 17 check-ins (17 productive, 100% rate), streak: 2 days
ğŸ“… Calendar stats: 0 total upcoming (0 ongoing, 0 today, 0 this week)
ğŸ“š [Knowledge Base] Loading ALL knowledge content for client (no filtering)...
ğŸ“š [Client Knowledge Base] Loaded 0 documents and 0 APIs for client 7e40b56c-2cc8-4515-b843-dc105e478f38
â„¹ï¸ [Knowledge Base] No documents or API data uploaded yet
ğŸ’¾ Stored fresh context in cache for client 7e40b56c-2cc8-4515-b843-dc105e478f38 (intent: general)
â±ï¸  [TIMING] Context building: 3713ms
âš ï¸ [WHATSAPP POLLING] Skipping consultant c2146759-f08a-430a-afdf-701bbc674300 - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - incomplete config
ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-14T18:11:36.000Z) is older than watermark - keeping current
ğŸ” [FileSearch] Exercises indexed check: 0/10 checked, using FileSearch: false
ğŸ“š Loading exercise content - exercises NOT in File Search, need full Google Docs access...
ğŸ“‹ Generic exercise query - FULL CONTENT (no limits)
â±ï¸  [TIMING] Exercise scraping: 1128ms
â±ï¸  [TIMING] Prompt building: 19ms

ğŸ“Š Token Usage Estimation (Intent: general):
  - System Prompt: ~114,102 tokens
  - User Message: ~48 tokens
  - Conversation History: ~0 tokens
  - Total Estimated: ~114,150 tokens
  - File Search Mode: âœ… ACTIVE (RAG via stores)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š SYSTEM PROMPT BREAKDOWN (~114,102 tokens)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ NEL SYSTEM PROMPT (114,102 tokens):
   ğŸ’° Finance Data: 13,755 tokens
   ğŸ¯ Goals & Tasks: 12 tokens
   âš¡ Momentum & Calendar: 72 tokens
   ğŸ‘¤ User Profile & Base: 5,055 tokens

ğŸ” VIA FILE SEARCH RAG (non nel prompt, cercati su richiesta):
   ğŸ“š Exercises: 93,882 tokens â†’ via RAG
   ğŸ“– Library Docs: 1,573 tokens â†’ via RAG
   ğŸ’¬ Consultations: 46,363 tokens â†’ via RAG
   ğŸ“š Knowledge Base: 41 tokens â†’ via RAG
   ğŸ“ University: 10,102 tokens â†’ via RAG

   ğŸ’° RISPARMIO: ~151,961 tokens spostati su File Search

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” AI MODE: FILE SEARCH SEMANTIC (Gemini RAG) [CLIENT]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“¦ Stores disponibili: 1
      1. fileSearchStores/private-store-client-7e40b5-g2rbtd1xrc4n

   ğŸ“Š BREAKDOWN DOCUMENTI PER STORE:

   ğŸ‘¥ Private Store - Client 7e40b56c (0 documenti):
   âœ… Tool fileSearch: ATTIVO
   ğŸ“„ Il modello cercherÃ  semanticamente nei documenti indicizzati
   ğŸ’° RISPARMIO TOKENS: ~141,859 tokens (esercizi+library+consultazioni+KB)
   ğŸ“‰ System prompt ridotto: da ~255,961 a ~114,102 tokens
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[AI] Using model: gemini-3-flash-preview with thinking_level: low [CLIENT STREAMING]
[AI] Provider: Google AI Studio -> Gemini 3 Flash
ğŸ”„ AI stream attempt 1/6...
ğŸ”– [WATERMARK] Agent Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - incomplete config
âœ… [WHATSAPP POLLING] Poll cycle complete
âœ… AI streaming completed successfully on attempt 1
â±ï¸  [TIMING] Gemini API call (with streaming): 9073ms
âœ… AI streaming completed for message 4a5ce663-c1a7-43a1-b957-52bab08b763b

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” FILE SEARCH STREAMING SUMMARY [CLIENT]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ğŸ“¦ Stores attivi: 1
   âš ï¸  Nota: In modalitÃ  streaming, le citazioni non sono disponibili
      nel response object. File Search Ã¨ stato configurato come tool.
   ğŸ“„ Se la risposta cita documenti specifici, Gemini ha usato File Search.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â±ï¸  PERFORMANCE TIMING BREAKDOWN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   [0ms â†’ 3713ms] Context Building (3713ms)
   [3713ms â†’ 4841ms] Exercise Scraping (1128ms)
   [4841ms â†’ 4860ms] Prompt Building (19ms)
   [4860ms â†’ 15965ms] Gemini API Call (9073ms)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â±ï¸  TOTAL: 15.96s (15965ms)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

3:49:13 PM [express] POST /api/ai/chat 200 in 16195ms