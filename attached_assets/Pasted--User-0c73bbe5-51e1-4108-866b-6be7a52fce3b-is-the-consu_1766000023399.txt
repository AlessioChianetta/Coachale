 User 0c73bbe5-51e1-4108-866b-6be7a52fce3b is the consultant themselves
âœ… Consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b can use SuperAdmin Vertex AI
ğŸ” Looking for SuperAdmin Vertex AI configuration...
ğŸ“‹ Found SuperAdmin Vertex AI config: project=gen-lang-client-0278434337, location=us-central1
âœ… Parsed credentials as plaintext JSON
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… Created SuperAdmin Vertex AI client successfully
âœ… TIER 0: Successfully created SuperAdmin Vertex AI client
ğŸš€ [FOLLOWUP-ENGINE] Using Vertex AI (SuperAdmin) for evaluation
â° [FOLLOWUP-SCHEDULER] Processing cycle triggered
ğŸ“¤ [FOLLOWUP-SCHEDULER] Processing scheduled messages...
ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...
ğŸ“¬ [FOLLOWUP-SCHEDULER] Found 0 pending messages to send
ğŸ’¤ [FOLLOWUP-SCHEDULER] No pending messages
ğŸ“Š [WHATSAPP POLLING] Polling 5 consultant(s) sequentially...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant c2146759-f08a-430a-afdf-701bbc674300 - incomplete config
ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-14T18:11:36.000Z) is older than watermark - keeping current
ğŸ”– [WATERMARK] Agent Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
âœ… [WHATSAPP POLLING] Poll cycle complete
âœ… [FOLLOWUP-ENGINE] Decision: schedule (confidence: 0.9)
   Reasoning: La conversazione Ã¨ appena iniziata con il primo messaggio inviato pochi minuti fa. Il lead non ha ancora avuto il tempo materiale di leggere e rispondere. Come consulente con esperienza, so che tempestarli subito con un secondo messaggio sarebbe controproducente e potrebbe risultare troppo aggressivo. Ãˆ buona prassi attendere almeno 24-48 ore prima di inviare un follow-up iniziale, per dare al lead lo spazio per processare il messaggio e rispondere. Dato che siamo fuori dalla finestra delle 24 ore di WhatsApp (il lead non ha mai risposto), dovrÃ² usare un template per il prossimo messaggio. Programmo l'invio per domani mattina per avere un buon timing e non perdere il contatto.
   Latency: 15204ms
ğŸ“ [FOLLOWUP-ENGINE] Logging decision for conversation 20c7f6d4-35c4-484d-9558-826e806ef762
âœ… [FOLLOWUP-ENGINE] Decision logged successfully
ğŸ” [TEMPLATE-TRACE] â•â•â• CHIAMATA 2: AI decision â•â•â•
ğŸ” [TEMPLATE-TRACE] candidate.agentConfigId: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ” [TEMPLATE-TRACE] candidate.conversationId: 20c7f6d4-35c4-484d-9558-826e806ef762
ğŸ” [TEMPLATE-TRACE] candidate.leadName: undefined
ğŸ” [TEMPLATE-TRACE] decision.decision: schedule
âš ï¸ [FOLLOWUP-SCHEDULER] Lead mai risposto - finestra 24h non ancora aperta, richiesto template approvato
ğŸ” [TEMPLATE-DEBUG] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” [TEMPLATE-DEBUG] Cercando template per agentConfigId: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ” [TEMPLATE-DEBUG] Conversation: 20c7f6d4-35c4-484d-9558-826e806ef762
ğŸ” [TEMPLATE-DEBUG] Template TROVATI dalla query (tutti): 2
ğŸ” [TEMPLATE-DEBUG]   1. templateId: HX922112cd9b1d531c5be56772acd50034, type: twilio, priority: 2
ğŸ” [TEMPLATE-DEBUG]      - Inizia con HX? true
ğŸ” [TEMPLATE-DEBUG]      - templateType === 'twilio'? true
ğŸ” [TEMPLATE-DEBUG]   2. templateId: HX5e6d27c6d82026f3620247262ef67340, type: twilio, priority: 1
ğŸ” [TEMPLATE-DEBUG]      - Inizia con HX? true
ğŸ” [TEMPLATE-DEBUG]      - templateType === 'twilio'? true
ğŸ” [TEMPLATE-DEBUG] Template DOPO filtro (HX + twilio): 2
ğŸ” [TEMPLATE-DEBUG]   1. HX922112cd9b1d531c5be56772acd50034 (priority: 2)
ğŸ” [TEMPLATE-DEBUG]   2. HX5e6d27c6d82026f3620247262ef67340 (priority: 1)
ğŸ” [TEMPLATE-DEBUG] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [FOLLOWUP-SCHEDULER] Template Twilio approvato SELEZIONATO: HX922112cd9b1d531c5be56772acd50034 (priority: 2, type: twilio)
ğŸ¯ [FOLLOWUP-SCHEDULER] Outside 24h/Lead never responded - using AI to select best template
ğŸ“‹ [TEMPLATE-AI] Fetching all approved templates for agent: 760bb513-098f-4722-b02a-a700160c2fc3
âŒ [FOLLOWUP-SCHEDULER] AI template selection failed, using priority fallback: TypeError: Cannot convert undefined or null to object
    at Function.entries (<anonymous>)
    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:16)
    at <anonymous> (/home/runner/workspace/node_modules/src/utils.ts:88:19)
    at Array.reduce (<anonymous>)
    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:32)
    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:979:23)
    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)
    at PgSelectBase._prepare (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:978:17)
    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1009:16)
    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)
    at PgSelectBase.execute (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1008:17)
    at PgSelectBase.then (/home/runner/workspace/node_modules/src/query-promise.ts:31:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
ğŸ“‹ [TEMPLATE-FINAL] Conversation 20c7f6d4-35c4-484d-9558-826e806ef762:
   leadNeverResponded: true
   allowFreeformMessage: false
   templateIdToUse: HX922112cd9b1d531c5be56772acd50034
   fallbackMessageToUse: NULL
ğŸ”„ [FOLLOWUP-ENGINE] Updating conversation state for 20c7f6d4-35c4-484d-9558-826e806ef762
   Updates: {
  "nextFollowupScheduledAt": "2025-12-18T10:00:00.000Z",
  "lastAiEvaluationAt": "2025-12-17T19:18:08.475Z",
  "aiRecommendation": "La conversazione Ã¨ appena iniziata con il primo messaggio inviato pochi minuti fa. Il lead non ha ancora avuto il tempo materiale di leggere e rispondere. Come consulente con esperienza, so che tempestarli subito con un secondo messaggio sarebbe controproducente e potrebbe risultare troppo aggressivo. Ãˆ buona prassi attendere almeno 24-48 ore prima di inviare un follow-up iniziale, per dare al lead lo spazio per processare il messaggio e rispondere. Dato che siamo fuori dalla finestra delle 24 ore di WhatsApp (il lead non ha mai risposto), dovrÃ² usare un template per il prossimo messaggio. Programmo l'invio per domani mattina per avere un buon timing e non perdere il contatto."
}
âœ… [FOLLOWUP-ENGINE] Conversation state updated successfully
ğŸ“… [FOLLOWUP-SCHEDULER] Scheduled follow-up for 20c7f6d4-35c4-484d-9558-826e806ef762 at 2025-12-18T10:00:00.000Z (AI: "Sistema AI Marco")
[FOLLOWUP-SCHEDULER] Evaluation Cycle cycle_1765999071245_xh4hh5: 17.457s
ğŸ“ˆ [FOLLOWUP-SCHEDULER] ALL evaluation cycle completed
   â±ï¸  Duration: 17457ms
   ğŸ“Š Processed: 1/1
   ğŸŒ¡ï¸  Temperature updates: 1
   ğŸ“… Scheduled: 1
   â­ï¸  Skipped: 0
   ğŸ›‘ Stopped: 0
   âŒ Errors: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle Metrics Report
ğŸ“Š [FOLLOWUP-SCHEDULER] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š [FOLLOWUP-SCHEDULER] Timestamp: 2025-12-17T19:18:08.702Z
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle ID: cycle_1765999071245_xh4hh5
ğŸ“Š [FOLLOWUP-SCHEDULER] Type: evaluation_all
ğŸ“Š [FOLLOWUP-SCHEDULER] Duration: 17457ms
ğŸ“Š [FOLLOWUP-SCHEDULER] Processed: 1
ğŸ“Š [FOLLOWUP-SCHEDULER] Success: 1
ğŸ“Š [FOLLOWUP-SCHEDULER] Errors: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Skipped: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Rate Limited: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Error Rate: 0.0%
ğŸ“Š [FOLLOWUP-SCHEDULER] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•