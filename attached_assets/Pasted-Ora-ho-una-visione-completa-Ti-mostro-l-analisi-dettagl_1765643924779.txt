Ora ho una visione completa. Ti mostro l'analisi dettagliata con i problemi esatti e le soluzioni.

ğŸ“Š ANALISI COMPLETA DEI PROBLEMI
âŒ PROBLEMA 1: Solo 3 tipi di agente visibili in AgentBasicSetup.tsx
ğŸ“ Dove: client/src/components/whatsapp/wizard-steps/AgentBasicSetup.tsx (righe 113-183)
ğŸ”´ Stato attuale:
<div className="grid grid-cols-1 md:grid-cols-3 gap-4">
  {/* SOLO 3 CARD: */}
  <label htmlFor="reactive_lead">    {/* âœ… Receptionist */}
  <label htmlFor="proactive_setter"> {/* âœ… Setter */}
  <label htmlFor="informative_advisor"> {/* âœ… Consulente */}
  
  {/* âŒ MANCA: customer_success */}
  {/* âŒ MANCA: intake_coordinator */}
</div>

ğŸ–¼ï¸ Cosa vede l'utente OGGI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Receptionist â”‚ ğŸ“¤ Setter       â”‚ ğŸ“ Consulente   â”‚
â”‚   (Inbound)     â”‚   (Outbound)    â”‚   (Educativo)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Cosa DEVE vedere:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Receptionist â”‚ ğŸ“¤ Setter       â”‚ ğŸ“ Consulente   â”‚
â”‚   (Inbound)     â”‚   (Outbound)    â”‚   (Educativo)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â†“                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›ï¸ Customer Success     â”‚ ğŸ“‹ Intake Coordinator     â”‚
â”‚   (Post-Vendita)        â”‚   (Raccolta Documenti)    â”‚
â”‚   âŒ NO Booking         â”‚   âŒ NO Booking           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ› ï¸ Soluzione:
Aggiungere 2 nuove <label> con le card per:

customer_success - icona HeartHandshake, colore viola
intake_coordinator - icona ClipboardList, colore indaco
Cambiare la grid da md:grid-cols-3 a una struttura a 2 righe (3+2) per mantenere equilibrio visivo.

âŒ PROBLEMA 2: Badge mancanti nel wizard delle istruzioni
ğŸ“ Dove: client/src/components/whatsapp/AgentInstructionsPanel.tsx (righe 2339-2342 e 2440-2443)
ğŸ”´ Stato attuale:
// Riga 2339-2342 - Template Standard description
{agentType === "inbound" && "Receptionist ottimizzato"}
{agentType === "outbound" && "Marco Setter ottimizzato"}
{agentType === "consultative" && "Consulente Educativo"}
// âŒ MANCA: customer_success
// âŒ MANCA: intake_coordinator

// Riga 2440-2443 - Badge nel wizard
{agentType === "inbound" && "ğŸ“ Agente Inbound"}
{agentType === "outbound" && "ğŸ“¤ Agente Outbound"}
{agentType === "consultative" && "ğŸ“ Agente Consulenziale"}
// âŒ MANCA: customer_success
// âŒ MANCA: intake_coordinator

ğŸ› ï¸ Soluzione:
Aggiungere in entrambi i punti:

{agentType === "customer_success" && "ğŸ›ï¸ Agente Customer Success"}
{agentType === "intake_coordinator" && "ğŸ“‹ Agente Intake Coordinator"}

âŒ PROBLEMA 3: Logica "Genera da info profilo" genera da zero
ğŸ“ Dove: client/src/components/whatsapp/AgentInstructionsPanel.tsx (riga 2006)
ğŸ”´ Stato attuale della funzione handleGenerateInstructions:
const handleGenerateInstructions = async () => {
  // ...
  const response = await fetch('/api/whatsapp/config/instructions/generate', {
    method: "POST",
    body: JSON.stringify({
      agentType,
      objective: customObjective,
      customObjective: ...,
      bookingEnabled: ...,
      // âŒ NON PASSA IL TEMPLATE BASE!
    }),
  });
  // ...
  setInstructions(data.data.instructions); // Sostituisce tutto con output AI
};

ğŸ”´ Il Backend (riga 674 di agent-instructions-router.ts):
const systemPrompt = `Sei un esperto di prompt engineering...
// âŒ GENERA DA ZERO senza considerare il template base dell'agente

ğŸ–¼ï¸ Flusso ATTUALE (sbagliato):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utente clicca    â”‚ â”€â”€â–º â”‚ Backend riceve   â”‚ â”€â”€â–º â”‚ AI genera script â”‚
â”‚ "Genera da info" â”‚     â”‚ solo obiettivo   â”‚     â”‚ DA ZERO          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ âŒ Script nuovo      â”‚
                                               â”‚ NON basato su        â”‚
                                               â”‚ template agente      â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Flusso CORRETTO (da implementare):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utente clicca    â”‚ â”€â”€â–º â”‚ Frontend carica  â”‚ â”€â”€â–º â”‚ Backend riceve   â”‚
â”‚ "Genera da info" â”‚     â”‚ template BASE    â”‚     â”‚ template +       â”‚
â”‚                  â”‚     â”‚ dell'agente      â”‚     â”‚ obiettivo        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ AI MODIFICA il       â”‚
                                               â”‚ template esistente   â”‚
                                               â”‚ in base all'obiettivoâ”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ âœ… Script basato su  â”‚
                                               â”‚ template + obiettivo â”‚
                                               â”‚ + variabili profilo  â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ› ï¸ Soluzione:
Frontend: Modificare handleGenerateInstructions per passare il baseTemplate dell'agente corrente
Backend: Modificare l'endpoint /instructions/generate per:
Ricevere il template base
Usare l'AI per ADATTARE il template (non crearne uno nuovo)
Prompt: "Modifica questo template per l'obiettivo X"
âœ… COSA GIÃ€ FUNZIONA (non toccare)
Componente	Stato	Note
CUSTOMER_SUCCESS_TEMPLATE	âœ… Esiste	156 righe complete (890-1045)
INTAKE_COORDINATOR_TEMPLATE	âœ… Esiste	~150 righe complete (1047+)
OBJECTIVE_OPTIONS_BY_TYPE	âœ… Completo	Ha tutti i 5 tipi con obiettivi
mapAgentTypeToInternal()	âœ… Funziona	Mappa customer_success e intake_coordinator
getInitialInstructions()	âœ… Funziona	Carica i template corretti
defaultObjectives	âœ… Completo	Ha i default per tutti i 5 tipi
Backend Schema	âœ… Completo	generateInstructionsSchema ha tutti i tipi
Backend Labels	âœ… Completo	agentTypeLabels ha tutti i 5 tipi
Backend Guidance	âœ… Completo	objectiveSpecificGuidance ha tutti gli obiettivi
ğŸ“‹ PIANO DETTAGLIATO DI IMPLEMENTAZIONE



Esempio pratico:
Tipo Agente	isProactive = OFF	isProactive = ON
ğŸ“ Receptionist	Aspetta che il lead scriva	Scrive lui per primo
ğŸ›ï¸ Customer Success	Risponde quando il cliente ha problemi	Contatta per check-in periodici
ğŸ“‹ Intake Coordinator	Aspetta il cliente	Contatta per raccogliere documenti
Cosa serve:
Database: Aggiungere campo isProactiveAgent: boolean in consultantWhatsappConfig
Frontend: Aggiungere switch "ModalitÃ  Proattiva" nella sezione "Opzioni Agente" (righe 354-411)
Backend: Usare questo flag per decidere se l'agente puÃ² iniziare conversazioni