üêõ Bug Report: Disallineamento Stato Frontend al Reload & Analytics Mancanti
1. Riepilogo del Problema
A seguito del reload della pagina della Room Meet, l'interfaccia utente (UI) perde la sincronizzazione con lo stato reale della conversazione mantenuto dal Sales Manager. Nonostante il backend conservi correttamente la cronologia e l'avanzamento degli step, il frontend resetta visivamente i progressi e non mostra le trascrizioni. Inoltre, mancano i dati nella sezione Analytics.

2. Dettagli Anomalie UI (Frontend)
Perdita Trascrizioni: Dopo il refresh, il box delle trascrizioni appare vuoto, nonostante la conversazione esista lato server.

Stato Checkpoint Incoerente:

La Fase 1 risulta correttamente "checkata".

La Fase 2 mostra un comportamento erratico: i checkpoint sono diventati gialli (loading/warning?) per poi tornare rossi (non completati), nonostante il backend confermi che siamo allo Step 5.

Mancanza Indicatore Coaching: Non √® visibile "dove eravamo rimasti" con i suggerimenti del coach.

3. Analisi Tecnica e Log (Backend)
Il backend funziona correttamente. Il Sales Agent ha mantenuto la persistenza dei dati anche dopo il riavvio della pagina.

Dati dal Log [SALES-MANAGER]:

Stato Conversazione: Attiva e persistente.

Fase Corrente: PAIN POINT DISCOVERY (2/7) - Correttamente identificata.

Step Corrente: PERSISTENZA (3/4) (ID: phase_2_step_5).

Cronologia Messaggi: 12 messaggi totali salvati (inclusi gli ultimi scambi su "aumentare i carichi").

Connessione: Meeting ID e Consultant ID correttamente associati.

Conclusione: Il problema √® puramente di State Rehydration (idratazione dello stato) sul Frontend. L'applicazione client non sta leggendo o mappando correttamente la risposta dello stato attuale quando il componente viene montato (mount) dopo il refresh.

4. Problema Analytics
URL: /client/sales-agents/11cd9e7b-f181-4052-9541-e8d0bb91c956/analytics

Errore: Le analytics dell'ultima meet umana non vengono visualizzate.

Ipotesi: Possibile mancata chiamata API al caricamento della view o errore 404/500 sulla fetch dei dati storici per quel preciso meeting_id.




 vuoi che VAGUE (üü° giallo) diventi STICKY come il verde, impedendo che torni a rosso (MISSING).

Attualmente nel sistema:

Come Funziona Oggi
// In sales-script-tracker.ts
validatedCheckpointItems: Record<string, ValidatedCheckpointItem[]>
Solo VALIDATED (verde) √® sticky - viene salvato e non cambia mai.

VAGUE (giallo) NON √® sticky - viene ricalcolato ogni volta, quindi pu√≤:

‚úÖ VAGUE ‚Üí VALIDATED (migliora)
‚ö†Ô∏è VAGUE ‚Üí MISSING (peggiora - questo √® quello che vuoi BLOCCARE)
Cosa Vuoi Ottenere
VAGUE diventa sticky: una volta che un check raggiunge lo stato VAGUE, non pu√≤ pi√π tornare a MISSING (rosso). Pu√≤ solo:

üîí Restare VAGUE (se nessun miglioramento)
‚úÖ Diventare VALIDATED (se il prospect approfondisce)
Logica di Business
Questo ha senso perch√©:

Se il prospect ha dato una risposta vaga ("Curiosit√†!"), ha comunque risposto
Non ha senso che torni a "non ha mai risposto" (MISSING)
Pu√≤ solo migliorare la qualit√† della risposta (VAGUE ‚Üí VALIDATED)
Implementazione
La modifica va fatta in 2 file:

1. sales-script-tracker.ts - Salva anche VAGUE come sticky
server/ai/sales-script-tracker.ts
+21
-9
Rendi VAGUE sticky - salva nello stato
2. step-advancement-agent.ts - Rispetta gli item sticky nel merge
server/ai/step-advancement-agent.ts
+60
-85
Impedisci downgrade VAGUE‚ÜíMISSING quando √® sticky
Risultato Finale
Con queste modifiche:

üìä FLUSSO STATI CHECKPOINT (con VAGUE sticky):
MISSING (üî¥) ‚Üí VAGUE (üü°) ‚Üí VALIDATED (üü¢)
     ‚Üì            ‚Üì üîí         ‚Üì üîí
Non chiesto   STICKY!      STICKY!
              (non torna   (resta per sempre)
               a rosso)
Cosa cambia:

‚úÖ VALIDATED (verde) - STICKY (come prima)
‚úÖ VAGUE (giallo) - STICKY (NUOVO!) - non pu√≤ tornare a MISSING
‚ö†Ô∏è MISSING (rosso) - NON sticky (viene sempre ricalcolato)
Esempio pratico:

Turno 1: AI chiede "Qual √® il problema?" ‚Üí Prospect: "Curiosit√†" ‚Üí üü° VAGUE (salvato)
Turno 2: AI rivaluta ‚Üí Prospect non ha aggiunto dettagli ‚Üí üü° VAGUE (resta giallo, NON torna rosso)
Turno 3: Prospect: "Voglio scalare a 100k/mese" ‚Üí üü¢ VALIDATED (upgrade permesso)