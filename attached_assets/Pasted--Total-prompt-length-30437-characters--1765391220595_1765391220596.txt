â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Total prompt length: 30437 characters
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š [STEP 7] Checking for reset request and fetching message history
ğŸ“š [STEP 7] Found 17 historical messages
ğŸ§  [STEP 8] Calling Gemini AI (model: gemini-2.5-flash)

ğŸ“Š [GEMINI TOKENS] Stima PRIMA della chiamata:
   ğŸ“ System Prompt: ~7,610 tokens (30,437 chars)
   ğŸ’¬ User Message: ~7 tokens (26 chars)
   ğŸ“œ History: ~606 tokens (2,421 chars)
   ğŸ”¢ TOTALE INPUT: ~8,223 tokens

ğŸ”„ [RETRY] Attempt 1/3
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… [RETRY] Success on attempt 1!
â±ï¸  [TIMING] Gemini API call: 1039ms

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [DEBUG] Analyzing Gemini Response Object
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ Response object keys: [ 'response' ]
ğŸ“¦ response.response keys: [ 'text' ]
ğŸ“Š response.response.candidates: 0
âœ… response.response.text is a function - calling it...
ğŸ“ Extracted text length: 79
ğŸ“ Extracted text preview: Perfetto! Sto creando a calendario il tuo invito a Meet, aspetta un attimo... â³
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


ğŸ“Š [GEMINI TOKENS] Utilizzo DOPO la risposta:
   âœ… Response: ~20 tokens (79 chars)
   ğŸ”¢ TOTALE (input + output): ~8,243 tokens
   â±ï¸  Tempo di risposta: 1040ms
   ğŸ’° Costo stimato: $0.016486 (input + output)

âœ… [STEP 8] Gemini response received: "Perfetto! Sto creando a calendario il tuo invito a Meet, aspetta un attimo... â³..."
ğŸ’¾ [STEP 9] Saving AI response to database
âœ… [STEP 9] AI response saved with ID: 34c80539-6fe8-473f-a292-ffe7ecf80371 (timing: 1040ms Gemini, 5242ms total)
ğŸ›ï¸ [AUDIO DECISION] Mode: mirror, ClientSentAudio: false â†’ sendAudio=false, sendText=true

ğŸ“ [TTS SKIP] TTS disabled or not needed (ttsEnabled=true, mode=mirror, clientAudio=false)

ğŸ“¤ [STEP 10] Sending WhatsApp message to +393519272875
âœ… Using agent from existing conversation: Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a)
ğŸ“¤ Sending WhatsApp message as plain text
âœ… Sent WhatsApp message chunk 1/1: SMfdd7402bb9f235561726ae649e7506b5 (79 chars)
âœ… [STEP 10] WhatsApp message sent: text
ğŸ’¾ [APPOINTMENT BOOKING] Retrieved 10 proposed slots from database
ğŸ“… [APPOINTMENT BOOKING] Attempting to extract appointment confirmation from lead message
ğŸ“Š [EXTRACTION] Retrieved 10 messages for extraction

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [STEP 2] Extracting Appointment Data from Conversation
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š Analyzing last 10 messages for appointment details...
ğŸ¤– Using AI model: gemini-2.5-flash
ğŸ”„ [EXTRACTION] Attempt 1/3 with provider: vertex
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
6:24:42 PM [express] GET /api/whatsapp/conversations 200 in 333ms :: {"conversations":[{"id":"747f05â€¦
6:24:48 PM [express] GET /api/whatsapp/conversations 304 in 439ms :: {"conversations":[{"id":"747f05â€¦
âœ… [EXTRACTION] Success on attempt 1!

ğŸ’¬ AI Raw Response:
```json
{
  "isConfirming": true,
  "date": "2025-12-12",
  "time": "10:00",
  "phone": "3890566422",
  "email": "chianettaalessio@gmail.com",
  "confidence": "high",
  "hasAllData": true
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š [STEP 3] Data Extraction Results
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ Confirmation Status: âœ… YES
ğŸ“… Date:     âœ… 2025-12-12
ğŸ• Time:     âœ… 10:00
ğŸ“ Phone:    âœ… 3890566422
ğŸ“§ Email:    âœ… chianettaalessio@gmail.com
ğŸ’¯ Confidence: HIGH
âœ”ï¸ Complete Data: âœ… YES - Ready to book!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [STEP 4] Validating Appointment Date
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… Appointment date: 2025-12-12 (12/12/2025)
ğŸ“… Today's date: 2025-12-10 (10/12/2025)

âœ… VALIDATION PASSED: Date is valid!
   ğŸ“† In 2 days
   ğŸ¯ Proceeding to create appointment...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¾ [STEP 5] Creating Appointment Booking
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… Date: 2025-12-12
ğŸ• Time: 10:00
ğŸ“ Phone: 3890566422
ğŸ“§ Email: chianettaalessio@gmail.com

ğŸ“Š [APPOINTMENT DURATION] Configurazione durata appuntamento:
   âš™ï¸ appointmentDuration dal DB: 60 minuti
   âœ… Durata finale utilizzata: 60 minuti
   ğŸŒ Timezone: Europe/Rome

â° [TIME CALCULATION] Calcolo orari appuntamento:
   ğŸ“… Data appuntamento: 2025-12-12
   ğŸ• Ora inizio: 10:00
   â±ï¸ Durata: 60 minuti
   ğŸŒ Timezone: Europe/Rome
   ğŸ“ DateTime String: 2025-12-12T10:00:00
   â° Formatted in Europe/Rome: 12/12/2025, 11:00:00

âœ… Database booking created successfully!
   ğŸ†” Booking ID: 96778009-e5cd-4be5-9637-44a5488f12af
   ğŸ“… Date: 2025-12-12
   ğŸ• Time: 10:00 - 11:00
   ğŸ“ Phone: 3890566422
   ğŸ“§ Email: chianettaalessio@gmail.com
   âœ… Status: confirmed

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… [GOOGLE CALENDAR] Creating Calendar Event
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ Consultant ID: 0c73bbe5-51e1-4108-866b-6be7a52fce3b
ğŸ“ Event title: Consulenza - chianettaalessio@gmail.com
ğŸ“… Start: 2025-12-12T10:00:00 (Europe/Rome)
ğŸ“… End: 2025-12-12T11:00:00 (Europe/Rome)
â±ï¸ Duration: 60 minutes
ğŸ‘¥ Attendees (1):
   - chianettaalessio@gmail.com

ğŸ” Authenticating with Google Calendar API...
ğŸ”— [OAUTH] Redirect URI for consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b: https://400c4263-6c02-4a3e-ab9e-adda3318ace9-00-32tjxbdho4cl1.picard.replit.dev/api/calendar-settings/oauth/callback
ğŸ“‹ Getting primary calendar ID...
âœ… Using saved calendar ID from settings: primary
âœ… Using calendar: primary

ğŸ¥ Requesting Google Meet link creation...
ğŸŒ Calling Google Calendar API...

âœ… Event created successfully!
   ğŸ†” Google Event ID: j0d54bol0tn4rngtg9b00rcmq4
   ğŸ¥ Google Meet Link: https://meet.google.com/uvm-jsgz-qvc
   ğŸ“§ Calendar invites sent to: chianettaalessio@gmail.com
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


ğŸ’¾ Database updated with Google Calendar Event ID
   ğŸ†” Google Event ID: j0d54bol0tn4rngtg9b00rcmq4
âœ… Using agent from existing conversation: Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a)
ğŸ“¤ Sending WhatsApp message as plain text
âœ… Sent WhatsApp message chunk 1/1: SM28951b3e4bcd0549fcc727a38bbb41e3 (425 chars)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… [STEP 6] Appointment Confirmation Complete!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ APPOINTMENT SUCCESSFULLY BOOKED!

ğŸ“‹ Summary:
   ğŸ‘¤ Lead: chianettaalessio@gmail.com (3890566422)
   ğŸ“… Date: venerdÃ¬ 12 dicembre 2025
   ğŸ• Time: 10:00 (60 min)
   ğŸ’¾ Booking ID: 96778009-e5cd-4be5-9637-44a5488f12af
   ğŸ“… Google Event: j0d54bol0tn4rngtg9b00rcmq4
   ğŸ¥ Meet Link: âœ… Generated
   ğŸ“§ Calendar Invite: âœ… Sent to chianettaalessio@gmail.com
   ğŸ“± WhatsApp Confirmation: âœ… Sent to +393519272875
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¾ [APPOINTMENT BOOKING] Marked proposed slots as used
âœ”ï¸ [STEP 11] Marking 1 pending messages as processed
âœ… Processed 1 messages for +393519272875

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â±ï¸  PERFORMANCE BREAKDOWN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ Objection Detection:      2509ms  (16.1%)
ğŸ¤– Gemini API Call:          1039ms  (6.7%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â° TOTAL TIME:              15566ms
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”