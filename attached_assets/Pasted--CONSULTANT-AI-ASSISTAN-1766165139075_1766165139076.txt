======================================================================
ğŸ§‘â€ğŸ’¼ CONSULTANT AI ASSISTANT - New Chat Message
======================================================================
Consultant ID: 0c73bbe5-51e1-4108-866b-6be7a52fce3b
Message: Mostrami un riepilogo dei miei clienti attivi
======================================================================

ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...
ğŸ” [FileSearch] getStoreNamesForGeneration - Role: consultant, UserId: 0c73bbe5-51e1-4108-866b-6be7a52fce3b, ConsultantId: N/A
   ğŸ“¦ Found 1 unique stores: Knowledge Base Consulente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” FILE SEARCH MODE: Switching to Google AI Studio (required for File Search)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“¦ Provider: Google AI Studio (@google/genai)
   âœ… File Search API: SUPPORTED
   âš ï¸  Vertex AI: NOT compatible with File Search
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… [SuperAdmin Gemini] Loaded 1 API keys from config
âœ… Using SuperAdmin Gemini key for File Search (1/1)
ğŸ‘¤ [INTENT: client_specific] Query specifica su un cliente
ğŸ” [Intent Detection] Detected intent from message: client_specific
ğŸ”‘ [Cache Key] Using cache key: 0c73bbe5-51e1-4108-866b-6be7a52fce3b-client_specific
ğŸ”„ Building fresh consultant context (intent: client_specific)
ğŸ” [DEBUG] Query flags: {
  shouldLoadClients: true,
  shouldLoadExercises: false,
  shouldLoadClientData: true,
  shouldLoadEmail: false,
  shouldLoadWhatsApp: false,
  shouldLoadCalendar: false,
  shouldLoadConsultations: true,
  shouldLoadEmailDetailed: false,
  shouldLoadWhatsAppDetailed: false,
  shouldLoadAIAgents: false,
  shouldLoadLeads: false,
  shouldLoadCampaigns: false,
  shouldLoadApiSettings: false,
  shouldLoadWhatsAppConfig: false
}
ğŸ” [Q1] Fetching consultant info...
ğŸ” [Q2] Fetching all clients...
ğŸ” [Q12] Fetching all consultations...
ğŸ” [Q13] Fetching consultation tasks...
ğŸ” [Q13a] Fetching client goals...
ğŸ” [Q13b] Fetching client state tracking data (latest per client)...
ğŸ” [Q14] Fetching SMTP settings...
ğŸ” [Q15] Fetching email journey templates...
ğŸ” [Q16] Fetching WhatsApp custom templates...
ğŸ” [Q17] Fetching library documents...
ğŸ” [Q18] Fetching exercise feedback...
ğŸ” [Q19] Fetching university year assignments with detailed structure...
ğŸ” [Q20] Fetching exercise templates...
ğŸ” [Q21] Fetching university templates...
ğŸ“Š [WHATSAPP POLLING] Polling 7 consultant(s) sequentially...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
âœ… [Q1] Consultant info fetched
âœ… [Q16] WhatsApp custom templates fetched: 50
âœ… [Q14] SMTP settings fetched: 1
âœ… [Q2] All clients fetched: 20
âœ… [Q21] University templates fetched: 4
âœ… [Q17] Library documents fetched: 20
âœ… [Q18] Exercise feedback fetched: 10
âœ… [Q15] Email journey templates fetched: 31
âœ… [Q13] Consultation tasks fetched: 1
âœ… [Q13a] Client goals fetched: 0
âœ… [Q13b] Client state tracking fetched (unique clients): 23
âœ… [Q20] Exercise templates fetched: 84
âœ… [Q12] All consultations fetched: 30
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
âœ… [Q19] University year assignments raw data fetched: 1097 rows
âš ï¸ [WHATSAPP POLLING] Skipping consultant c2146759-f08a-430a-afdf-701bbc674300 - incomplete config
ğŸ“§ [EMAIL MAPPING] Created email mapping for 0 consultations
ğŸ“š [Knowledge Base] Loading ALL knowledge content for consultant (no filtering)...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - incomplete config
ğŸ“š [Knowledge Base] Loaded 1 documents and 0 APIs for consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b
âœ… [Knowledge Base] Loaded ALL content: 1 documents, 0 API sources

ğŸ“Š Token Usage Breakdown (Intent: client_specific):
   Dashboard: 26 tokens
   Clients (20 clients): 1,635 tokens
   Exercises: 32 tokens
   Email Marketing: 45 tokens
   WhatsApp Leads: 34 tokens
   Calendar: 88 tokens
   Consultations: 31,985 tokens
   Consultation Tasks: 18 tokens
   Client Goals: 19 tokens
   Client States (23 states): 7,904 tokens
   SMTP Configuration: 0 tokens
   Email Templates: 0 tokens
   WhatsApp Templates: 0 tokens
   Library Documents: 0 tokens
   Exercise Feedback: 2,795 tokens
   University: 42,478 tokens
   Exercise Templates: 13,460 tokens
   ğŸ“š Knowledge Base: 2,191 tokens
   Base (prompts + metadata): 5,052 tokens
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ¯ TOTAL ESTIMATED: 107,762 tokens

âœ… Built and cached consultant context (intent: client_specific)
â±ï¸  [TIMING] Consultant context building: 1619ms
âš ï¸ [WHATSAPP POLLING] Skipping consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - incomplete config
â±ï¸  [TIMING] Consultant prompt building: 5ms

ğŸ“Š Token Usage Estimation:
  - System Prompt: ~55,707 tokens
  - User Message: ~12 tokens
  - Conversation History: ~0 tokens
  - Total Estimated: ~55,719 tokens

