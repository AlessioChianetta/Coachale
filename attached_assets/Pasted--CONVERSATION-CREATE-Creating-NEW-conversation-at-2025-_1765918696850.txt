
ğŸ†•ğŸ†•ğŸ†• [CONVERSATION CREATE] Creating NEW conversation at 2025-12-16T20:47:33.164Z ğŸ†•ğŸ†•ğŸ†•
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
ğŸ‘¨â€ğŸ’¼ [PARTICIPANT] Recognized CONSULTANT: alessio chianetta
ğŸ‘¤ [PARTICIPANT] Type: consultant, isLead: false, userId: 0c73bbe5-51e1-4108-866b-6be7a52fce3b
âœ… [CONVERSATION CREATED] id=adbdde03-ed2e-4e4c-ae70-bfe503805caf for +393890566422 (Type: consultant, Known User - PROACTIVE) assigned to agent: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ“Š [CONVERSATION STATE] Created initial state for conversation adbdde03-ed2e-4e4c-ae70-bfe503805caf
ğŸ’¾ [INSERT] Inserting message for lead d610e2a4-5e8d-4241-b9e3-de12d7395078 (Alessio) to conversation adbdde03-ed2e-4e4c-ae70-bfe503805caf
   Message text preview: "ğŸ§ª DRY RUN - Anteprima Messaggio

Ciao Alessio! ğŸ‘‹ Sono Marco di Orbitale.

Ti scrivo riguardo alla ..."
   Dry run: true, Template SID: HX922112cd9b1d531c5be56772acd50034
âœ… [INSERT] Message saved with ID: 26856f27-f5df-40f7-80af-ab6b6c98c8ba
ğŸ”’ [DRY RUN] Saved simulated message to database: 26856f27-f5df-40f7-80af-ab6b6c98c8ba
âœ… [WHATSAPP POLLING] Poll cycle complete
âœ… Using explicitly specified agent: Marco setter (760bb513-098f-4722-b02a-a700160c2fc3)

ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”’ DRY RUN MODE - Agent: Marco setter
ğŸ”’ No real messages will be sent (simulated only)
ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“± Using From number: whatsapp:+393500220129 (Agent: Marco setter)
ğŸ“¤ [DRY RUN] Would send WhatsApp message with template: HX922112cd9b1d531c5be56772acd50034
ğŸ“‹ Template Details:
   From: whatsapp:+393500220129
   To: whatsapp:+393890566422
   Template SID: HX922112cd9b1d531c5be56772acd50034
   Variables: {
  "1": "Alessio",
  "2": "Marco",
  "3": "Orbitale",
  "4": "Ho visto che ti sei iscritto ai nostri contenuti per capire come riuscire a gestire al meglio i tuoi risparmi e incrementare il tuo patrimonio dai 100.000 ai 500.000 euro nei prossimi 6-12 mesi",
  "5": "la libertÃ  finanziaria con un patrimonio che lavora al posto tuo"
}
   Message Text (fallback): TEMPLATE:HX922112cd9b1d531c5be56772acd50034
âœ… [DRY RUN] Simulated template message: DRY_RUN_TEMPLATE_1765918053990_yqw7l
ğŸ”’ [DRY RUN] Simulated message to Alessio Chianetta - updating status to prevent duplicates
ğŸ”’ [DRY RUN] Lead d610e2a4-5e8d-4241-b9e3-de12d7395078 status updated to 'contacted' (prevents duplicate sends)
ğŸ“ [ACTIVITY LOG] sent: Messaggio simulato (DRY RUN)

âœ… [PROACTIVE OUTREACH] Completed in 1953ms
   ğŸ“Š Results: 1 success, 0 errors, 0 skipped, 1 pending leads total
8:47:34 PM [express] POST /api/proactive-leads/d610e2a4-5e8d-4241-b9e3-de12d7395078/trigger-now 200 â€¦
8:47:34 PM [express] POST /api/activity/session/heartbeat 200 in 306ms :: {"success":true,"lastActivâ€¦
8:47:34 PM [express] GET /api/proactive-leads 200 in 302ms :: {"success":true,"leads":[{"id":"d610e2â€¦
8:47:38 PM [express] GET /api/whatsapp/conversations/stats 200 in 8ms
8:47:38 PM [express] GET /api/auth/my-profiles 304 in 302ms :: {"profiles":[{"id":"fd732f27-d63b-4e8â€¦
8:47:44 PM [express] GET /api/whatsapp/conversations 200 in 500ms :: {"conversations":[{"id":"adbddeâ€¦
8:47:45 PM [express] GET /api/whatsapp/conversations/adbdde03-ed2e-4e4c-ae70-bfe503805caf/messages 2â€¦
8:47:46 PM [express] PATCH /api/whatsapp/conversations/adbdde03-ed2e-4e4c-ae70-bfe503805caf/mark-reaâ€¦
8:47:46 PM [express] GET /api/whatsapp/conversations/adbdde03-ed2e-4e4c-ae70-bfe503805caf/messages 3â€¦
8:47:46 PM [express] GET /api/whatsapp/conversations 200 in 505ms :: {"conversations":[{"id":"adbddeâ€¦
8:47:47 PM [express] GET /api/automation-rules 200 in 7ms
8:47:47 PM [express] GET /api/auth/my-profiles 304 in 305ms :: {"profiles":[{"id":"fd732f27-d63b-4e8â€¦
8:47:49 PM [express] GET /api/auth/my-profiles 304 in 305ms :: {"profiles":[{"id":"fd732f27-d63b-4e8â€¦
8:47:50 PM [express] GET /api/followup/activity-log 200 in 411ms :: {"timeline":[],"allEvents":[],"tâ€¦
ğŸ”„ [FOLLOWUP-API] Manual trigger requested by consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b
ğŸ” [FOLLOWUP-SCHEDULER] Starting ALL follow-up evaluation cycle...
ğŸ‘¥ [FOLLOWUP-SCHEDULER] Found 1 consultants with active follow-up rules
ğŸ“Š [FOLLOWUP-SCHEDULER] Found 1 ALL candidate conversations
ğŸŒ¡ï¸ [TEMPERATURE] Conversazione adbdde03-ed2e-4e4c-ae70-bfe503805caf: warm â†’ ghost
ğŸ” [FOLLOWUP-SCHEDULER] Evaluating conversation adbdde03-ed2e-4e4c-ae70-bfe503805caf
   State: new, Days silent: 0, Hours silent: 0.0, Follow-ups: 0/5
   ğŸ“‹ Applicable rules: 1
ğŸ¤– [FOLLOWUP-SCHEDULER] Using AI decision for rule: "AI Follow-up Intelligente (entro 24h)"
ğŸ¤– [FOLLOWUP-ENGINE] Evaluating follow-up for conversation adbdde03-ed2e-4e4c-ae70-bfe503805caf
   State: new, Days silent: 0, Follow-ups: 0/5
ğŸ” Finding AI provider for client 0c73bbe5-51e1-4108-866b-6be7a52fce3b (consultant: 0c73bbe5-51e1-4108-866b-6be7a52fce3b)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Vertex AI eligibility...
ğŸ“‹ User 0c73bbe5-51e1-4108-866b-6be7a52fce3b is the consultant themselves
âœ… Consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b can use SuperAdmin Vertex AI
ğŸ” Looking for SuperAdmin Vertex AI configuration...
ğŸ“‹ Found SuperAdmin Vertex AI config: project=gen-lang-client-0278434337, location=us-central1
âœ… Parsed credentials as plaintext JSON
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… Created SuperAdmin Vertex AI client successfully
âœ… TIER 0: Successfully created SuperAdmin Vertex AI client
ğŸš€ [FOLLOWUP-ENGINE] Using Vertex AI (SuperAdmin) for evaluation
â° [FOLLOWUP-SCHEDULER] Processing cycle triggered
ğŸ“¤ [FOLLOWUP-SCHEDULER] Processing scheduled messages...
ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...
ğŸ“¬ [FOLLOWUP-SCHEDULER] Found 0 pending messages to send
ğŸ’¤ [FOLLOWUP-SCHEDULER] No pending messages
ğŸ“Š [WHATSAPP POLLING] Polling 4 consultant(s) sequentially...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-14T18:11:36.000Z) is older than watermark - keeping current
ğŸ”– [WATERMARK] Agent Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
âœ… [FOLLOWUP-ENGINE] Decision: schedule (confidence: 1)
   Reasoning: L'agente ha appena inviato il messaggio iniziale oggi (0 giorni fa) e il lead non ha ancora avuto il tempo di leggerlo o di rispondere. Inviare un follow-up immediatamente oggi stesso sarebbe troppo aggressivo e controproducente. Ãˆ fondamentale concedere al lead il tempo necessario per elaborare il primo messaggio. Programmare il follow-up per domani Ã¨ l'approccio migliore per mantenere un tono professionale e non pressante, dando al contempo seguito all'iniziale contatto.
   Latency: 9691ms
ğŸ“ [FOLLOWUP-ENGINE] Logging decision for conversation adbdde03-ed2e-4e4c-ae70-bfe503805caf
âœ… [FOLLOWUP-ENGINE] Decision logged successfully
ğŸ” [TEMPLATE-TRACE] â•â•â• CHIAMATA 2: AI decision â•â•â•
ğŸ” [TEMPLATE-TRACE] candidate.agentConfigId: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ” [TEMPLATE-TRACE] candidate.conversationId: adbdde03-ed2e-4e4c-ae70-bfe503805caf
ğŸ” [TEMPLATE-TRACE] candidate.leadName: undefined
ğŸ” [TEMPLATE-TRACE] decision.decision: schedule
âš ï¸ [FOLLOWUP-SCHEDULER] Lead mai risposto - finestra 24h non ancora aperta, richiesto template approvato
ğŸ” [TEMPLATE-DEBUG] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” [TEMPLATE-DEBUG] Cercando template per agentConfigId: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ” [TEMPLATE-DEBUG] Conversation: adbdde03-ed2e-4e4c-ae70-bfe503805caf
ğŸ” [TEMPLATE-DEBUG] Template TROVATI dalla query (tutti): 2
ğŸ” [TEMPLATE-DEBUG]   1. templateId: HX922112cd9b1d531c5be56772acd50034, type: twilio, priority: 2
ğŸ” [TEMPLATE-DEBUG]      - Inizia con HX? true
ğŸ” [TEMPLATE-DEBUG]      - templateType === 'twilio'? true
ğŸ” [TEMPLATE-DEBUG]   2. templateId: HX5e6d27c6d82026f3620247262ef67340, type: twilio, priority: 1
ğŸ” [TEMPLATE-DEBUG]      - Inizia con HX? true
ğŸ” [TEMPLATE-DEBUG]      - templateType === 'twilio'? true
ğŸ” [TEMPLATE-DEBUG] Template DOPO filtro (HX + twilio): 2
ğŸ” [TEMPLATE-DEBUG]   1. HX922112cd9b1d531c5be56772acd50034 (priority: 2)
ğŸ” [TEMPLATE-DEBUG]   2. HX5e6d27c6d82026f3620247262ef67340 (priority: 1)
ğŸ” [TEMPLATE-DEBUG] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [FOLLOWUP-SCHEDULER] Template Twilio approvato SELEZIONATO: HX922112cd9b1d531c5be56772acd50034 (priority: 2, type: twilio)
âœ… [WHATSAPP POLLING] Poll cycle complete
ğŸ”„ [FOLLOWUP-ENGINE] Updating conversation state for adbdde03-ed2e-4e4c-ae70-bfe503805caf
   Updates: {
  "nextFollowupScheduledAt": "2025-12-17T10:00:00.000Z",
  "lastAiEvaluationAt": "2025-12-16T20:48:03.910Z",
  "aiRecommendation": "L'agente ha appena inviato il messaggio iniziale oggi (0 giorni fa) e il lead non ha ancora avuto il tempo di leggerlo o di rispondere. Inviare un follow-up immediatamente oggi stesso sarebbe troppo aggressivo e controproducente. Ãˆ fondamentale concedere al lead il tempo necessario per elaborare il primo messaggio. Programmare il follow-up per domani Ã¨ l'approccio migliore per mantenere un tono professionale e non pressante, dando al contempo seguito all'iniziale contatto."
}
âœ… [FOLLOWUP-ENGINE] Conversation state updated successfully
ğŸ“… [FOLLOWUP-SCHEDULER] Scheduled follow-up for adbdde03-ed2e-4e4c-ae70-bfe503805caf at 2025-12-17T10:00:00.000Z (AI decision with rule "AI Follow-up Intelligente (entro 24h)")
[FOLLOWUP-SCHEDULER] Evaluation Cycle cycle_1765918072889_oteiyv: 11.225s
ğŸ“ˆ [FOLLOWUP-SCHEDULER] ALL evaluation cycle completed
   â±ï¸  Duration: 11224ms
   ğŸ“Š Processed: 1/1
   ğŸŒ¡ï¸  Temperature updates: 1
   ğŸ“… Scheduled: 1
   â­ï¸  Skipped: 0
   ğŸ›‘ Stopped: 0
   âŒ Errors: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle Metrics Report
ğŸ“Š [FOLLOWUP-SCHEDULER] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š [FOLLOWUP-SCHEDULER] Timestamp: 2025-12-16T20:48:04.114Z
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle ID: cycle_1765918072889_oteiyv
ğŸ“Š [FOLLOWUP-SCHEDULER] Type: evaluation_all
ğŸ“Š [FOLLOWUP-SCHEDULER] Duration: 11224ms
ğŸ“Š [FOLLOWUP-SCHEDULER] Processed: 1
ğŸ“Š [FOLLOWUP-SCHEDULER] Success: 1
ğŸ“Š [FOLLOWUP-SCHEDULER] Errors: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Skipped: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Rate Limited: 0
ğŸ“Š [FOLLOWUP-SCHEDULER] Error Rate: 0.0%
ğŸ“Š [FOLLOWUP-SCHEDULER] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8:48:04 PM [express] POST /api/followup/trigger-evaluation 200 in 11430ms :: {"success":true,"messagâ€¦
8:48:05 PM [express] GET /api/followup/activity-log 200 in 608ms :: {"timeline":[{"conversationId":"â€¦
8:48:20 PM [express] GET /api/followup/dashboard-stats 304 in 1416ms :: {"awaitingFollowup":1,"sentTâ€¦
ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...