achale-dev  | 11:53:33 PM [express] GET /api/whatsapp/conversations 304 in 19ms :: {"conversations":[{"id":"45cc673â€¦
0|coachale-dev  | 11:53:33 PM [express] GET /api/whatsapp/conversations/45cc673e-417b-4f06-97d4-194a7b2a4762/messages 3â€¦
0|coachale-dev  | âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
0|coachale-dev  | ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-22T22:54:28.000Z) is older than watermark - keeping current
0|coachale-dev  | ğŸ”– [WATERMARK] Agent FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6) - last processed: 2025-12-22T23:50:23.000Z
0|coachale-dev  | âœ… [WHATSAPP POLLING] No new messages for agent FRT Agent
0|coachale-dev  | ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-22T23:50:23.000Z) is older than watermark - keeping current
0|coachale-dev  |    AI Response length: 167 chars
0|coachale-dev  |    AI Response preview: ```json
0|coachale-dev  | {
0|coachale-dev  |   "isConfirming": false,
0|coachale-dev  |   "date": null,
0|coachale-dev  |   "time": null,
0|coachale-dev  |   "phone": null,
0|coachale-dev  |   "email": null,
0|coachale-dev  |   "name": null,
0|coachale-dev  |   "confidence": "low",
0|coachale-dev  |   "hasAllData": false
0|coachale-dev  | }
0|coachale-dev  | ```
0|coachale-dev  |    Parsed extraction result (raw): hasAllData=false, date=null, time=null
0|coachale-dev  |    ğŸ“Š [ACCUMULATOR] Merged result: date=null, time=null, hasAllData=false
0|coachale-dev  |    ğŸ’¾ [ACCUMULATOR] Updated state: date=null, time=null
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“Š [STEP 3] Data Extraction Results
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¯ Confirmation Status: âŒ NO
0|coachale-dev  | ğŸ“… Date:     âŒ MISSING
0|coachale-dev  | ğŸ• Time:     âŒ MISSING
0|coachale-dev  | ğŸ“ Phone:    âŒ MISSING
0|coachale-dev  | ğŸ“§ Email:    âŒ MISSING
0|coachale-dev  | ğŸ’¯ Confidence: LOW
0|coachale-dev  | âœ”ï¸ Complete Data: âŒ NO - Missing fields
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ”¬ [FIELD VALIDATION] Validazione dettagliata di ogni campo
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“… [DATE VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato una data nella conversazione
0|coachale-dev  | ğŸ• [TIME VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un orario nella conversazione
0|coachale-dev  | ğŸ“ [PHONE VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un numero di telefono nella conversazione
0|coachale-dev  | ğŸ“§ [EMAIL VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un'email nella conversazione
0|coachale-dev  | ğŸ“‹ [RIEPILOGO VALIDAZIONE]
0|coachale-dev  |    â”œâ”€â”€ Campi presenti: 0/4
0|coachale-dev  |    â”œâ”€â”€ Campi mancanti: date, time, phone, email
0|coachale-dev  |    â”œâ”€â”€ hasAllData (dal servizio): false
0|coachale-dev  |    â””â”€â”€ DECISIONE: âŒ ATTENDI piÃ¹ dati dal lead
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â„¹ï¸ [APPOINTMENT BOOKING] Lead is not confirming appointment yet - continue conversation
0|coachale-dev  | âœ”ï¸ [STEP 11] Marking 1 pending messages as processed
0|coachale-dev  | âœ… Processed 1 messages for +393519272875
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â±ï¸  PERFORMANCE BREAKDOWN
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¤– Gemini API Call:          4713ms  (41.6%)
0|coachale-dev  | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0|coachale-dev  | â° TOTAL TIME:              11334ms
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
0|coachale-dev  | âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
0|coachale-dev  | âœ… [WHATSAPP POLLING] Poll cycle complete
0|coachale-dev  | âš¡ [SCHEDULE] Timer fired for +393519272875_7cdfb7ae-d06b-40f6-9840-91f72772a390, enqueueing...
0|coachale-dev  | ğŸ“¥ [ENQUEUE] Adding to queue: +393519272875 for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390
0|coachale-dev  | ğŸ“Š [ENQUEUE] Queue size for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390: 1
0|coachale-dev  | ğŸš€ [ENQUEUE] Starting queue processing for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390
0|coachale-dev  | ğŸ“‹ [PENDING] Found 1 pending messages for conversation 45cc673e-417b-4f06-97d4-194a7b2a4762 (phone: +393519272875)
0|coachale-dev  | â±ï¸ [TIMING] Polling latency: 4.0s (from webhook to processing)
0|coachale-dev  | ğŸ” [PENDING] First message twilioSid: simulated-Ekq44h42ZyUWmfMQS0hZ-, simulated: true, text: "ok..."
0|coachale-dev  | ğŸ” [PARTICIPANT TYPE] unknown
0|coachale-dev  | âœ… [CONFIG] Using agent from conversation: FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6)
0|coachale-dev  | ğŸ¯ [AGENT TYPE] Agent type: reactive_lead, isProactive: false
0|coachale-dev  | âœ… AI is ENABLED and within working hours for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - proceeding with AI response
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ”‘ [STEP 3] Selecting AI Provider (Vertex AI / Google AI Studio)
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ†” Conversation ID: 45cc673e-417b-4f06-97d4-194a7b2a4762
0|coachale-dev  | ğŸ‘¤ User Type: LEAD
0|coachale-dev  | âœ… [SuperAdmin Gemini] Loaded 1 API keys from config
0|coachale-dev  | âœ… Using SuperAdmin Google AI Studio for WhatsApp (Gemini 3)
0|coachale-dev  |    ğŸ”‘ Key: 1/1
0|coachale-dev  | âœ… Selected AI Provider: studio
0|coachale-dev  |    ğŸ” API Key: AIzaSyAzZA...CL20
0|coachale-dev  |    ğŸ†” Key ID: superadm...
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ”‘ [API KEY] Extracted from Google AI Studio provider (key: superadm...)
0|coachale-dev  | ğŸ’¾ [STEP 4] Saving 1 inbound message(s) to database
0|coachale-dev  | âœ… [STEP 4] Saved inbound message 160f389c-17f6-4081-8477-db7431919e5c: "ok..."
0|coachale-dev  | ğŸ’¬ [AUDIO DETECTION] Client sent text message - No audio TTS needed unless always_audio mode
0|coachale-dev  | ğŸ“¸ [STEP 5] Building media context (1 messages)
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¤– [STEP 6] Building AI System Prompt
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ‘¤ Participant Type: UNKNOWN
0|coachale-dev  | ğŸ’¬ Message: "ok"
0|coachale-dev  | ğŸ” Detecting intent for lead message...
0|coachale-dev  | âœ… Intent detected: general
0|coachale-dev  | â­ï¸ [OBJECTION] Objection detection DISABLED (aligned with public share)
0|coachale-dev  | ğŸ‘¤ Fetching/creating lead profile...
0|coachale-dev  | âœ… Lead profile: difficult (difficulty: 8.5/10)
0|coachale-dev  | ğŸ“… [APPOINTMENT CONTEXT] Checking for existing saved slots...
0|coachale-dev  | ğŸ’¾ [APPOINTMENT CONTEXT] Retrieved 9 saved slots from database
0|coachale-dev  | ğŸ“… [APPOINTMENT CONTEXT] Context maintained - AI can continue appointment flow
0|coachale-dev  | âœ… [APPOINTMENT CONTEXT] Final state: 9 slots available for AI prompt
0|coachale-dev  | ğŸ” [PROACTIVE CHECK] conversation.isProactiveLead=false, conversation.proactiveLeadId=null
0|coachale-dev  | â„¹ï¸ [PROACTIVE CHECK] This is a REACTIVE lead (isProactiveLead=false)
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ” [TEMPLATE ENGINE] Checking agent instructions...
0|coachale-dev  |    agentInstructionsEnabled: true
0|coachale-dev  |    agentInstructions length: 14957 chars
0|coachale-dev  |    selectedTemplate: receptionist
0|coachale-dev  | âœ… [TEMPLATE ENGINE] Using CUSTOM TEMPLATE from database
0|coachale-dev  |    Template preview: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¯ RUOLO: RECEPTIONIST VIRTUALE (INBOUND)
0|coachale-dev  | â”â”â”â”â”â”...
0|coachale-dev  | âœ… [FEATURE BLOCKS] Conditional injection summary:
0|coachale-dev  |    - Knowledge Base: DISABLED (no items)
0|coachale-dev  |    - Booking: ENABLED
0|coachale-dev  |    - Objection Handling: DISABLED (removed Dec 2025)
0|coachale-dev  |    - Disqualification: ENABLED
0|coachale-dev  |    - Upselling: DISABLED (no block yet)
0|coachale-dev  | ğŸ“¤ [SYSTEM PROMPT] Ready (26287 chars): "ğŸ“… OGGI Ãˆ: martedÃ¬ 23 dicembre 2025  Sei l'assistente di Protocollo 3M. Il cliente Ã¨ un LEAD CALDO c..."
0|coachale-dev  | ğŸ“š [STEP 7] Checking for reset request and fetching message history
0|coachale-dev  | ğŸ“š [STEP 7] Found 17 historical messages
0|coachale-dev  | ğŸ§  [STEP 8] Calling Gemini AI (model selection based on provider)
0|coachale-dev  | ğŸ“Š [GEMINI TOKENS] Stima PRIMA della chiamata:
0|coachale-dev  |    ğŸ“ System Prompt: ~6,572 tokens (26,287 chars)
0|coachale-dev  |    ğŸ’¬ User Message: ~1 tokens (2 chars)
0|coachale-dev  |    ğŸ“œ History: ~1,102 tokens (4,405 chars)
0|coachale-dev  |    ğŸ”¢ TOTALE INPUT: ~7,675 tokens
0|coachale-dev  | â„¹ï¸ [FILE SEARCH] No FileSearchStore available (no agent or consultant store)
0|coachale-dev  | ğŸ”„ [RETRY] Attempt 1/3
0|coachale-dev  |    ğŸ§  [AI] Google AI Studio - Using model: gemini-3-flash-preview, thinking: enabled (low)
0|coachale-dev  | 11:53:38 PM [express] GET /api/whatsapp/conversations 200 in 26ms :: {"conversations":[{"id":"45cc673â€¦
0|coachale-dev  | 11:53:38 PM [express] GET /api/whatsapp/conversations/45cc673e-417b-4f06-97d4-194a7b2a4762/messages 2â€¦
0|coachale-dev  | âœ… [RETRY] Success on attempt 1!
0|coachale-dev  | â±ï¸  [TIMING] Gemini API call: 1216ms
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ” [DEBUG] Analyzing Gemini Response Object
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“¦ Response object keys: [
0|coachale-dev  |   'sdkHttpResponse',
0|coachale-dev  |   'candidates',
0|coachale-dev  |   'modelVersion',
0|coachale-dev  |   'responseId',
0|coachale-dev  |   'usageMetadata'
0|coachale-dev  | ]
0|coachale-dev  | âœ… response.text is a property - using it...
0|coachale-dev  | ğŸ“ Extracted text length: 140
0|coachale-dev  | ğŸ“ Extracted text preview: Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.
0|coachale-dev  | Ti va meglio mattina o pomeriggio? cosÃ¬ controllo gli slot liberi! ğŸ˜Š
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“Š [WHATSAPP AI] Token Breakdown for agent "FRT Agent":
0|coachale-dev  |    â”œâ”€â”€ System Prompt: 6,572 tokens
0|coachale-dev  |    â”œâ”€â”€ Conversation History: 1,273 tokens
0|coachale-dev  |    â”œâ”€â”€ User Message: 1 tokens
0|coachale-dev  |    â””â”€â”€ TOTAL INPUT: 7,846 tokens
0|coachale-dev  | ğŸ“Š [GEMINI TOKENS] Utilizzo DOPO la risposta:
0|coachale-dev  |    âœ… Response: ~35 tokens (140 chars)
0|coachale-dev  |    ğŸ”¢ TOTALE (input + output): ~7,710 tokens
0|coachale-dev  |    â±ï¸  Tempo di risposta: 1216ms
0|coachale-dev  |    ğŸ’° Costo stimato: $0.015420 (input + output)
0|coachale-dev  | âœ… [STEP 8] Gemini response received: "Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.
0|coachale-dev  | Ti va meglio mattina o pomeri..."
0|coachale-dev  | ğŸ’¾ [STEP 9] Saving AI response to database
0|coachale-dev  | âœ… [STEP 9] AI response saved with ID: bc98a98f-a413-45e5-9121-058e9c2c5c94 (timing: 1216ms Gemini, 1359ms total)
0|coachale-dev  | ğŸ›ï¸ [AUDIO DECISION] Mode: always_text, ClientSentAudio: false â†’ sendAudio=false, sendText=true
0|coachale-dev  | ğŸ“ [TTS SKIP] TTS disabled or not needed (ttsEnabled=false, mode=always_text, clientAudio=false)
0|coachale-dev  | ğŸ“¤ [STEP 10] Sending WhatsApp message to +393519272875
0|coachale-dev  | âœ… Using agent from existing conversation: FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6)
0|coachale-dev  | ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
0|coachale-dev  | ğŸ”’ DRY RUN MODE - Agent: FRT Agent
0|coachale-dev  | ğŸ”’ No real messages will be sent (simulated only)
0|coachale-dev  | ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
0|coachale-dev  | ğŸ“± Using From number: whatsapp:+393505720813 (Agent: FRT Agent)
0|coachale-dev  | ğŸ“¤ [DRY RUN] Would send WhatsApp message as plain text
0|coachale-dev  | ğŸ“‹ Message Details:
0|coachale-dev  |    From: whatsapp:+393505720813
0|coachale-dev  |    To: whatsapp:+393519272875
0|coachale-dev  |    Text length: 140 chars
0|coachale-dev  | ğŸ“ Message content:
0|coachale-dev  | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0|coachale-dev  | Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.
0|coachale-dev  | Ti va meglio mattina o pomeriggio? cosÃ¬ controllo gli slot liberi! ğŸ˜Š
0|coachale-dev  | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0|coachale-dev  | âœ… [DRY RUN] Simulated plain text message: DRY_RUN_PLAINTEXT_1766447618422_zx4cf2
0|coachale-dev  | ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
0|coachale-dev  | âœ… [STEP 10] WhatsApp message sent: text
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ” [BOOKING DECISION] Valutazione pre-requisiti per analisi booking
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  |    ğŸ“‹ PRE-REQUISITI:
0|coachale-dev  |    â”œâ”€â”€ bookingEnabled: âœ… SÃŒ
0|coachale-dev  |    â”œâ”€â”€ agentHasCalendar: âœ… SÃŒ (Google Calendar connesso)
0|coachale-dev  |    â”œâ”€â”€ effectiveUserId: âœ… ASSENTE (Ã¨ un lead)
0|coachale-dev  |    â””â”€â”€ Agent: FRT Agent
0|coachale-dev  |    ğŸ¯ DECISIONE: âœ… PROCEDERÃ€ con analisi booking
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ’¾ [APPOINTMENT BOOKING] Retrieved 9 proposed slots from database
0|coachale-dev  |    âœ… [ACCUMULATOR] Always proceeding with booking analysis (no pre-check skip)
0|coachale-dev  | ğŸ“… [APPOINTMENT BOOKING] Attempting to extract appointment confirmation from lead message
0|coachale-dev  | ğŸ“Š [EXTRACTION] Retrieved 10 messages for extraction
0|coachale-dev  | ğŸ“… [NEW BOOKING] Using extractBookingDataFromConversation() - aligned with public-share-router.ts
0|coachale-dev  |    ğŸ“š Analyzing 10 messages for new booking...
0|coachale-dev  | ğŸ” Finding AI provider for client 7cdfb7ae-d06b-40f6-9840-91f72772a390 (consultant: 7cdfb7ae-d06b-40f6-9840-91f72772a390)...
0|coachale-dev  | ğŸ“‹ Client preferred AI provider: vertex_admin
0|coachale-dev  | ğŸ” TIER 0: Checking SuperAdmin Gemini Keys (Google AI Studio)...
0|coachale-dev  | âœ… TIER 0: Using SuperAdmin Google AI Studio (Gemini 3)
0|coachale-dev  |    ğŸ”‘ Key: 1/1
0|coachale-dev  | ğŸ” [BOOKING SERVICE] Extracting data from 10 messages
0|coachale-dev  |    Mode: NEW BOOKING
0|coachale-dev  |    Timezone: Europe/Rome
0|coachale-dev  |    Conversation context:
0|coachale-dev  | AI: Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.
0|coachale-dev  | Ti va meglio mattina o pomeriggio? cosÃ¬ controllo gli slot liberi! ğŸ˜Š
0|coachale-dev  | LEAD: ok
0|coachale-dev  | AI: Capisco perfettamente. Avere al proprio fianco la persona giusta che ti sappia guidare e motivare fa tutta la differenza del mondo, specialmente quando la costanza Ã¨ il punto debole. ğŸ¤
0|coachale-dev  | Proprio per questo il nostro approccio non Ã¨ solo "schede", ma un vero affiancamento per renderti indipendente e sicuro di quello che fai.
0|coachale-dev  | Guarda, facciam...
0|coachale-dev  |    ğŸ“¦ [ACCUMULATOR] Loading existing extraction state...
0|coachale-dev  |    ğŸ“¦ [ACCUMULATOR] Loaded existing state: date=null, time=null, phone=null, email=null
0|coachale-dev  |    ğŸ§  [AI] Using model: gemini-2.5-flash, thinking: disabled
0|coachale-dev  | 11:53:43 PM [express] GET /api/whatsapp/conversations 200 in 23ms :: {"conversations":[{"id":"45cc673â€¦
0|coachale-dev  | 11:53:43 PM [express] GET /api/whatsapp/conversations/45cc673e-417b-4f06-97d4-194a7b2a4762/messages 2â€¦
0|coachale-dev  |    AI Response length: 167 chars
0|coachale-dev  |    AI Response preview: ```json
0|coachale-dev  | {
0|coachale-dev  |   "isConfirming": false,
0|coachale-dev  |   "date": null,
0|coachale-dev  |   "time": null,
0|coachale-dev  |   "phone": null,
0|coachale-dev  |   "email": null,
0|coachale-dev  |   "name": null,
0|coachale-dev  |   "confidence": "low",
0|coachale-dev  |   "hasAllData": false
0|coachale-dev  | }
0|coachale-dev  | ```
0|coachale-dev  |    Parsed extraction result (raw): hasAllData=false, date=null, time=null
0|coachale-dev  |    ğŸ“Š [ACCUMULATOR] Merged result: date=null, time=null, hasAllData=false
0|coachale-dev  |    ğŸ’¾ [ACCUMULATOR] Updated state: date=null, time=null
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“Š [STEP 3] Data Extraction Results
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¯ Confirmation Status: âŒ NO
0|coachale-dev  | ğŸ“… Date:     âŒ MISSING
0|coachale-dev  | ğŸ• Time:     âŒ MISSING
0|coachale-dev  | ğŸ“ Phone:    âŒ MISSING
0|coachale-dev  | ğŸ“§ Email:    âŒ MISSING
0|coachale-dev  | ğŸ’¯ Confidence: LOW
0|coachale-dev  | âœ”ï¸ Complete Data: âŒ NO - Missing fields
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ”¬ [FIELD VALIDATION] Validazione dettagliata di ogni campo
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ“… [DATE VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato una data nella conversazione
0|coachale-dev  | ğŸ• [TIME VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un orario nella conversazione
0|coachale-dev  | ğŸ“ [PHONE VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un numero di telefono nella conversazione
0|coachale-dev  | ğŸ“§ [EMAIL VALIDATION]
0|coachale-dev  |    â”œâ”€â”€ Valore: null/undefined
0|coachale-dev  |    â”œâ”€â”€ Presente: âŒ NO
0|coachale-dev  |    â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un'email nella conversazione
0|coachale-dev  | ğŸ“‹ [RIEPILOGO VALIDAZIONE]
0|coachale-dev  |    â”œâ”€â”€ Campi presenti: 0/4
0|coachale-dev  |    â”œâ”€â”€ Campi mancanti: date, time, phone, email
0|coachale-dev  |    â”œâ”€â”€ hasAllData (dal servizio): false
0|coachale-dev  |    â””â”€â”€ DECISIONE: âŒ ATTENDI piÃ¹ dati dal lead
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â„¹ï¸ [APPOINTMENT BOOKING] Lead is not confirming appointment yet - continue conversation
0|coachale-dev  | âœ”ï¸ [STEP 11] Marking 1 pending messages as processed
0|coachale-dev  | âœ… Processed 1 messages for +393519272875
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | â±ï¸  PERFORMANCE BREAKDOWN
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | ğŸ¤– Gemini API Call:          1216ms  (12.7%)
0|coachale-dev  | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0|coachale-dev  | â° TOTAL TIME:               9565ms
0|coachale-dev  | â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0|coachale-dev  | 11:53:48 PM [express] GET /api/whatsapp/conversations 304 in 24ms :: {"conversations":[{"id":"45cc673â€¦
0|coachale-dev  | 11:53:48 PM [express] GET /api/whatsapp/conversations/45cc673e-417b-4f06-97d4-194a7b2a4762/messages 3â€¦
0|coachale-dev  | 11:53:53 PM [express] GET /api/whatsapp/conversations 304 in 22ms :: {"conversations":[{"id":"45cc673â€¦