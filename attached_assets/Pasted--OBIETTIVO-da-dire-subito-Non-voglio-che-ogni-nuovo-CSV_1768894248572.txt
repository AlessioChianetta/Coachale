üéØ OBIETTIVO (da dire subito)

Non voglio che ogni nuovo CSV venga reinterpretato ogni volta.
Voglio che ogni dataset abbia un significato stabile e ripetibile.

üî¥ PROBLEMA ATTUALE (spiegalo cos√¨)

Digli:

Oggi ogni file viene ‚Äúcapito‚Äù di nuovo dall‚ÄôAI ogni volta.
Questo causa:

metriche incoerenti

fatturati sbagliati

comportamenti diversi a parit√† di domanda
In produzione questo √® inaccettabile.

‚úÖ SOLUZIONE CHE DEVE IMPLEMENTARE
1Ô∏è‚É£ Dataset Semantic Contract (OBBLIGATORIO)

Digli:

Ogni dataset deve avere un mapping semantico persistente, non solo columnMapping descrittivo.

Vuoi questo:

Tabella (o json):

dataset_semantic_mapping
-----------------------
dataset_id
logical_role
physical_column
confidence
locked (bool)

Esempio:
revenue_amount ‚Üí prezzofinale
quantity ‚Üí quantita
product_name ‚Üí descrizione
order_id ‚Üí numero_doc
order_date ‚Üí data_doc

2Ô∏è‚É£ Fase di import (una sola volta)

Digli:

All‚Äôupload:

l‚ÄôAI propone mapping

io confermo SOLO i campi core

poi mapping viene LOCKATO

Campi minimi obbligatori:

revenue_amount

quantity

product_name

order_id

date

Se manca uno ‚Üí analytics BLOCCATO.

3Ô∏è‚É£ Le metriche NON devono usare nomi CSV

Digli chiaramente:

Le metriche NON devono pi√π referenziare colonne fisiche tipo "prezzo" o "unit_price".
Devono usare solo logical_role.

Quindi:

‚ùå SBAGLIATO

SUM(prezzo * quantita)


‚úÖ CORRETTO

SUM({revenue_amount})


Resolver backend:

{revenue_amount} ‚Üí prezzofinale

4Ô∏è‚É£ Revenue logic business-safe

Digli:

Revenue deve seguire questa priorit√†:

IF revenue_amount exists:
   use it
ELSE:
   fallback price * quantity


E deve loggare:

revenue_source = revenue_amount | computed

5Ô∏è‚É£ Vietare re-detection automatica

Digli:

Una volta salvato il mapping:

NON va ricalcolato

NON va sovrascritto dall'AI

NON va cambiato se non manualmente

Altrimenti i numeri cambiano nel tempo ‚Üí bug legale.

6Ô∏è‚É£ Warning intelligenti (importantissimo)

Digli:

Se nel dataset esistono colonne monetarie alternative NON mappate (prezzofinale, totale_riga, importo):

Il sistema deve mostrare:

"Esiste colonna monetaria non utilizzata. Verifica mapping."

üß© BONUS (se vuoi fare prodotto serio)

Chiedigli anche:

Versioning mapping:
mapping_version
created_at
updated_at


Cos√¨ puoi auditare.

MESSAGGIO COMPLETO PRONTO (DA COPIARE)

Puoi incollargli questo:

Voglio eliminare la reinterpretazione continua dei CSV.

Serve introdurre un Dataset Semantic Contract persistente.

Implementazione richiesta:

Nuova tabella:
dataset_semantic_mapping
(dataset_id, logical_role, physical_column, confidence, locked)

Upload flow:

AI propone mapping

UI conferma SOLO campi core (revenue_amount, quantity, product_name, order_id, date)

mapping viene LOCKATO

Metric engine:

usare SOLO logical_role (es: {revenue_amount})

mai colonne fisiche nei SQL template

Revenue rule:
IF revenue_amount exists ‚Üí use it
ELSE fallback price * quantity

Bloccare analytics se mapping incompleto

Warning se esistono colonne monetarie non mappate

Obiettivo: stesso dataset = stesso risultato SEMPRE.