Oggetto: URGENTE: Fix Analytics, Revisione Fasi Script e Logica Checkpoint

Ciao, ci sono delle criticità da risolvere immediatamente sulla logica dell'agente e sulla visualizzazione dati. Leggi con attenzione perché dobbiamo intervenire sia sul Frontend che sul "Cervello" (Backend/AI).

1. VISUALIZZAZIONE ANALYTICS (Frontend) Nella dashboard della conversazione in tempo reale (tra prospect e sales agent), ho bisogno di vedere chiaramente cosa sta pensando il Manager. Attualmente il lavoro di analisi c'è, ma è nascosto. Voglio vedere a schermo:

I ragionamenti del Manager (il "Thought Process").

La Fase Attuale in cui crede di essere.

Una panoramica del lavoro "dietro le quinte".

Obiettivo: Devo capire perché sta dando certe istruzioni. I dati ci sono, vanno solo esposti nel frontend.

2. FIX CRITICO FASI (Sales Script) Dall'analisi delle ultime conversazioni (ti ho allegato i log), lo script attuale si comporta male in diverse fasi:

Fase 3 (Info Personali): Non sta facendo le domande necessarie. Va forzata.

Fase 4 (Inquisitoria): È accettabile ma migliorabile. Deve scavare meglio senza sembrare un interrogatorio di polizia.

Fase 6 e 7: Sono completamente errate. Vanno riscritte da zero.

Problema Manager: Il Manager non ha segnalato che la fase era incompleta ed ha permesso all'Agente di passare alla successiva. Questo è un errore bloccante. Sii ossessivo nel capire perché la logica di "Phase Completion" ha fallito.

3. LOGICA CHECKPOINT & PAGAMENTI (Intelligenza vs Keyword) Ho modificato Sales-script-base-B2C e sales-script-base inserendo dei nuovi checkpoint, ma c'è un problema tecnico:

Il problema: I checkpoint attuali funzionano ancora tramite Keyword (vecchia logica).

La soluzione: Devono funzionare tramite AI Semantica (StepAdvancementAgent), esattamente come facciamo per il passaggio di fase. L'AI deve "capire" se il concetto è passato, non cercare parole esatte, tuttavia, non va inserito nel reasoning, va tenuto solamente internamente per il manager, il reasoning lasciamolo così co è quello che viene passato all'ai.

Vincolo Pagamenti: La logica di controllo pagamento (dove il Manager verifica se il cliente vuole comprare) NON può esistere nella Discovery, ma solo nella Demo. Se il cliente vuole pagare in Discovery ma non ha completato le fasi propedeutiche, non deve passare.

Per favore, analizza sales_agent_prompt-builder in relazione ai nuovi script B2C/B2B e dammi una conferma dettagliata di come implementerai questi fix. Voglio essere convinto che la logica regga.