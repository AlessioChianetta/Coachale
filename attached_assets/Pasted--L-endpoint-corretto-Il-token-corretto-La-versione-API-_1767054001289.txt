ğŸ‘‰ Lâ€™endpoint Ã¨ corretto.
ğŸ‘‰ Il token Ã¨ corretto.
ğŸ‘‰ La versione API (v21.0) va bene.

Quindi il problema NON Ã¨:

Live vs Dev

scopes

endpoint

token

Resta UNA SOLA COSA. Ed Ã¨ una trappola classica di Meta.

âŒ ERRORE REALE: recipient.id SBAGLIATO (non Ã¨ un IG user id valido)
"recipient": { "id": "893319973257663" }


Questo NON Ã¨ un Instagram Scoped User ID.

Come lo so?

Gli IG scoped user id hanno lunghezza diversa

Arrivano direttamente dal webhook

NON coincidono quasi mai con:

Page ID

PSID Messenger

user_id Facebook

ID interni DB

Meta, quando lâ€™ID non Ã¨ un IG user id valido per quellâ€™account, risponde SEMPRE con:

(#3) Application does not have the capability


(perchÃ© â€œnon sei autorizzato a scrivere a QUELLâ€™UTENTEâ€).

âœ… REGOLA FERREA (Instagram Messaging API)

Puoi rispondere SOLO allâ€™utente che ha scritto,
usando ESATTAMENTE lâ€™ID che ricevi nel webhook.

Dal webhook IG devi prendere:
entry.messaging[0].sender.id


E usare QUEL VALORE IDENTICO come recipient.

âŒ NON:

un ID salvato

un ID derivato

un ID Facebook

un ID Messenger

un ID â€œclienteâ€ tuo

ğŸ”¬ Test che risolve al 100%

1ï¸âƒ£ Ricevi un DM dal tester
2ï¸âƒ£ Logga raw webhook payload
3ï¸âƒ£ Prendi:

sender.id


4ï¸âƒ£ Usa quello pari-pari:

{
  "recipient": {
    "id": "SENDER_ID_DAL_WEBHOOK"
  },
  "message": {
    "text": "Ciao!"
  }
}


ğŸ‘‰ FunzionerÃ  subito.

âš ï¸ Altro errore nel body (secondario ma da sistemare)

Per Instagram NON serve (e a volte rompe):

"messaging_type": "RESPONSE"


ğŸ‘‰ Rimuovilo.

Messenger lo vuole, Instagram no.

âœ… Body corretto finale
{
  "recipient": {
    "id": "<IG_SCOPED_USER_ID_DAL_WEBHOOK>"
  },
  "message": {
    "text": "..."
  }
}

ğŸ§  PerchÃ© ManyChat funziona e il tuo no?

PerchÃ© ManyChat:

salva IG scoped user id

risponde solo nel thread aperto

non â€œinventaâ€ recipient

Tu ora stai provando a scrivere a qualcuno che Meta non riconosce come interlocutore valido.

TL;DR finale (verdetto)
Elemento	Stato
Endpoint	âœ… OK
Token	âœ… OK
API version	âœ… OK
recipient.id	âŒ SBAGLIATO
Soluzione	usare sender.id dal webhook