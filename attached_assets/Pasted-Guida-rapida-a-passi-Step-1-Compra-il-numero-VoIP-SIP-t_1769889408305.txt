Guida rapida a passi
Step 1 â€” Compra il numero VoIP + SIP trunk

Attiva un numero italiano (fisso) presso un provider VoIP (es. Messagenet o altro).

Fatti dare:

SIP server / registrar

username / password

eventuale IP whitelist o â€œregistrazioneâ€ richiesta

codec supportati (idealmente PCMU/8000)

Step 2 â€” Prepara la VPS Hostinger

Crea una VPS Linux (consiglio: Ubuntu 22.04).

Assegna IP pubblico.

Apri firewall/porte:

SIP: 5060/udp (o 5080/udp se preferisci)

RTP: 16384â€“32768/udp

Event Socket (ESL): 8021/tcp (solo dal tuo IP)

SSH: 22

Step 3 â€” Installa FreeSWITCH

Installa FreeSWITCH sulla VPS.

Verifica che parta e che il profilo SIP sia attivo.

Step 4 â€” Configura SIP trunk (provider â†’ FreeSWITCH)

Crea un gateway SIP verso il provider.

Configura NAT e IP esterno corretti.

Test: chiamata in ingresso che arriva a FreeSWITCH.

Step 5 â€” Crea un â€œnumero assistenzaâ€ nel dialplan

Regola: quando arriva la chiamata al tuo DID, entra in un context tipo support.

In support:

rispondi

riproduci un messaggio breve

avvia il â€œbridgeâ€ verso Node (cattura audio + controllo chiamata)

Step 6 â€” Collega Node a FreeSWITCH (controllo chiamata)

Abilita Event Socket in FreeSWITCH.

In Node usa una libreria ESL per:

sapere quando entra una chiamata

leggere Caller ID

decidere quale â€œflow AIâ€ usare

riprodurre audio di risposta (TTS) nella chiamata

Step 7 â€” Porta lâ€™audio della chiamata a Node (ingresso verso AI)

Per un MVP robusto e rapido:

FreeSWITCH registra/cattura lâ€™audio (mono 8k) a segmenti brevi (o con VAD).

Node invia lâ€™audio a Gemini (ASR o Live) e genera risposta audio.

Node salva la risposta audio (wav 8k) e la fa riprodurre a FreeSWITCH (playback/broadcast).

Step 8 â€” Fallback e sicurezza

Se AI fallisce â†’ trasferisci a numero umano o voicemail.

Metti rate limit / antifrode:

whitelist di paesi

blocco anonimi

limiti per minuto

Step 9 â€” Test end-to-end

Test inbound da cellulare.

Test latenza, audio, occupato.

Test seconda chiamata (con 1 canale).

Analisi punto per punto (cosa fare e perchÃ©)
1) Numero fisso vs mobile (per â€œassistenzaâ€ e costo minimo)

Per lâ€™Italia, il fisso VoIP Ã¨ quasi sempre la scelta migliore:

piÃ¹ economico

piÃ¹ disponibile

piÃ¹ semplice da attivare

piÃ¹ semplice da collegare a SIP/FreeSWITCH

Il mobile vero (3xx) spesso implica piÃ¹ burocrazia e disponibilitÃ  variabile. Per assistenza, un 02/06 va benissimo.

2) Hostinger: cosa ti serve davvero

Devi avere:

VPS con IP pubblico statico

possibilitÃ  di aprire porte UDP (RTP)

CPU decente (anche 1â€“2 vCPU bastano per iniziare), RAM 2GB ok per MVP

Se sei dietro NAT strano o firewall â€œaggressivoâ€, SIP/RTP diventano un incubo: VPS con IP pubblico pulito = vita facile.

3) Porte e NAT (questa Ã¨ la parte che rompe tutto se sbagli)

Obbligatorio:

SIP UDP 5060 (o 5080)

RTP UDP range (es. 16384â€“32768)

in FreeSWITCH devi impostare:

external_sip_ip

external_rtp_ip

Se questi due sono errati, sentirai:

audio solo da una parte

chiamate che cadono

silenzio dopo risposta

4) PerchÃ© Event Socket (ESL) Ã¨ fondamentale con Node

Con ESL tu da Node puoi:

intercettare eventi â€œCHANNEL_ANSWERâ€, â€œHANGUPâ€

leggere Caller-Caller-ID-Number

decidere â€œquale AI/promptâ€

comandare FreeSWITCH: uuid_broadcast, uuid_transfer, uuid_kill

Ãˆ il â€œtelecom control planeâ€ del tuo agente.

5) Audio: il modo piÃ¹ rapido che funziona (MVP)

Per andare live velocemente, ti consiglio non inseguire subito il full-duplex â€œparlarsi sopra in realtimeâ€.
La soluzione piÃ¹ veloce e stabile Ã¨ turn-based:

Utente parla

Tu catturi 1â€“3 secondi (o fino a pausa)

Node â†’ Gemini â†’ risposta audio

FreeSWITCH riproduce la risposta

Si ripete

Per â€œassistenzaâ€ funziona benissimo, e ti evita settimane di debugging su streaming bidirezionale.

Codec consigliato: PCMU (G.711 Î¼-law) 8k, perchÃ© Ã¨ lo standard PSTN.

6) Come riproduci la risposta AI nella chiamata

Il pattern piÃ¹ semplice:

Node genera WAV 8k mono

Node lo mette su disco (o URL interno)

Node invia comando ESL:

uuid_broadcast <uuid> /path/risposta.wav aleg

Questo Ã¨ il â€œponteâ€ piÃ¹ rapido.

7) Come catturi lâ€™audio della chiamata

Hai 2 strade MVP:

A) Registrazione a chunk

FreeSWITCH registra a file (rolling)

Node legge file e invia a Gemini

B) Media bug / fork verso Node

PiÃ¹ avanzato (e dipende dal modulo scelto)

PiÃ¹ veloce a regime, piÃ¹ complesso da settare bene

Per partire: A) chunk (meno rogne). Poi evolvi a fork/stream.

8) Roadmap â€œupgradeâ€ (quando lâ€™MVP gira)

Quando tutto funziona:

VAD migliore (inizio/fine parlato)

Streaming piÃ¹ realtime (meno latenza)

Multi-canale (piÃ¹ chiamate contemporanee)

Multi-tenant (se lo rivendi)

Checklist finale (se fai solo assistenza e vuoi andare live)

 Numero fisso VoIP italiano con SIP trunk

 VPS con IP pubblico

 FreeSWITCH installato

 SIP trunk registrato e inbound ok

 ESL abilitato e protetto

 Node ESL controller + generazione TTS

 Playback della risposta nella chiamata

 Fallback a umano/voicemail

Dimmi solo 2 cose e ti faccio la guida â€œoperativaâ€ con config pronta

Il tuo provider numero VoIP sarÃ  Messagenet o un altro?

Vuoi che lâ€™AI risponda subito oppure dopo â€œPremi 1 per parlare con lâ€™assistenteâ€?

Se mi rispondi, nel prossimo messaggio ti scrivo:

porte esatte + firewall

snippet di config FreeSWITCH (gateway + dialplan)

skeleton Node (ESL + play audio)
senza farti perdere tempo.

ok, cosa deve fare il mio programmatore sul software e cosa devo fare io per il centralino cosÃ¬ ci smistiamo i compiti


Ottima domanda. Qui si gioca il successo del progetto: separate bene le responsabilitÃ  e vai veloce senza pestarti i piedi.

Ti do la divisione reale da produzione, non teorica.

ğŸ§  TU (INFRA / CENTRALINO / TELEFONIA)

Questa parte Ã¨ telecom + infrastruttura. La devi guidare tu o il tuo sysadmin.

1ï¸âƒ£ Acquistare numero VoIP italiano

Tu fai:

scegli provider (es: Messagenet)

acquisti numero assistenza

ottieni:

SIP server

username

password

codec supportati

Deliverable:
âœ” credenziali SIP
âœ” DID (numero)

2ï¸âƒ£ Preparare VPS Hostinger

Tu fai:

crei VPS Ubuntu 22.04

assegni IP pubblico

apri firewall:

5060 UDP (SIP)
16384â€“32768 UDP (RTP audio)
8021 TCP (Event Socket)
22 TCP (SSH)


Deliverable:
âœ” IP pubblico
âœ” server raggiungibile
âœ” porte aperte

3ï¸âƒ£ Installare FreeSWITCH

Tu fai:

installi FreeSWITCH

verifichi che:

SIP profile attivo

ESL attivo

Deliverable:
âœ” FreeSWITCH running
âœ” console funzionante

4ï¸âƒ£ Collegare SIP provider â†’ FreeSWITCH

Tu configuri:

gateway SIP

inbound routing

NAT

Deliverable:
âœ” se chiami il numero â†’ la chiamata arriva su FreeSWITCH
(anche con solo â€œrisponde e riattaccaâ€ allâ€™inizio)

5ï¸âƒ£ Creare ingresso â€œAIâ€

Tu configuri nel dialplan:

context tipo: ai_support

regola:

quando arriva DID X â†’ entra in ai_support


Deliverable:
âœ” chiamata arriva nel flusso AI (anche senza AI collegata ancora)

ğŸ’» PROGRAMMATORE (NODE + AI + LOGICA)

Questa Ã¨ la parte software product.

1ï¸âƒ£ Controller Event Socket (ESL)

Deve creare un servizio Node che:

si connette a FreeSWITCH su porta 8021

ascolta eventi:

chiamata entrante

answer

hangup

Deliverable:
âœ” Node riceve eventi di chiamata
âœ” vede Caller ID e UUID chiamata

2ï¸âƒ£ Logica di routing AI

Il dev costruisce:

mapping:

numero chiamante â†’ profilo cliente
orario â†’ prompt diverso
fallback â†’ umano


Deliverable:
âœ” decide quale AI usare
âœ” quale prompt caricare

3ï¸âƒ£ Gestione audio verso AI

Il dev implementa:

ricezione audio chiamata (file o stream)

invio audio a Gemini Live

ricezione risposta vocale

salvataggio WAV 8k mono

Deliverable:
âœ” funzione:

input audio â†’ output audio risposta.wav

4ï¸âƒ£ Playback verso FreeSWITCH

Il dev invia comandi ESL:

uuid_broadcast UUID risposta.wav aleg


Deliverable:
âœ” la voce AI esce nella chiamata

5ï¸âƒ£ Gestione stato chiamata

Il dev gestisce:

quando utente parla

quando AI parla

timeout

fine chiamata

error handling

Deliverable:
âœ” chiamata completa end-to-end

6ï¸âƒ£ Logging e Analytics

Minimo indispensabile:

numero chiamante

durata

esito

trascrizione

errori

Deliverable:
âœ” log per debug e billing futuro

ğŸ§© Punto di contatto TRA VOI DUE

Queste cose dovete coordinarle insieme:

Oggetto	Chi decide
Codec audio	TU (FS) + DEV (AI)
Formato WAV	DEV
Porta ESL	TU
IP whitelist	TU
Nome context dialplan	TU
Comandi ESL	DEV
Timeline realistica

Con divisione corretta:

Fase	Tempo
Numero + VPS + FS	1 giorno
SIP trunk funzionante	1 giorno
Node ESL controller base	1 giorno
AI voice loop MVP	1â€“2 giorni

ğŸ‘‰ In 3â€“4 giorni potete avere AI che risponde al telefono.

Errori comuni da evitare

âŒ Dev che tocca SIP/NAT
âŒ Sysadmin che tocca Gemini API
âŒ Mischiare responsabilitÃ 
âŒ Fare streaming full realtime subito (MVP prima)