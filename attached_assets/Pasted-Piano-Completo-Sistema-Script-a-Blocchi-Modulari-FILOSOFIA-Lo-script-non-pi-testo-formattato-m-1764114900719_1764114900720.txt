Piano Completo: Sistema Script a Blocchi Modulari
FILOSOFIA
Lo script non è più "testo formattato" ma un oggetto strutturato composto da moduli indipendenti. Ogni modulo ha un tipo, un contenuto, e regole specifiche.

MODULI IDENTIFICATI
Modulo	Descrizione	Campi
Header	Titolo e metadati script	name, version, type, description
Regole	Regole d'oro, principi generali	title, items[]
Fase	Contenitore di step	number, name, description
Step	Azione specifica	number, name, objective, hasLadder
Domanda	Domanda da porre	text, marker, isKey
Checkpoint	Punto di verifica	description, criteria[]
Biscottino	Rinforzo positivo	trigger, phrase
Transizione	Frase di passaggio	from, to, phrase
STRUTTURA DATI (come verrà salvato)
interface ScriptStructure {
  header: {
    name: string;
    version: string;
    type: 'discovery' | 'demo' | 'objections';
  };
  rules: Array<{
    id: string;
    title: string;
    items: string[];
  }>;
  phases: Array<{
    id: string;
    number: string;
    name: string;
    steps: Array<{
      id: string;
      number: number;
      name: string;
      objective: string;
      questions: Array<{
        id: string;
        text: string;
        marker?: string;
        isKey?: boolean;
      }>;
      biscottini?: Array<{
        trigger: string;
        phrase: string;
      }>;
    }>;
    checkpoints: Array<{
      id: string;
      description: string;
      criteria: string[];
    }>;
    transition?: {
      phrase: string;
    };
  }>;
}

PIANO DI SVILUPPO
FASE 1: Definire i Moduli UI (Componenti React)

ModuleHeader - Editor nome/versione/tipo
ModuleRules - Lista regole modificabili
ModulePhase - Contenitore fase con drag&drop
ModuleStep - Card step con campi editabili
ModuleQuestion - Input domanda con marker
ModuleCheckpoint - Card checkpoint
ModuleBiscottino - Mini-card rinforzo
ModuleTransition - Input frase transizione
FASE 2: Costruire l'Editor a Blocchi

Sostituire la Textarea con la griglia di moduli
Ogni modulo ha pulsanti: Modifica, Sposta, Elimina
Pulsante "Aggiungi" per ogni tipo modulo
Drag & drop per riordinare
FASE 3: Migrazione Dati

Funzione parseTextToStructure() - già esiste, la miglioriamo
Funzione structureToText() - genera il testo dallo struttura (per backup/export)
Lo script viene salvato SOLO come struttura, il testo si genera on-demand
FASE 4: Integrazione Training Map

TrainingMapLayout.tsx già usa effectiveScript.structure
ScriptReferencePanel mostrerà i moduli
Quando modifichi uno script, la mappa si aggiorna automaticamente
FASE 5: Sincronizzazione AI

Il prompt builder legge la struttura, non il testo
Genera il contesto AI dalla struttura dei moduli
FLUSSO UTENTE FINALE
1. Apri Script Manager
2. Vedi lo script come lista di blocchi colorati
3. Clicca su un blocco → si espande per la modifica
4. Modifichi solo quel campo specifico
5. Salva → struttura aggiornata
6. Training Map → mostra automaticamente le modifiche
7. AI → usa la nuova struttura nelle call

DIPENDENZE
Training Map (TrainingMapLayout.tsx) → legge structure.phases
Script Reference Panel → legge structure
AI Prompt Builder → legge structure per generare contesto
Tutti già usano la struttura, non il testo!