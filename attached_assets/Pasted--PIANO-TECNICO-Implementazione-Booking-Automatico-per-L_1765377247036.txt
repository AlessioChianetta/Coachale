ğŸ“‹ PIANO TECNICO: Implementazione Booking Automatico per Link Pubblici
ğŸ¯ OBIETTIVO
Estendere il sistema di booking automatico (attualmente funzionante solo per WhatsApp/Twilio) ai link pubblici condivisi tramite iframe o embed su siti esterni.

ğŸ“Š ARCHITETTURA ATTUALE
Flusso WhatsApp (FUNZIONANTE âœ…)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UTENTE        â”‚â”€â”€â”€â–¶â”‚  TWILIO WEBHOOK  â”‚â”€â”€â”€â–¶â”‚  message-processor.ts   â”‚
â”‚   WhatsApp      â”‚    â”‚                  â”‚    â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â€¢ Riceve messaggio     â”‚
                                                â”‚  â€¢ Genera risposta AI   â”‚
                                                â”‚  â€¢ ESTRAE DATI:         â”‚
                                                â”‚    - Data/Ora           â”‚
                                                â”‚    - Telefono           â”‚
                                                â”‚    - Email              â”‚
                                                â”‚  â€¢ VALIDA disponibilitÃ  â”‚
                                                â”‚  â€¢ CREA evento Calendar â”‚
                                                â”‚  â€¢ INVIA conferma       â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚   GOOGLE CALENDAR API   â”‚
                                                â”‚   Evento creato âœ…      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flusso Link Pubblico (DA IMPLEMENTARE âŒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VISITATORE    â”‚â”€â”€â”€â–¶â”‚  public-share-router â”‚â”€â”€â”€â–¶â”‚  agent-consultant-chat  â”‚
â”‚   (iframe/web)  â”‚    â”‚  .ts                 â”‚    â”‚  -service.ts            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                         â”‚
                                                    â”‚  â€¢ Genera risposta AI âœ…â”‚
                                                    â”‚  â€¢ Salva cronologia âœ…  â”‚
                                                    â”‚                         â”‚
                                                    â”‚  âŒ NO estrazione dati  â”‚
                                                    â”‚  âŒ NO creazione Calendarâ”‚
                                                    â”‚  âŒ NO conferma email   â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”§ SOLUZIONE PROPOSTA
Nuova Architettura con Servizio Condiviso
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BOOKING-SERVICE.TS (NUOVO)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ extractAppointment  â”‚  â”‚ validateAppointment â”‚  â”‚ createCalendarEvent â”‚  â”‚
â”‚  â”‚ Data()              â”‚  â”‚ ()                  â”‚  â”‚ ()                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ sendConfirmation    â”‚  â”‚ checkAvailability   â”‚                           â”‚
â”‚  â”‚ Email()             â”‚  â”‚ ()                  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²                                       â–²
                    â”‚                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚               â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚                       â”‚
â”‚  message-     â”‚       â”‚  public-share-â”‚       â”‚                       â”‚
â”‚  processor.ts â”‚       â”‚  router.ts    â”‚       â”‚                       â”‚
â”‚  (WhatsApp)   â”‚       â”‚  (Link Pubb.) â”‚       â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                       â”‚
        â–²                       â–²               â”‚                       â”‚
        â”‚                       â”‚               â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚                       â”‚
â”‚   TWILIO      â”‚       â”‚   IFRAME/     â”‚       â”‚   GOOGLE CALENDAR     â”‚
â”‚   WhatsApp    â”‚       â”‚   EMBED WEB   â”‚       â”‚         API           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ FILE DA MODIFICARE/CREARE
1. NUOVO FILE: server/services/booking-service.ts
/**
 * Servizio condiviso per booking automatico
 * Utilizzato sia da WhatsApp che da Link Pubblici
 */
import { GoogleGenAI } from "@google/genai";
import { createGoogleCalendarEvent } from "../google-calendar-service";
import { db } from "../db";
import { appointmentBookings, consultantAvailabilitySettings } from "../../shared/schema";
// Interfaccia dati estratti
export interface ExtractedAppointmentData {
  date: string | null;        // "2025-01-15"
  time: string | null;        // "10:00"
  phone: string | null;       // "+39123456789"
  email: string | null;       // "cliente@email.com"
  name: string | null;        // "Mario Rossi"
  hasAllData: boolean;        // true se tutti i dati sono presenti
  confidence: "high" | "medium" | "low";
  isConfirming: boolean;      // true se utente sta confermando
  intent: "NEW_BOOKING" | "MODIFY" | "CANCEL" | "ADD_ATTENDEES" | "NONE";
}
// Funzione 1: Estrazione dati dalla conversazione
export async function extractAppointmentData(
  conversationHistory: Array<{role: string, content: string}>,
  aiClient: GoogleGenAI | any,
  timezone: string = "Europe/Rome"
): Promise<ExtractedAppointmentData> {
  // Prompt AI per estrazione strutturata
  // ... (logica esistente da message-processor.ts)
}
// Funzione 2: Validazione appuntamento
export async function validateAppointment(
  data: ExtractedAppointmentData,
  consultantId: string
): Promise<{valid: boolean; reason?: string}> {
  // Check data futura
  // Check disponibilitÃ  consulente
  // Check conflitti calendario
}
// Funzione 3: Creazione evento calendario
export async function createBooking(
  data: ExtractedAppointmentData,
  consultantId: string,
  source: "whatsapp" | "public_link",
  conversationId: string,
  visitorId?: string
): Promise<{success: boolean; eventId?: string; error?: string}> {
  // Crea record nel DB
  // Crea evento Google Calendar
  // Ritorna risultato
}
// Funzione 4: Invio conferma
export async function sendBookingConfirmation(
  bookingId: string,
  method: "whatsapp" | "email",
  consultantId: string
): Promise<boolean> {
  // Se WhatsApp: usa sendWhatsAppMessage
  // Se email: usa nodemailer/resend
}

2. MODIFICA: server/routes/whatsapp/public-share-router.ts
Posizione: Dopo la generazione della risposta AI (riga ~470)

// DOPO: fullResponse += chunk; (streaming completato)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NUOVO: BOOKING AUTOMATICO PER LINK PUBBLICI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
import { 
  extractAppointmentData, 
  validateAppointment, 
  createBooking,
  sendBookingConfirmation 
} from '../../services/booking-service';
// Dopo che la risposta AI Ã¨ completa, analizza per booking
console.log('\nğŸ“… [PUBLIC-BOOKING] Analyzing conversation for booking data...');
// Recupera cronologia conversazione
const conversationHistory = await db
  .select()
  .from(schema.whatsappAgentConsultantMessages)
  .where(eq(schema.whatsappAgentConsultantMessages.conversationId, conversation.id))
  .orderBy(asc(schema.whatsappAgentConsultantMessages.createdAt));
// Estrai dati appuntamento
const extractedData = await extractAppointmentData(
  conversationHistory.map(m => ({role: m.role, content: m.content})),
  aiProvider.client,
  'Europe/Rome'
);
console.log(`ğŸ“Š Extracted: date=${extractedData.date}, time=${extractedData.time}, email=${extractedData.email}`);
console.log(`âœ… Has all data: ${extractedData.hasAllData}, Confirming: ${extractedData.isConfirming}`);
// Se l'utente sta confermando e abbiamo tutti i dati
if (extractedData.hasAllData && extractedData.isConfirming) {
  
  // Valida appuntamento
  const validation = await validateAppointment(extractedData, agentConfig.consultantId);
  
  if (validation.valid) {
    // Crea booking
    const bookingResult = await createBooking(
      extractedData,
      agentConfig.consultantId,
      'public_link',
      conversation.id,
      visitorId
    );
    
    if (bookingResult.success) {
      console.log(`âœ… [PUBLIC-BOOKING] Appointment created! Event ID: ${bookingResult.eventId}`);
      
      // Invia conferma via email
      if (extractedData.email) {
        await sendBookingConfirmation(bookingResult.bookingId!, 'email', agentConfig.consultantId);
        console.log(`ğŸ“§ [PUBLIC-BOOKING] Confirmation email sent to ${extractedData.email}`);
      }
      
      // Invia evento SSE al client per notifica
      res.write(`data: ${JSON.stringify({ 
        type: 'booking_confirmed', 
        date: extractedData.date,
        time: extractedData.time,
        email: extractedData.email
      })}\n\n`);
    }
  } else {
    console.log(`âŒ [PUBLIC-BOOKING] Validation failed: ${validation.reason}`);
  }
}

3. MODIFICA: server/whatsapp/message-processor.ts
Refactoring: Sostituire la logica duplicata con chiamate al servizio condiviso

// PRIMA (riga ~2619):
// Logica di estrazione inline...
// DOPO:
import { extractAppointmentData, validateAppointment, createBooking } from '../services/booking-service';
// Usa il servizio condiviso
const extracted = await extractAppointmentData(
  conversationHistory,
  aiClient,
  timezone
);
if (extracted.hasAllData && extracted.isConfirming) {
  const validation = await validateAppointment(extracted, conversation.consultantId);
  if (validation.valid) {
    const result = await createBooking(extracted, conversation.consultantId, 'whatsapp', conversation.id);
    // ... gestione risultato
  }
}

ğŸ”„ FLUSSO DETTAGLIATO LINK PUBBLICO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLUSSO BOOKING LINK PUBBLICO                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
1. VISITATORE INVIA MESSAGGIO
   â”œâ”€â”€ "Vorrei prenotare un appuntamento per venerdÃ¬ alle 10"
   â””â”€â”€ POST /public/whatsapp/shares/:slug/message
2. SISTEMA PROCESSA
   â”œâ”€â”€ Valida sessione visitatore
   â”œâ”€â”€ Recupera configurazione agente
   â””â”€â”€ Genera risposta AI (streaming)
3. AI RISPONDE
   â”œâ”€â”€ "Perfetto! Per confermare l'appuntamento di venerdÃ¬ 17 gennaio alle 10:00,
   â”‚    mi serve la tua email per inviarti la conferma."
   â””â”€â”€ Risposta inviata via SSE
4. VISITATORE FORNISCE EMAIL
   â”œâ”€â”€ "La mia email Ã¨ mario.rossi@email.com, confermo l'appuntamento"
   â””â”€â”€ POST /public/whatsapp/shares/:slug/message
5. SISTEMA ANALIZZA (NUOVO)
   â”‚
   â”œâ”€â”€ 5a. ESTRAZIONE DATI
   â”‚   â””â”€â”€ extractAppointmentData() analizza conversazione
   â”‚       â”œâ”€â”€ date: "2025-01-17"
   â”‚       â”œâ”€â”€ time: "10:00"
   â”‚       â”œâ”€â”€ email: "mario.rossi@email.com"
   â”‚       â”œâ”€â”€ phone: null (opzionale per web)
   â”‚       â”œâ”€â”€ hasAllData: true
   â”‚       â””â”€â”€ isConfirming: true
   â”‚
   â”œâ”€â”€ 5b. VALIDAZIONE
   â”‚   â””â”€â”€ validateAppointment()
   â”‚       â”œâ”€â”€ Data futura? âœ…
   â”‚       â”œâ”€â”€ Consulente disponibile? âœ…
   â”‚       â””â”€â”€ Nessun conflitto? âœ…
   â”‚
   â”œâ”€â”€ 5c. CREAZIONE CALENDARIO
   â”‚   â””â”€â”€ createBooking()
   â”‚       â”œâ”€â”€ Inserisce record in appointmentBookings
   â”‚       â”œâ”€â”€ Chiama Google Calendar API
   â”‚       â””â”€â”€ Crea evento con:
   â”‚           â€¢ Titolo: "Appuntamento con Mario Rossi"
   â”‚           â€¢ Data: 17/01/2025 10:00-11:00
   â”‚           â€¢ Invitato: mario.rossi@email.com
   â”‚
   â””â”€â”€ 5d. CONFERMA
       â””â”€â”€ sendBookingConfirmation()
           â”œâ”€â”€ Invia email a mario.rossi@email.com
           â”‚   â””â”€â”€ "Appuntamento confermato! Ti aspettiamo venerdÃ¬..."
           â””â”€â”€ Notifica al consulente
6. RISPOSTA AL VISITATORE
   â”œâ”€â”€ AI: "Perfetto Mario! âœ… Ho creato l'appuntamento per venerdÃ¬ 17 gennaio 
   â”‚        alle 10:00. Ti ho inviato una conferma via email!"
   â””â”€â”€ Evento SSE: { type: 'booking_confirmed', ... }

ğŸ“§ TEMPLATE EMAIL CONFERMA
<!-- server/templates/booking-confirmation.html -->
<!DOCTYPE html>
<html>
<head>
  <style>
    .container { max-width: 600px; margin: 0 auto; font-family: Arial; }
    .header { background: #4F46E5; color: white; padding: 20px; text-align: center; }
    .content { padding: 30px; background: #f9f9f9; }
    .details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
    .detail-row { display: flex; margin: 10px 0; }
    .label { font-weight: bold; width: 120px; }
    .footer { text-align: center; padding: 20px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>âœ… Appuntamento Confermato</h1>
    </div>
    <div class="content">
      <p>Ciao {{customerName}},</p>
      <p>Il tuo appuntamento Ã¨ stato confermato con successo!</p>
      
      <div class="details">
        <div class="detail-row">
          <span class="label">ğŸ“… Data:</span>
          <span>{{appointmentDate}}</span>
        </div>
        <div class="detail-row">
          <span class="label">ğŸ• Ora:</span>
          <span>{{appointmentTime}}</span>
        </div>
        <div class="detail-row">
          <span class="label">ğŸ‘¤ Con:</span>
          <span>{{consultantName}}</span>
        </div>
        <div class="detail-row">
          <span class="label">ğŸ“ Dove:</span>
          <span>{{location}}</span>
        </div>
      </div>
      
      <p>Riceverai un invito Google Calendar all'indirizzo {{customerEmail}}.</p>
      
      <p>Se hai bisogno di modificare o cancellare l'appuntamento, rispondi a questa email.</p>
    </div>
    <div class="footer">
      <p>{{businessName}}</p>
    </div>
  </div>
</body>
</html>

ğŸ“Š SCHEMA DATABASE (giÃ  esistente)
La tabella appointmentBookings Ã¨ giÃ  configurata e supporta entrambi i flussi:

-- Tabella esistente: appointment_bookings
CREATE TABLE appointment_bookings (
  id TEXT PRIMARY KEY,
  consultant_id TEXT NOT NULL,
  conversation_id TEXT,           -- Per WhatsApp
  public_conversation_id TEXT,    -- NUOVO: Per link pubblici
  visitor_id TEXT,                -- NUOVO: ID visitatore web
  
  customer_name TEXT,
  customer_phone TEXT,            -- Obbligatorio per WhatsApp
  customer_email TEXT,            -- Obbligatorio per link pubblici
  
  appointment_date TEXT NOT NULL,
  appointment_time TEXT NOT NULL,
  duration_minutes INTEGER DEFAULT 60,
  
  status TEXT DEFAULT 'confirmed',
  source TEXT DEFAULT 'whatsapp', -- NUOVO: 'whatsapp' | 'public_link'
  
  google_event_id TEXT,
  confirmation_sent_at TIMESTAMP,
  confirmation_method TEXT,       -- 'whatsapp' | 'email'
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

âœ… CHECKLIST IMPLEMENTAZIONE
#	Task	File	PrioritÃ 
1	Creare booking-service.ts con funzioni condivise	server/services/booking-service.ts	ğŸ”´ Alta
2	Estrarre logica da message-processor.ts	server/whatsapp/message-processor.ts	ğŸ”´ Alta
3	Integrare booking in public-share-router.ts	server/routes/whatsapp/public-share-router.ts	ğŸ”´ Alta
4	Creare template email conferma	server/templates/booking-confirmation.html	ğŸŸ¡ Media
5	Aggiungere campi DB se necessario	shared/schema.ts + migrazione	ğŸŸ¡ Media
6	Aggiungere notifica SSE al frontend	client/src/components/...	ğŸŸ¢ Bassa
7	Testing end-to-end	-	ğŸ”´ Alta
â±ï¸ STIMA TEMPI
Fase	Ore stimate
Creazione booking-service.ts	4-6 ore
Refactoring message-processor.ts	2-3 ore
Integrazione public-share-router.ts	3-4 ore
Template email + invio	2-3 ore
Testing e debug	3-4 ore
TOTALE	14-20 ore
ğŸ” DIPENDENZE ESISTENTI
Questi servizi sono giÃ  configurati e funzionanti:

âœ… Google Calendar API (google-calendar-service.ts)
âœ… AI/Gemini per estrazione dati
âœ… Nodemailer/Resend per email
âœ… Database PostgreSQL con tabelle booking