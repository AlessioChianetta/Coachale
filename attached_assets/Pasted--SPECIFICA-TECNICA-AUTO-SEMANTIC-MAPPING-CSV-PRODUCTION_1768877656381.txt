ðŸ“ SPECIFICA TECNICA â€” AUTO SEMANTIC MAPPING CSV (PRODUCTION READY)
Obiettivo

Automatizzare al massimo il mapping colonne CSV â†’ ruoli semantici business
senza compromettere lâ€™affidabilitÃ  delle metriche.

Target UX:

80â€“90% mapping automatico

1â€“2 click di conferma massimo

ZERO calcoli su colonne non validate

1ï¸âƒ£ STEP INGEST PIPELINE

Quando viene caricato un CSV:

1.1 Analisi colonne (AI + regole)

Per ogni colonna estrarre:

column_name

sample_values (20 righe)

inferred_type (number, date, text)

candidate_logical_roles[]

confidence_score per ruolo

Esempio output:

{
  "column": "unit_price",
  "type": "number",
  "candidates": [
    { "role": "price", "confidence": 0.96 },
    { "role": "cost", "confidence": 0.12 }
  ]
}

2ï¸âƒ£ CLASSIFICAZIONE RUOLI SEMANTICI

Definire vocabolario fisso:

Core roles (critici)
price
cost
quantity
order_date
order_id
customer_id

Dimension roles
product_name
product_category
payment_method
staff
table_id

Financial roles
discount_percent
tax_rate

3ï¸âƒ£ AUTO APPROVAL LOGIC

Implementare questa logica:

3.1 Auto-approve sicuro

Se:

confidence â‰¥ 0.90

ruolo NON Ã¨ core critical

ðŸ‘‰ auto-map

3.2 Core critical confirmation

Per questi ruoli:

price
cost
quantity
order_date


Regola:

ðŸ‘‰ anche se confidence = 0.99
ðŸ‘‰ richiedere 1 click di conferma UI

3.3 AmbiguitÃ 

Se:

2 candidate roles con confidence > 0.70

ðŸ‘‰ blocco
ðŸ‘‰ richiedere scelta manuale

3.4 Low confidence

Se:

confidence < 0.70

ðŸ‘‰ non mappare
ðŸ‘‰ mostra errore UI

4ï¸âƒ£ PERSISTENZA SEMANTICA

Creare tabella:

dataset_column_semantics
dataset_id
physical_column
logical_role
confidence
auto_approved BOOLEAN
confirmed_by_user BOOLEAN
timestamp

5ï¸âƒ£ METRIC ENGINE CONSUMPTION RULE

Metric registry NON deve usare:

unit_price
quantity


Ma solo:

{price}
{quantity}


Resolver:

logical_role â†’ physical_column


Se logical_role non presente:

ðŸ‘‰ blocco metrica

6ï¸âƒ£ HARD FAIL RULES

Sistema deve rifiutare calcoli se manca:

Metrica	Required roles
revenue	price, quantity
food_cost	cost, quantity
ticket_medio	price, quantity
order_count	order_id
avg_orders_per_customer	customer_id, order_id

Errore UX:

"Impossibile calcolare: manca mappatura campo COST"

7ï¸âƒ£ UI FLOW (MINIMA)
Step 1 â€” Auto mapping

Mostrare:

âœ” 7 colonne mappate automaticamente
âš  2 colonne richiedono conferma

Step 2 â€” Conferma rapida

Mostrare SOLO:

price

cost

quantity

order_date

UI tipo:

Abbiamo rilevato:
unit_price â†’ Prezzo di vendita
[ Conferma ] [ Cambia ]

Step 3 â€” Lock mapping

Dopo conferma:

mapping congelato

metriche abilitate

8ï¸âƒ£ SAFE FALLBACK

Se utente salta mapping:

ðŸ‘‰ dataset resta:

analytics_disabled = true


Consentito:

preview schema

NON consentito:

metriche

AI analytics

9ï¸âƒ£ LOGGING OBBLIGATORIO

Loggare:

mapping automatico

mapping manuale

metric failures per missing role

Serve per:

debugging

migliorare AI mapping

10ï¸âƒ£ QUALITY METRIC INTERNE

Track KPI:

KPI	Target
Auto mapping rate	>80%
Manual corrections	<15%
Metric fail rate	<3%
RISULTATO FINALE

Con questa architettura ottieni:

âœ… automazione vera
âœ… controllo umano minimo
âœ… metriche affidabili
âœ… scalabilitÃ  SaaS
âœ… difesa da CSV sporchi