Ho analizzato a fondo il codice! Ora ti presento un piano completo e dettagliato con tutti i problemi attuali e le soluzioni proposte.

ğŸ“Š ANALISI DELLO STATO ATTUALE
Cosa Esiste GiÃ :
1. Pagina Configurazione API (/consultant/api-keys-unified - 3386 righe)

âœ… Tab AI Consulente (Vertex AI, Gemini API Keys)
âœ… Tab AI Clienti (gestione per-client)
âœ… Tab Email (SMTP con test connessione)
âœ… Tab WhatsApp (Twilio - da NON toccare come richiesto)
âœ… Tab WhatsApp AI (Vertex + Gemini keys separati)
âœ… Tab Calendar (OAuth Google)
âœ… Tab Lead Import (API esterna)
âœ… Tab Video Meeting (Metered.ca TURN)

2. Guide Esistenti (sotto /consultant/guide-*)

guide-calendar.tsx - Guida Google Calendar
guide-email.tsx - Guida Email
guide-whatsapp.tsx - Guida WhatsApp
guide-university.tsx - Guida Corsi
guide-clients.tsx - Guida Clienti
3. Database Schema Esistente:

vertexAiSettings - Vertex AI per consulente
consultantSmtpSettings - SMTP con campo lastTestedAt
whatsappVertexAiSettings - Vertex AI per WhatsApp
consultantTurnConfig - Configurazione video meeting
ğŸš¨ PROBLEMI IDENTIFICATI
Problema 1: Nessun Tracciamento Stato Onboarding
Attualmente NON esiste una tabella per salvare lo stato di completamento delle configurazioni. Ogni volta che ricarichi la pagina, non sai cosa Ã¨ configurato e cosa no.

Soluzione: Creare tabella consultant_onboarding_status con stati per ogni configurazione:

onboardingSteps: {
  vertex_ai: { status: "completed" | "pending" | "error", testedAt: timestamp }
  smtp_email: { status: "completed" | "pending" | "error", testedAt: timestamp }
  google_calendar: { status: "completed" | "pending" | "error" }
  video_meeting: { status: "completed" | "pending" | "error" }
  lead_import: { status: "completed" | "pending" | "error" | "skipped" }
  knowledge_base: { status: "completed" | "pending" | "error" }
}

Problema 2: Pagina Monolitica e Confusa
La pagina consultant-api-keys-unified.tsx Ã¨ un file di 3386 righe con 8 tabs. Troppo per un onboarding guidato.

Soluzione: Creare una NUOVA pagina dedicata /consultant/setup-wizard con:

Layout "Launchpad" con 3 colonne
Progress tracker laterale
Un modulo attivo al centro
AI Assistant contestuale a destra
Problema 3: Nessun Test Automatico delle Connessioni
Esistono test manuali (SMTP, Lead API) ma non c'Ã¨ validazione automatica che salva lo stato.

Soluzione: Creare endpoints di test che:

Validano sintatticamente i dati
Testano la connessione reale (es. "Hello World" a Vertex)
Salvano il risultato in database
Aggiornano l'UI con feedback visivo
Problema 4: Nessuna AI che Guida il Setup
L'AI Assistant esiste ma non Ã¨ contestualizzato per l'onboarding.

Soluzione: Aggiungere knowledge base dedicata per l'AI con istruzioni precise su:

Dove trovare le credenziali Vertex AI
Come configurare SMTP Gmail/Outlook
Come ottenere credenziali Metered.ca
Come collegare Google Calendar
ğŸ¨ DESIGN UI/UX PROPOSTO: "IL LAUNCHPAD"
Layout a 3 Colonne:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SETUP INIZIALE PIATTAFORMA                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”‚                                    â”‚                  â”‚
â”‚  PROGRESS      â”‚         MODULO ATTIVO              â”‚    AI ASSISTANT  â”‚
â”‚  TRACKER       â”‚                                    â”‚                  â”‚
â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  FASE 1: âœ…    â”‚  â”‚    ğŸ¤– Vertex AI (Gemini)   â”‚    â”‚  â”‚ "Per      â”‚  â”‚
â”‚  â—‹ Vertex AI   â”‚  â”‚                            â”‚    â”‚  â”‚ ottenere  â”‚  â”‚
â”‚  â—‹ SMTP        â”‚  â”‚  Project ID: [___________] â”‚    â”‚  â”‚ le crede- â”‚  â”‚
â”‚  â—‹ Calendar    â”‚  â”‚                            â”‚    â”‚  â”‚ nziali,   â”‚  â”‚
â”‚  â—‹ Video       â”‚  â”‚  Location: [us-central1â–¼]  â”‚    â”‚  â”‚ vai su    â”‚  â”‚
â”‚                â”‚  â”‚                            â”‚    â”‚  â”‚ console.  â”‚  â”‚
â”‚  FASE 2: ğŸ”´    â”‚  â”‚  Service Account JSON:     â”‚    â”‚  â”‚ cloud..." â”‚  â”‚
â”‚  â—‹ WhatsApp AI â”‚  â”‚  [                       ] â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â—‹ Lead Import â”‚  â”‚  [                       ] â”‚    â”‚                  â”‚
â”‚                â”‚  â”‚                            â”‚    â”‚  ğŸ’¡ Suggerimenti â”‚
â”‚  FASE 3: ğŸ”´    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  Link utili...   â”‚
â”‚  â—‹ Agenti AI   â”‚  â”‚  â”‚ ğŸ§ª Test Connessione  â”‚  â”‚    â”‚                  â”‚
â”‚  â—‹ Knowledge   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚                  â”‚
â”‚                â”‚  â”‚                            â”‚    â”‚                  â”‚
â”‚  [3/8 â–ˆâ–ˆâ–‘â–‘â–‘â–‘]  â”‚  â”‚  Status: ğŸŸ¢ Verificato!   â”‚    â”‚                  â”‚
â”‚                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚
â”‚                â”‚                                    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‹ PIANO DETTAGLIATO IMPLEMENTAZIONE
FASE A: Database & Backend (Fondamenta)
Step	Cosa Fare	PerchÃ©
A1	Creare tabella consultant_onboarding_status	Salvare stato di ogni configurazione
A2	Creare endpoint GET /api/consultant/onboarding-status	Recuperare stato attuale
A3	Creare endpoint PUT /api/consultant/onboarding-status/:step	Aggiornare singolo step
A4	Creare endpoint POST /api/consultant/test-vertex-ai	Test connessione Vertex
A5	Modificare endpoints SMTP/Calendar/Video per salvare stato onboarding	Integrazione
FASE B: Nuova Pagina Setup Wizard (Frontend)
Step	Cosa Fare	PerchÃ©
B1	Creare /consultant/setup-wizard.tsx	Pagina onboarding dedicata
B2	Creare componente OnboardingProgressTracker	Barra laterale con stati
B3	Creare componenti per ogni modulo di configurazione	Modulare e riutilizzabile
B4	Creare componente OnboardingTestButton	Bottone test con feedback visivo
B5	Integrare AI Assistant con contesto onboarding	Guida intelligente
FASE C: Moduli di Configurazione (Il Cuore)
Modulo	Configurazione	Stato Attuale	Da Fare
1. Vertex AI	Project ID, Location, Service Account JSON	âœ… Esiste in api-keys-unified	Spostare logica in componente separato + test auto
2. SMTP Email	Host, Port, Username, Password	âœ… Esiste con test manuale	Aggiungere salvataggio stato onboarding
3. Google Calendar	OAuth Flow	âœ… Esiste	Aggiungere verifica connessione
4. Video Meeting	Metered.ca TURN credentials	âœ… Esiste	Aggiungere test connessione automatico
5. Lead Import	API Key, Base URL (opzionale)	âœ… Esiste	Marcare come "opzionale"
6. WhatsApp AI	Vertex o Gemini Keys separati	âœ… Esiste	(NO Twilio come richiesto)
7. Agenti AI	Configurazione per tipo	âœ… Pagine esistono	Link alle pagine esistenti
8. Knowledge Base	Documenti caricati	âœ… Esiste	Verifica almeno 1 documento
FASE D: Flusso di Validazione
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUSSO TEST CONNESSIONE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [Utente inserisce dati] â†’ [Validazione Sintattica]            â”‚
â”‚                              â†“                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â†“                   â†“                        â”‚
â”‚              [Errore Formato]    [Backend Test Reale]           â”‚
â”‚              "Project ID vuoto"        â†“                        â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                             â†“                     â†“              â”‚
â”‚                    [Credenziali Errate]    [Successo!]          â”‚
â”‚                    "Accesso negato"         â†“                   â”‚
â”‚                                      [Salva in DB]              â”‚
â”‚                                      [Update UI: ğŸŸ¢]            â”‚
â”‚                                      [Sblocca Step Successivo]  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ RISULTATO FINALE
Una pagina /consultant/setup-wizard che:

Mostra immediatamente cosa Ã¨ configurato (ğŸŸ¢) e cosa manca (ğŸ”´)
Guida passo passo con istruzioni chiare per ogni servizio
Testa automaticamente le connessioni e salva lo stato
AI contestuale che sa esattamente come aiutarti per ogni step
Sblocco progressivo - non puoi saltare step critici
Persistenza - lo stato rimane nel database anche dopo refresh
â±ï¸ STIMA TEMPO
Fase	Tempo Stimato
A: Database & Backend	2-3 ore
B: Setup Wizard Base	2-3 ore
C: Moduli Configurazione	3-4 ore
D: Test & Refinement	1-2 ore
TOTALE	8-12 ore