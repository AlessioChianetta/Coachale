HATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
ğŸ”– [WATERMARK] Agent Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
âš ï¸ [WHATSAPP POLLING] Skipping consultant c2146759-f08a-430a-afdf-701bbc674300 - incomplete config
8:07:32 PM [express] POST /api/activity/session/heartbeat 200 in 347ms :: {"success":true,"lastActivâ€¦
ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-14T18:11:36.000Z) is older than watermark - keeping current
âœ… [WHATSAPP POLLING] Poll cycle complete
âœ… [FOLLOWUP-ENGINE] Decision: schedule (confidence: 0.95)
   Reasoning: Come Marco, con la mia esperienza, so che 19 minuti sono un tempo assolutamente insufficiente per aspettarsi una risposta a un primo contatto. Il lead non ha avuto nemmeno il tempo di visualizzare e processare il messaggio. Inviare un altro messaggio adesso sarebbe controproducente e percepito come troppo aggressivo. Ãˆ fondamentale dare al lead il giusto spazio e tempo per rispondere. Programmo un follow-up per domani mattina, a un orario adeguato (le 10:00), per dargli una finestra temporale ragionevole per riprendere il contatto. Dato che siamo fuori dalla finestra delle 24 ore e il lead non ha risposto, Ã¨ obbligatorio usare un template per il prossimo messaggio. UserÃ² il secondo template disponibile, assumendo che sia una versione di follow-up o un'alternativa per mantenere vivo l'interesse.
   Latency: 21093ms
ğŸ“ [FOLLOWUP-ENGINE] Logging decision for conversation 1c158920-2cad-4274-98dc-0adbb5ca61e8
âœ… [FOLLOWUP-ENGINE] Decision logged successfully
âš ï¸ [FOLLOWUP-SCHEDULER] Lead mai risposto - finestra 24h non ancora aperta, richiesto template approvato
âœ… [FOLLOWUP-SCHEDULER] Trovati 2 template Twilio approvati - AI selezionerÃ  il migliore
ğŸ¯ [FOLLOWUP-SCHEDULER] Outside 24h/Lead never responded - using AI to select best template
ğŸ“‹ [TEMPLATE-AI] Fetching all approved templates for agent: 760bb513-098f-4722-b02a-a700160c2fc3
ğŸ“‹ [TEMPLATE-AI] Found 2 templates for AI selection
ğŸ¯ [TEMPLATE-AI] Selecting best template for conversation with 2 options
ğŸ”„ [TEMPLATE-AI] Attempt 1/3
ğŸ” Finding AI provider for client 0c73bbe5-51e1-4108-866b-6be7a52fce3b (consultant: 0c73bbe5-51e1-4108-866b-6be7a52fce3b)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Vertex AI eligibility...
ğŸ“‹ User 0c73bbe5-51e1-4108-866b-6be7a52fce3b is the consultant themselves
âœ… Consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b can use SuperAdmin Vertex AI
ğŸ” Looking for SuperAdmin Vertex AI configuration...
ğŸ“‹ Found SuperAdmin Vertex AI config: project=gen-lang-client-0278434337, location=us-central1
âœ… Parsed credentials as plaintext JSON
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… Created SuperAdmin Vertex AI client successfully
âœ… TIER 0: Successfully created SuperAdmin Vertex AI client
ğŸ¤– [TEMPLATE-AI] Using AI provider: Vertex AI (SuperAdmin)
âŒ [TEMPLATE-AI] Attempt 1 failed: ClientError: [VertexAI.ClientError]: got status: 400 Bad Request. {"error":{"code":400,"message":"Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini","status":"INVALID_ARGUMENT"}}
    at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:47:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    ... 5 lines matching cause stack trace ...
    at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
  stackTrace: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  },
  [cause]: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  }
}
â³ [TEMPLATE-AI] Waiting 1000ms before retry...
ğŸ”„ [TEMPLATE-AI] Attempt 2/3
ğŸ” Finding AI provider for client 0c73bbe5-51e1-4108-866b-6be7a52fce3b (consultant: 0c73bbe5-51e1-4108-866b-6be7a52fce3b)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Vertex AI eligibility...
ğŸ“‹ User 0c73bbe5-51e1-4108-866b-6be7a52fce3b is the consultant themselves
âœ… Consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b can use SuperAdmin Vertex AI
ğŸ” Looking for SuperAdmin Vertex AI configuration...
ğŸ“‹ Found SuperAdmin Vertex AI config: project=gen-lang-client-0278434337, location=us-central1
âœ… Parsed credentials as plaintext JSON
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… Created SuperAdmin Vertex AI client successfully
âœ… TIER 0: Successfully created SuperAdmin Vertex AI client
ğŸ¤– [TEMPLATE-AI] Using AI provider: Vertex AI (SuperAdmin)
âŒ [TEMPLATE-AI] Attempt 2 failed: ClientError: [VertexAI.ClientError]: got status: 400 Bad Request. {"error":{"code":400,"message":"Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini","status":"INVALID_ARGUMENT"}}
    at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:47:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    ... 5 lines matching cause stack trace ...
    at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
  stackTrace: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  },
  [cause]: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  }
}
â³ [TEMPLATE-AI] Waiting 2000ms before retry...
ğŸ”„ [TEMPLATE-AI] Attempt 3/3
ğŸ” Finding AI provider for client 0c73bbe5-51e1-4108-866b-6be7a52fce3b (consultant: 0c73bbe5-51e1-4108-866b-6be7a52fce3b)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Vertex AI eligibility...
ğŸ“‹ User 0c73bbe5-51e1-4108-866b-6be7a52fce3b is the consultant themselves
âœ… Consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b can use SuperAdmin Vertex AI
ğŸ” Looking for SuperAdmin Vertex AI configuration...
ğŸ“‹ Found SuperAdmin Vertex AI config: project=gen-lang-client-0278434337, location=us-central1
âœ… Parsed credentials as plaintext JSON
ğŸš€ Creating VertexAI instance with Service Account credentials
  - project: gen-lang-client-0278434337
  - location: us-central1
  - model: gemini-2.5-flash
  - credentials: vertex-ai-service-account@gen-lang-client-0278434337.iam.gserviceaccount.com
âœ… VertexAI instance created successfully
ğŸ”§ Getting Generative Model...
âœ… GenerativeModel created successfully
âœ… Created SuperAdmin Vertex AI client successfully
âœ… TIER 0: Successfully created SuperAdmin Vertex AI client
ğŸ¤– [TEMPLATE-AI] Using AI provider: Vertex AI (SuperAdmin)
âŒ [TEMPLATE-AI] Attempt 3 failed: ClientError: [VertexAI.ClientError]: got status: 400 Bad Request. {"error":{"code":400,"message":"Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini","status":"INVALID_ARGUMENT"}}
    at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:47:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    ... 5 lines matching cause stack trace ...
    at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
  stackTrace: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  },
  [cause]: GoogleApiError: Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini
      at throwErrorIfNotOK (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/post_fetch_processing.ts:49:9)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async generateContent (/home/runner/workspace/node_modules/@google-cloud/vertexai/src/functions/generate_content.ts:94:3)
      at async VertexAIClientAdapter.generateContent (/home/runner/workspace/server/ai/provider-factory.ts:70:20)
      at async selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:620:26)
      at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
      at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
      at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5) {
    code: 400,
    status: 'INVALID_ARGUMENT',
    errorDetails: undefined
  }
}
âŒ [FOLLOWUP-SCHEDULER] AI template selection failed - NOT using priority fallback: Error: Template AI selection failed after 3 attempts: [VertexAI.ClientError]: got status: 400 Bad Request. {"error":{"code":400,"message":"Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini","status":"INVALID_ARGUMENT"}}
    at selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:665:9)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
    at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
    at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5)
âŒ [FOLLOWUP-SCHEDULER] Error evaluating conversation 1c158920-2cad-4274-98dc-0adbb5ca61e8: Error: Template AI selection failed after 3 attempts: [VertexAI.ClientError]: got status: 400 Bad Request. {"error":{"code":400,"message":"Unable to submit request because at least one contents field is required. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini","status":"INVALID_ARGUMENT"}}
    at selectBestTemplateWithAI (/home/runner/workspace/server/ai/followup-decision-engine.ts:665:9)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async evaluateConversation (/home/runner/workspace/server/cron/followup-scheduler.ts:1405:29)
    at async runFollowupEvaluation (/home/runner/workspace/server/cron/followup-scheduler.ts:390:24)
    at async <anonymous> (/home/runner/workspace/server/routes/followup-api.ts:1686:5)
[FOLLOWUP-SCHEDULER] Evaluation Cycle cycle_1766002038916_656z5r: 27.786s
ğŸ“ˆ [FOLLOWUP-SCHEDULER] ALL evaluation cycle completed
   â±ï¸  Duration: 27786ms
   ğŸ“Š Processed: 0/1
   ğŸŒ¡ï¸  Temperature updates: 0
   ğŸ“… Scheduled: 0
   â­ï¸  Skipped: 0
   ğŸ›‘ Stopped: 0
   âŒ Errors: 1
ğŸ“Š [FOLLOWUP-SCHEDULER] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle Metrics Report
ğŸ“Š [FOLLOWUP-SCHEDULER] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š [FOLLOWUP-SCHEDULER] Timestamp: 2025-12-17T20:07:46.703Z
ğŸ“Š [FOLLOWUP-SCHEDULER] Cycle ID: cycle_1766002038916_656z5r
ğŸ“Š [FOLLOWUP-SCHEDULER] Type: evaluation