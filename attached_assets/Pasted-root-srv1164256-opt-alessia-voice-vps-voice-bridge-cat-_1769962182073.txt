root@srv1164256:/opt/alessia-voice/vps-voice-bridge# cat > /tmp/patch.txt << 'ENDPATCH'
    // AUTO-START SESSION FROM URL QUERY (mod_audio_stream sends binary audio, no "start" JSON)
    const q = url.query;
    const callId = typeof q.call_id === 'string' ? q.call_id : '';
    const callerId = typeof q.caller_id === 'string' ? q.caller_id : 'unknown';
    const calledNumber = typeof q.called_number === 'string' ? q.called_number : '9999';
    const sampleRate = typeof q.sample_rate === 'string' ? parseInt(q.sample_rate, 10) : 8000;
    const codecQ = typeof q.codec === 'string' ? q.codec.toUpperCase() : 'PCMU';
    if (callId) {
      log.info('Auto-starting session from query params', { callId, callerId, calledNumber, codec: codecQ, sampleRate });
      
      const startMsg: AudioStreamStartMessage = {
        event: 'start',
        call_id: callId,
        caller_id: callerId,
        called_number: calledNumber,
        codec: codecQ === 'L16' ? 'L16' : 'PCMU',
        sample_rate: Number.isFinite(sampleRate) ? sampleRate : 8000,
      };
      handleCallStart(ws, startMsg).then((sid) => {
        currentSessionId = sid;
        log.info('Session started from query', { sessionId: sid.slice(0, 8) });
      }).catch((e) => {
        log.error('Failed to start session from query', { error: e?.message || String(e) });
        ws.close(1011, 'Session init failed');
      });
    }
ENDPATCH
# Inserisci dopo la riga con "let currentSessionId"
sed -i '/let currentSessionId: string | null = null;/r /tmp/patch.txt' src/voice-bridge-server.ts
# Ricompila e riavvia
pkill -9 -f node
npm run build && npm start &
[1] 842462
root@srv1164256:/opt/alessia-voice/vps-voice-bridge# 
> alessia-voice-bridge@1.0.0 build
> tsc


> alessia-voice-bridge@1.0.0 start
> node dist/index.js

2026-02-01T16:09:34.710Z [INFO ] [BRIDGE:AUDIO] Audio converter initialized mulawTableSize=65792

╔═══════════════════════════════════════════════════════════════╗
║                                                               ║
║     █████╗ ██╗     ███████╗███████╗███████╗██╗ █████╗         ║
║    ██╔══██╗██║     ██╔════╝██╔════╝██╔════╝██║██╔══██╗        ║
║    ███████║██║     █████╗  ███████╗███████╗██║███████║        ║
║    ██╔══██║██║     ██╔══╝  ╚════██║╚════██║██║██╔══██║        ║
║    ██║  ██║███████╗███████╗███████║███████║██║██║  ██║        ║
║    ╚═╝  ╚═╝╚══════╝╚══════╝╚══════╝╚══════╝╚═╝╚═╝  ╚═╝        ║
║                                                               ║
║              VOICE BRIDGE - FreeSWITCH ↔ Gemini               ║
║                                                               ║
╚═══════════════════════════════════════════════════════════════╝

2026-02-01T16:09:34.715Z [INFO ] [BRIDGE:MAIN] Configuration loaded:
2026-02-01T16:09:34.715Z [INFO ] [BRIDGE:MAIN]   WebSocket Server: 0.0.0.0:9090
2026-02-01T16:09:34.715Z [INFO ] [BRIDGE:MAIN]   Auth Token: configured
2026-02-01T16:09:34.715Z [INFO ] [BRIDGE:MAIN]   Replit WS: wss://ecd62906-8d14-4db7-b8da-31957459c644-00-be9rk8l4u13l.riker.replit.dev/ws/ai-voice
2026-02-01T16:09:34.716Z [INFO ] [BRIDGE:MAIN]   Voice: Puck
2026-02-01T16:09:34.716Z [INFO ] [BRIDGE:MAIN]   Max Concurrent Calls: 10
2026-02-01T16:09:34.716Z [INFO ] [BRIDGE:MAIN]   Session Timeout: 120000ms
2026-02-01T16:09:34.716Z [INFO ] [BRIDGE:MAIN]   Log Level: debug
2026-02-01T16:09:34.716Z [INFO ] [BRIDGE:MAIN] Starting Voice Bridge Server...
2026-02-01T16:09:34.724Z [INFO ] [BRIDGE:SERVER] Voice Bridge Server started host=0.0.0.0 port=9090 authRequired=true maxConcurrent=10
2026-02-01T16:09:34.724Z [INFO ] [BRIDGE:SERVER] Health check: http://0.0.0.0:9090/health