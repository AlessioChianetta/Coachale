ğŸ”´ SITUAZIONE ATTUALE: "Il Sistema Cieco"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COME FUNZIONA OGGI                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   ğŸ“§ Proactive Lead                                                      â”‚
â”‚        â”‚                                                                 â”‚
â”‚        â–¼                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  Messaggio  â”‚â”€â”€â”€â”€â–¶â”‚   Twilio    â”‚â”€â”€â”€â”€â–¶â”‚
Planned document structure and phases
ğŸ“– Piano Completo: Sistema Follow-up Intelligente

ğŸ”´ SITUAZIONE ATTUALE (Come funziona OGGI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLUSSO ATTUALE (BUGGATO)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Lead importato          Messaggio 1              Messaggio 2 (Follow-up)
       â”‚                  (Apertura)                    â”‚
       â–¼                      â”‚                         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Proactiveâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚whatsapp â”‚              â”‚scheduled â”‚
  â”‚ Outreach â”‚           â”‚Messages â”‚              â”‚Followup  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  âœ…     â”‚              â”‚Messages  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  CHAT   â”‚              â”‚  CHAT   â”‚
                         â”‚ VISIBILEâ”‚              â”‚  âŒ NO  â”‚ â—„â”€â”€ BUG!
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  PROBLEMA: Il follow-up viene INVIATO ma NON SALVATO nella chat!
âŒ Problemi Attuali:
#
Problema
Impatto
1
Follow-up non salvato in whatsappMessages
Messaggi invisibili nella chat
2
maxFollowupsAllowed = 5 fisso
Non c'Ã¨ logica intelligente
3
Nessun contatore "tentativi senza risposta"
Impossibile sapere quante volte ignorato
4
Nessuna "dormienza" dopo N tentativi
Lead bombardati all'infinito
5
Nessuna esclusione permanente
Spam continuo
6
Nessuna vista di monitoraggio
Non si sa cosa sta succedendo


ğŸŸ¢ SITUAZIONE FUTURA (Come funzionerÃ  DOPO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLUSSO NUOVO (CORRETTO)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚     SISTEMA FOLLOW-UP INTELLIGENTE  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                                   â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  FASE ATTIVA â”‚                    â”‚   DORMIENZA  â”‚                    â”‚  ESCLUSIONE  â”‚
  â”‚  (3 tentativi)â”‚                    â”‚   (3 mesi)   â”‚                    â”‚  PERMANENTE  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                   â”‚
         â–¼                                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tentativo 1  â”‚                    â”‚ Dopo 3 mesi  â”‚
  â”‚ Tentativo 2  â”‚ â”€â”€â–º No risposta â”€â”€â–ºâ”‚ riprova 1x   â”‚â”€â”€â–º No risposta â”€â”€â–º STOP FOREVER
  â”‚ Tentativo 3  â”‚     x3 = STOP      â”‚              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                   â”‚
         â–¼ (Lead risponde)                   â–¼ (Lead risponde)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    RESET!    â”‚                    â”‚    RESET!    â”‚
  â”‚ Riparti da 0 â”‚                    â”‚ Riparti da 0 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ”„ Ciclo di Vita del Lead:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                         â”‚
â”‚  NUOVO â”€â”€â–º MSG1 â”€â”€â–º (attesa) â”€â”€â–º MSG2 â”€â”€â–º (attesa) â”€â”€â–º MSG3 â”€â”€â–º (attesa) â”€â”€â–º DORMIENTE â”‚
â”‚    â”‚                                                                              â”‚      â”‚
â”‚    â”‚                        â–² Lead risponde = RESET                               â”‚      â”‚
â”‚    â”‚                        â”‚                                                     â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            (3 mesi) â”‚      â”‚
â”‚                                                                                   â–¼      â”‚
â”‚                                                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                    â–² Lead risponde = RESET                                 â”‚RIPROVA 1Xâ”‚ â”‚
â”‚                    â”‚                                                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                                   â”‚      â”‚
â”‚                                                                 No risposta â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                                   â–¼      â”‚
â”‚                                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                                        â”‚ MAI PIÃ™ ğŸš«  â”‚  â”‚
â”‚                                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ LE 9 FASI DEL PIANO
FASE 1 - Fix Bug Critico (Salvataggio Messaggi)
PRIMA:  sendWhatsAppMessage() â”€â”€â–º Twilio â”€â”€â–º âŒ Niente in chat
DOPO:   INSERT whatsappMessages â”€â”€â–º sendWhatsAppMessage() â”€â”€â–º Twilio â”€â”€â–º âœ… Visibile in chat
FASE 2 - Nuovi Campi Database
ALTER TABLE conversation_states ADD:
 â”œâ”€â”€ consecutive_no_reply_count (INTEGER) -- Tentativi senza risposta consecutivi
 â”œâ”€â”€ dormant_until (TIMESTAMP)            -- Data fine dormienza
 â”œâ”€â”€ permanently_excluded (BOOLEAN)       -- Mai piÃ¹ contattare
 â”œâ”€â”€ dormant_reason (TEXT)                -- Motivo dormienza
 â””â”€â”€ last_reply_at (TIMESTAMP)            -- Ultima risposta del lead
FASE 3 - Logica Dinamica (via maxFollowupsAllowed fisso)
PRIMA: if (followupCount >= 5) â†’ STOP
DOPO:  if (consecutiveNoReplyCount >= 3) â†’ DORMIENZA
      if (dormantUntil passed && ancora no reply) â†’ PERMANENTE
FASE 4 - Reset Automatico su Risposta
Quando lead risponde:
 â”œâ”€â”€ consecutiveNoReplyCount = 0
 â”œâ”€â”€ dormantUntil = NULL
 â”œâ”€â”€ permanentlyExcluded = FALSE
 â””â”€â”€ lastReplyAt = NOW()
FASE 5 - Logica Dormienza (3 mesi)
Se consecutiveNoReplyCount >= 3:
 â”œâ”€â”€ dormantUntil = NOW() + 3 mesi
 â”œâ”€â”€ dormantReason = "Nessuna risposta dopo 3 tentativi"
 â””â”€â”€ STOP messaggi fino a dormantUntil
FASE 6 - Esclusione Permanente
Se dormantUntil Ã¨ passato E lead non ha risposto:
 â”œâ”€â”€ Invia 1 ultimo tentativo
 â””â”€â”€ Se ancora no risposta â†’ permanentlyExcluded = TRUE â†’ MAI PIÃ™
FASE 7 - Nuova Tab "Stato Follow-up"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š STATO FOLLOW-UP                                        [Aggiorna]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸŸ¢ ATTIVI (12)     ğŸŸ¡ DORMIENTI (5)     ğŸ”´ ESCLUSI (3)                â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Lead           Agente         Stato           Prossima Azione         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mario Rossi    Marco setter   ğŸŸ¢ Attivo       Contatto tra 2 giorni   â”‚
â”‚  Luca Bianchi   Marco setter   ğŸŸ¡ Dormiente    Riprova il 17 Mar 2026  â”‚
â”‚  Anna Verdi     Marco setter   ğŸ”´ Escluso      Mai piÃ¹ (no reply x4)   â”‚
â”‚  Paolo Neri     Marco setter   ğŸŸ¢ Attivo       In attesa risposta      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
FASE 8 - API Endpoint
GET /api/followup/lead-status
Response: {
 leads: [
   {
     name: "Mario Rossi",
     agent: "Marco setter",
     status: "active",
     consecutiveNoReplyCount: 1,
     nextAction: "Contatto tra 2 giorni",
     nextActionDate: "2025-12-19T10:00:00Z",
     reason: "Attesa risposta dopo primo follow-up"
   },
   ...
 ]
}
FASE 9 - Log Dettagliati
ğŸ“ [FOLLOWUP] Lead Mario Rossi: Tentativo 2/3, no risposta
ğŸ“ [FOLLOWUP] Lead Luca Bianchi: 3 tentativi senza risposta â†’ DORMIENZA fino al 2026-03-17
ğŸ“ [FOLLOWUP] Lead Anna Verdi: Dormienza terminata, nessuna risposta â†’ ESCLUSIONE PERMANENTE
ğŸ“ [FOLLOWUP] Lead Paolo Neri: HA RISPOSTO! Reset contatore â†’ 0/3

ğŸ“… TIMELINE STIMATA
Fase
Descrizione
ComplessitÃ 
1
Fix bug salvataggio messaggi
ğŸŸ¢ Bassa
2
Nuovi campi database
ğŸŸ¢ Bassa
3
Logica dinamica
ğŸŸ¡ Media
4
Reset su risposta
ğŸŸ¢ Bassa
5
Logica dormienza
ğŸŸ¡ Media
6
Esclusione permanente
ğŸŸ¡ Media
7
Nuova Tab UI
ğŸŸ¡ Media
8
API endpoint
ğŸŸ¢ Bassa
9
Log dettagliati
ğŸŸ¢ Bassa


