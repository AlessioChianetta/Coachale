Perfetto: Node backend + FreeSWITCH su Hostinger √® un setup sensato. Ti do prima la guida ‚Äústep 1, step 2‚Ä¶‚Äù, poi sotto la spiegazione punto-per-punto (con le scelte migliori per un MVP ‚Äúassistenza‚Äù che funziona davvero).

Presupposto: Hostinger deve essere VPS/Cloud (non hosting condiviso), perch√© FreeSWITCH richiede porte SIP/RTP aperte.

Guida rapida a passi
Step 1 ‚Äî Compra il numero VoIP + SIP trunk

Attiva un numero italiano (fisso) presso un provider VoIP (es. Messagenet o altro).

Fatti dare:

SIP server / registrar

username / password

eventuale IP whitelist o ‚Äúregistrazione‚Äù richiesta

codec supportati (idealmente PCMU/8000)

Step 2 ‚Äî Prepara la VPS Hostinger

Crea una VPS Linux (consiglio: Ubuntu 22.04).

Assegna IP pubblico.

Apri firewall/porte:

SIP: 5060/udp (o 5080/udp se preferisci)

RTP: 16384‚Äì32768/udp

Event Socket (ESL): 8021/tcp (solo dal tuo IP)

SSH: 22

Step 3 ‚Äî Installa FreeSWITCH

Installa FreeSWITCH sulla VPS.

Verifica che parta e che il profilo SIP sia attivo.

Step 4 ‚Äî Configura SIP trunk (provider ‚Üí FreeSWITCH)

Crea un gateway SIP verso il provider.

Configura NAT e IP esterno corretti.

Test: chiamata in ingresso che arriva a FreeSWITCH.

Step 5 ‚Äî Crea un ‚Äúnumero assistenza‚Äù nel dialplan

Regola: quando arriva la chiamata al tuo DID, entra in un context tipo support.

In support:

rispondi

riproduci un messaggio breve

avvia il ‚Äúbridge‚Äù verso Node (cattura audio + controllo chiamata)

Step 6 ‚Äî Collega Node a FreeSWITCH (controllo chiamata)

Abilita Event Socket in FreeSWITCH.

In Node usa una libreria ESL per:

sapere quando entra una chiamata

leggere Caller ID

decidere quale ‚Äúflow AI‚Äù usare

riprodurre audio di risposta (TTS) nella chiamata

Step 7 ‚Äî Porta l‚Äôaudio della chiamata a Node (ingresso verso AI)

Per un MVP robusto e rapido:

FreeSWITCH registra/cattura l‚Äôaudio (mono 8k) a segmenti brevi (o con VAD).

Node invia l‚Äôaudio a Gemini (ASR o Live) e genera risposta audio.

Node salva la risposta audio (wav 8k) e la fa riprodurre a FreeSWITCH (playback/broadcast).

Step 8 ‚Äî Fallback e sicurezza

Se AI fallisce ‚Üí trasferisci a numero umano o voicemail.

Metti rate limit / antifrode:

whitelist di paesi

blocco anonimi

limiti per minuto

Step 9 ‚Äî Test end-to-end

Test inbound da cellulare.

Test latenza, audio, occupato.

Test seconda chiamata (con 1 canale).

Analisi punto per punto (cosa fare e perch√©)
1) Numero fisso vs mobile (per ‚Äúassistenza‚Äù e costo minimo)

Per l‚ÄôItalia, il fisso VoIP √® quasi sempre la scelta migliore:

pi√π economico

pi√π disponibile

pi√π semplice da attivare

pi√π semplice da collegare a SIP/FreeSWITCH

Il mobile vero (3xx) spesso implica pi√π burocrazia e disponibilit√† variabile. Per assistenza, un 02/06 va benissimo.

2) Hostinger: cosa ti serve davvero

Devi avere:

VPS con IP pubblico statico

possibilit√† di aprire porte UDP (RTP)

CPU decente (anche 1‚Äì2 vCPU bastano per iniziare), RAM 2GB ok per MVP

Se sei dietro NAT strano o firewall ‚Äúaggressivo‚Äù, SIP/RTP diventano un incubo: VPS con IP pubblico pulito = vita facile.

3) Porte e NAT (questa √® la parte che rompe tutto se sbagli)

Obbligatorio:

SIP UDP 5060 (o 5080)

RTP UDP range (es. 16384‚Äì32768)

in FreeSWITCH devi impostare:

external_sip_ip

external_rtp_ip

Se questi due sono errati, sentirai:

audio solo da una parte

chiamate che cadono

silenzio dopo risposta

4) Perch√© Event Socket (ESL) √® fondamentale con Node

Con ESL tu da Node puoi:

intercettare eventi ‚ÄúCHANNEL_ANSWER‚Äù, ‚ÄúHANGUP‚Äù

leggere Caller-Caller-ID-Number

decidere ‚Äúquale AI/prompt‚Äù

comandare FreeSWITCH: uuid_broadcast, uuid_transfer, uuid_kill

√à il ‚Äútelecom control plane‚Äù del tuo agente.

5) Audio: il modo pi√π rapido che funziona (MVP)

Per andare live velocemente, ti consiglio non inseguire subito il full-duplex ‚Äúparlarsi sopra in realtime‚Äù.
La soluzione pi√π veloce e stabile √® turn-based:

Utente parla

Tu catturi 1‚Äì3 secondi (o fino a pausa)

Node ‚Üí Gemini ‚Üí risposta audio

FreeSWITCH riproduce la risposta

Si ripete

Per ‚Äúassistenza‚Äù funziona benissimo, e ti evita settimane di debugging su streaming bidirezionale.

Codec consigliato: PCMU (G.711 Œº-law) 8k, perch√© √® lo standard PSTN.

6) Come riproduci la risposta AI nella chiamata

Il pattern pi√π semplice:

Node genera WAV 8k mono

Node lo mette su disco (o URL interno)

Node invia comando ESL:

uuid_broadcast <uuid> /path/risposta.wav aleg

Questo √® il ‚Äúponte‚Äù pi√π rapido.

7) Come catturi l‚Äôaudio della chiamata

Hai 2 strade MVP:

A) Registrazione a chunk

FreeSWITCH registra a file (rolling)

Node legge file e invia a Gemini

B) Media bug / fork verso Node

Pi√π avanzato (e dipende dal modulo scelto)

Pi√π veloce a regime, pi√π complesso da settare bene

Per partire: A) chunk (meno rogne). Poi evolvi a fork/stream.

8) Roadmap ‚Äúupgrade‚Äù (quando l‚ÄôMVP gira)

Quando tutto funziona:

VAD migliore (inizio/fine parlato)

Streaming pi√π realtime (meno latenza)

Multi-canale (pi√π chiamate contemporanee)

Multi-tenant (se lo rivendi)

Checklist finale (se fai solo assistenza e vuoi andare live)

 Numero fisso VoIP italiano con SIP trunk

 VPS con IP pubblico

 FreeSWITCH installato

 SIP trunk registrato e inbound ok

 ESL abilitato e protetto

 Node ESL controller + generazione TTS

 Playback della risposta nella chiamata

 Fallback a umano/voicemail

Dimmi solo 2 cose e ti faccio la guida ‚Äúoperativa‚Äù con config pronta

Il tuo provider numero VoIP sar√† Messagenet o un altro?

Vuoi che l‚ÄôAI risponda subito oppure dopo ‚ÄúPremi 1 per parlare con l‚Äôassistente‚Äù?

Se mi rispondi, nel prossimo messaggio ti scrivo:

porte esatte + firewall

snippet di config FreeSWITCH (gateway + dialplan)

skeleton Node (ESL + play audio)
senza farti perdere tempo.

ok, cosa deve fare il mio programmatore sul software e cosa devo fare io per il centralino cos√¨ ci smistiamo i compiti


Ottima domanda. Qui si gioca il successo del progetto: separate bene le responsabilit√† e vai veloce senza pestarti i piedi.

Ti do la divisione reale da produzione, non teorica.

üß† TU (INFRA / CENTRALINO / TELEFONIA)

Questa parte √® telecom + infrastruttura. La devi guidare tu o il tuo sysadmin.

1Ô∏è‚É£ Acquistare numero VoIP italiano

Tu fai:

scegli provider (es: Messagenet)

acquisti numero assistenza

ottieni:

SIP server

username

password

codec supportati

Deliverable:
‚úî credenziali SIP
‚úî DID (numero)

2Ô∏è‚É£ Preparare VPS Hostinger

Tu fai:

crei VPS Ubuntu 22.04

assegni IP pubblico

apri firewall:

5060 UDP (SIP)
16384‚Äì32768 UDP (RTP audio)
8021 TCP (Event Socket)
22 TCP (SSH)


Deliverable:
‚úî IP pubblico
‚úî server raggiungibile
‚úî porte aperte

3Ô∏è‚É£ Installare FreeSWITCH

Tu fai:

installi FreeSWITCH

verifichi che:

SIP profile attivo

ESL attivo

Deliverable:
‚úî FreeSWITCH running
‚úî console funzionante

4Ô∏è‚É£ Collegare SIP provider ‚Üí FreeSWITCH

Tu configuri:

gateway SIP

inbound routing

NAT

Deliverable:
‚úî se chiami il numero ‚Üí la chiamata arriva su FreeSWITCH
(anche con solo ‚Äúrisponde e riattacca‚Äù all‚Äôinizio)

5Ô∏è‚É£ Creare ingresso ‚ÄúAI‚Äù

Tu configuri nel dialplan:

context tipo: ai_support

regola:

quando arriva DID X ‚Üí entra in ai_support


Deliverable:
‚úî chiamata arriva nel flusso AI (anche senza AI collegata ancora)

üíª PROGRAMMATORE (NODE + AI + LOGICA)

Questa √® la parte software product.

1Ô∏è‚É£ Controller Event Socket (ESL)

Deve creare un servizio Node che:

si connette a FreeSWITCH su porta 8021

ascolta eventi:

chiamata entrante

answer

hangup

Deliverable:
‚úî Node riceve eventi di chiamata
‚úî vede Caller ID e UUID chiamata

2Ô∏è‚É£ Logica di routing AI

Il dev costruisce:

mapping:

numero chiamante ‚Üí profilo cliente
orario ‚Üí prompt diverso
fallback ‚Üí umano


Deliverable:
‚úî decide quale AI usare
‚úî quale prompt caricare

3Ô∏è‚É£ Gestione audio verso AI

Il dev implementa:

ricezione audio chiamata (file o stream)

invio audio a Gemini Live

ricezione risposta vocale

salvataggio WAV 8k mono

Deliverable:
‚úî funzione:

input audio ‚Üí output audio risposta.wav

4Ô∏è‚É£ Playback verso FreeSWITCH

Il dev invia comandi ESL:

uuid_broadcast UUID risposta.wav aleg


Deliverable:
‚úî la voce AI esce nella chiamata

5Ô∏è‚É£ Gestione stato chiamata

Il dev gestisce:

quando utente parla

quando AI parla

timeout

fine chiamata

error handling

Deliverable:
‚úî chiamata completa end-to-end

6Ô∏è‚É£ Logging e Analytics

Minimo indispensabile:

numero chiamante

durata

esito

trascrizione

errori

Deliverable:
‚úî log per debug e billing futuro

üß© Punto di contatto TRA VOI DUE

Queste cose dovete coordinarle insieme:

Oggetto	Chi decide
Codec audio	TU (FS) + DEV (AI)
Formato WAV	DEV
Porta ESL	TU
IP whitelist	TU
Nome context dialplan	TU
Comandi ESL	DEV
Timeline realistica

Con divisione corretta:

Fase	Tempo
Numero + VPS + FS	1 giorno
SIP trunk funzionante	1 giorno
Node ESL controller base	1 giorno
AI voice loop MVP	1‚Äì2 giorni

üëâ In 3‚Äì4 giorni potete avere AI che risponde al telefono.

Errori comuni da evitare

‚ùå Dev che tocca SIP/NAT
‚ùå Sysadmin che tocca Gemini API
‚ùå Mischiare responsabilit√†
‚ùå Fare streaming full realtime subito (MVP prima)

Se vuoi lavorare in modo ‚Äúprofessionale SaaS‚Äù

Consiglio extra:

TU: crea ambiente telecom stabile

DEV: lavora solo su API AI + logica business