ğŸ“ Message content:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Capisco perfettamente, avere qualcuno che ti guidi e ti dia la strada giusta fa tutta la differenza, specialmente quando hai un obiettivo cosÃ¬ importante per una gara. ğŸ’ª

Senti, facciamo cosÃ¬: se potessimo aiutarti ad arrivare anche solo alla metÃ  del tuo obiettivo â€“ quindi mettere su 5 kg di massa muscolare solida â€“ ci dedicheresti 30 minuti del tuo tempo in una consulenza gratuita per capire insieme come impostare il lavoro? ğŸ˜Š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… [DRY RUN] Simulated plain text message: DRY_RUN_PLAINTEXT_1766448688330_5c2xqc
ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… [STEP 10] WhatsApp message sent: text

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [BOOKING DECISION] Valutazione pre-requisiti per analisi booking
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“‹ PRE-REQUISITI:
   â”œâ”€â”€ bookingEnabled: âœ… SÃŒ
   â”œâ”€â”€ agentHasCalendar: âœ… SÃŒ (Google Calendar connesso)
   â”œâ”€â”€ effectiveUserId: âœ… ASSENTE (Ã¨ un lead)
   â””â”€â”€ Agent: FRT Agent
   ğŸ¯ DECISIONE: âœ… PROCEDERÃ€ con analisi booking
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¾ [APPOINTMENT BOOKING] Retrieved 9 proposed slots from database
   âœ… [ACCUMULATOR] Always proceeding with booking analysis (no pre-check skip)
ğŸ“… [APPOINTMENT BOOKING] Attempting to extract appointment confirmation from lead message
ğŸ“Š [EXTRACTION] Retrieved 10 messages for extraction
ğŸ“… [NEW BOOKING] Using extractBookingDataFromConversation() - aligned with public-share-router.ts
   ğŸ“š Analyzing 10 messages for new booking...
ğŸ” Finding AI provider for client 7cdfb7ae-d06b-40f6-9840-91f72772a390 (consultant: 7cdfb7ae-d06b-40f6-9840-91f72772a390)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Gemini Keys (Google AI Studio)...
âœ… TIER 0: Using SuperAdmin Google AI Studio (Gemini 3)
   ğŸ”‘ Key: 1/1

ğŸ” [BOOKING SERVICE] Extracting data from 10 messages
   Mode: NEW BOOKING
   Timezone: Europe/Rome
   ğŸ“œ [FULL CONVERSATION] Messaggi passati all'AI per estrazione:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
AI: Capisco perfettamente, avere qualcuno che ti guidi e ti dia la strada giusta fa tutta la differenza, specialmente quando hai un obiettivo cosÃ¬ importante per una gara. ğŸ’ª

Senti, facciamo cosÃ¬: se potessimo aiutarti ad arrivare anche solo alla metÃ  del tuo obiettivo â€“ quindi mettere su 5 kg di massa muscolare solida â€“ ci dedicheresti 30 minuti del tuo tempo in una consulenza gratuita per capire insieme come impostare il lavoro? ğŸ˜Š
LEAD: il fatto di non avere un mentore
AI: Un obiettivo ambizioso, ma con il giusto piano di lavoro e recupero si puÃ² fare un gran bel percorso! ğŸ’ª 10 kg di massa muscolare cambierebbero completamente la tua struttura per la gara.

Oltre alla stanchezza che mi dicevi prima, cosa senti che ti sta bloccando davvero dal raggiungere questi 10 kg in piÃ¹ oggi? Qual Ã¨ l'ostacolo piÃ¹ grande che trovi nel quotidiano? ğŸ˜Š
LEAD: almeno 10 kg
AI: Capisco bene, tra il lavoro fisico e la corsa Ã¨ normale sentirsi un po' svuotati se non c'Ã¨ il giusto equilibrio. ğŸ’ª

Immagina di risolvere questo problema delle energie: che risultato concreto vorresti raggiungere per la tua gara? Ad esempio, quanti kg di massa muscolare vorresti aggiungere esattamente per sentirti pronto? ğŸ˜Š
LEAD: si mi mancano le enerrgie e cerco una mano
AI: Lavoro impegnativo quello del falegname, immagino che tu sia sempre in movimento! ğŸ’ª

Tra il lavoro e la corsa, sicuramente consumi tantissime energie. Qual Ã¨ la difficoltÃ  piÃ¹ grande che trovi nel cercare di mettere su massa? Senti che ti mancano le energie, non riesci a essere costante con i pesi o magari Ã¨ difficile gestire l'alimentazione con i tuoi ritmi? ğŸ˜Š
LEAD: faccio il falegname corro giÃ  tanto ma voglio mettere su massa per una gara
AI: Capisco perfettamente, Ã¨ un obiettivo super stimolante! ğŸ’ª Aumentare il tono muscolare Ã¨ proprio la nostra specialitÃ .

Per capire meglio come aiutarti, di cosa ti occupi esattamente nella vita? E qual Ã¨ il problema principale che stai riscontrando oggi nel provare a mettere su massa? ğŸ˜Š
LEAD: volevo capire come mettere su massa muscolare
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“¦ [ACCUMULATOR] Loading existing extraction state...
   ğŸ“¦ [ACCUMULATOR] Loaded existing state: date=null, time=null, phone=null, email=null
   ğŸ§  [AI] Using model: gemini-2.5-flash, thinking: disabled
ğŸ”„ [WHATSAPP POLLING] Starting poll cycle...
ğŸ“Š [WHATSAPP POLLING] Polling 9 consultant(s) sequentially...
âš ï¸ [WHATSAPP POLLING] Skipping consultant 42105c6d-d065-4f4e-b5b2-290742b4dd1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 611b2437-3b3f-4063-ad89-2164943abf1d - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant c2146759-f08a-430a-afdf-701bbc674300 - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - incomplete config
âš ï¸ [WHATSAPP POLLING] Skipping consultant 0c73bbe5-51e1-4108-866b-6be7a52fce3b - incomplete config
ğŸ”– [WATERMARK] Agent Receptionist Principale (fe95f393-b8c9-4fc0-80d7-2035dcba305a) - last processed: 2025-12-22T22:54:28.000Z
12:11:33 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 2â€¦
âœ… [WHATSAPP POLLING] No new messages for agent Receptionist Principale
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-22T22:54:28.000Z) is older than watermark - keeping current
ğŸ”– [WATERMARK] Agent FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6) - last processed: 2025-12-23T00:02:54.000Z
âœ… [WHATSAPP POLLING] No new messages for agent FRT Agent
ğŸ“Œ [WATERMARK] Latest on Twilio (2025-12-23T00:02:54.000Z) is older than watermark - keeping current
ğŸ”– [WATERMARK] Agent Marco setter (760bb513-098f-4722-b02a-a700160c2fc3) - last processed: 2025-12-14T18:11:36.000Z
âœ… [WHATSAPP POLLING] No new messages for agent Marco setter
âœ… [WHATSAPP POLLING] Poll cycle complete
   AI Response length: 849 chars
   AI Response preview: ```json
{
  "isConfirming": false,
  "date": null,
  "time": null,
  "phone": null,
  "email": null,
  "name": null,
  "confidence": "low",
  "hasAllData": false,
  "reasoning": {
    "isConfirming": "L'AI ha proposto una consulenza gratuita (\"ci dedicheresti 30 minuti del tuo tempo in una consulen
   Parsed extraction result (raw): hasAllData=false, date=null, time=null

ğŸ§  [AI REASONING] Spiegazione decisioni AI:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ¯ CONFIRMING: L'AI ha proposto una consulenza gratuita ("ci dedicheresti 30 minuti del tuo tempo in una consulenza gratuita"), ma il lead non ha ancora confermato l'appuntamento, continuando a esprimere le sue difficoltÃ  ("il fatto di non avere un mentore").
   ğŸ“… DATE:  Nessuna data specifica per un appuntamento Ã¨ stata menzionata o concordata dal lead o dall'AI.
   ğŸ• TIME:  Nessun orario specifico per un appuntamento Ã¨ stato menzionato o concordato dal lead o dall'AI.
   ğŸ“ PHONE: Il lead non ha fornito alcun numero di telefono durante la conversazione.
   ğŸ“§ EMAIL: Il lead non ha fornito alcuna email durante la conversazione.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“Š [ACCUMULATOR] Merged result: date=null, time=null, hasAllData=false
   ğŸ’¾ [ACCUMULATOR] Updated state: date=null, time=null

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š [STEP 3] Data Extraction Results
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ Confirmation Status: âŒ NO
ğŸ“… Date:     âŒ MISSING
ğŸ• Time:     âŒ MISSING
ğŸ“ Phone:    âŒ MISSING
ğŸ“§ Email:    âŒ MISSING
ğŸ’¯ Confidence: LOW
âœ”ï¸ Complete Data: âŒ NO - Missing fields
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¬ [FIELD VALIDATION] Validazione dettagliata di ogni campo
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… [DATE VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato una data nella conversazione

ğŸ• [TIME VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un orario nella conversazione

ğŸ“ [PHONE VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un numero di telefono nella conversazione

ğŸ“§ [EMAIL VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un'email nella conversazione

ğŸ“‹ [RIEPILOGO VALIDAZIONE]
   â”œâ”€â”€ Campi presenti: 0/4
   â”œâ”€â”€ Campi mancanti: date, time, phone, email
   â”œâ”€â”€ hasAllData (dal servizio): false
   â””â”€â”€ DECISIONE: âŒ ATTENDI piÃ¹ dati dal lead
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â„¹ï¸ [APPOINTMENT BOOKING] Lead is not confirming appointment yet - continue conversation
âœ”ï¸ [STEP 11] Marking 1 pending messages as processed
âœ… Processed 1 messages for +393519272875

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â±ï¸  PERFORMANCE BREAKDOWN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– Gemini API Call:          1693ms  (13.7%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â° TOTAL TIME:              12348ms
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

12:11:37 AM [express] GET /api/whatsapp/conversations 200 in 507ms :: {"conversations":[{"id":"036159â€¦
12:11:39 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 3â€¦
ğŸ§ª [DRY RUN SIMULATOR] Simulated customer message queued for conversation 036159c0-707c-4e10-b20d-fef4b8099256: "ok..."
ğŸ§ª [DRY RUN SIMULATOR] Pending message ID: 9c0c56fd-e3a6-47c2-afc2-62be785f25b5, twilioSid: simulated-9N7BLMTogCVnhtr5Nvmrn
ğŸ¤– [DRY RUN SIMULATOR] Triggering AI processing for conversation 036159c0-707c-4e10-b20d-fef4b8099256
ğŸ” [SCHEDULE] scheduleMessageProcessing called for +393519272875_7cdfb7ae-d06b-40f6-9840-91f72772a390
âœ… [SCHEDULE] Timer set for +393519272875_7cdfb7ae-d06b-40f6-9840-91f72772a390, will fire in 4000ms
12:11:40 AM [express] POST /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/simulate â€¦
12:11:41 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 3â€¦
12:11:41 AM [express] GET /api/whatsapp/conversations 304 in 409ms :: {"conversations":[{"id":"036159â€¦
12:11:42 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 3â€¦
âš¡ [SCHEDULE] Timer fired for +393519272875_7cdfb7ae-d06b-40f6-9840-91f72772a390, enqueueing...
ğŸ“¥ [ENQUEUE] Adding to queue: +393519272875 for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390
ğŸ“Š [ENQUEUE] Queue size for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390: 1
ğŸš€ [ENQUEUE] Starting queue processing for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390
ğŸ“‹ [PENDING] Found 1 pending messages for conversation 036159c0-707c-4e10-b20d-fef4b8099256 (phone: +393519272875)
â±ï¸ [TIMING] Polling latency: 4.3s (from webhook to processing)
ğŸ” [PENDING] First message twilioSid: simulated-9N7BLMTogCVnhtr5Nvmrn, simulated: true, text: "ok..."
ğŸ” [PARTICIPANT TYPE] unknown
âœ… [CONFIG] Using agent from conversation: FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6)
ğŸ¯ [AGENT TYPE] Agent type: reactive_lead, isProactive: false
âœ… AI is ENABLED and within working hours for consultant 7cdfb7ae-d06b-40f6-9840-91f72772a390 - proceeding with AI response

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”‘ [STEP 3] Selecting AI Provider (Vertex AI / Google AI Studio)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” Conversation ID: 036159c0-707c-4e10-b20d-fef4b8099256
ğŸ‘¤ User Type: LEAD
âœ… [SuperAdmin Gemini] Loaded 1 API keys from config
âœ… Using SuperAdmin Google AI Studio for WhatsApp (Gemini 3)
   ğŸ”‘ Key: 1/1
âœ… Selected AI Provider: studio
   ğŸ” API Key: AIzaSyAzZA...CL20
   ğŸ†” Key ID: superadm...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”‘ [API KEY] Extracted from Google AI Studio provider (key: superadm...)
ğŸ’¾ [STEP 4] Saving 1 inbound message(s) to database
âœ… [STEP 4] Saved inbound message 1fcac50c-4f4b-4b0b-9974-796fa2b387a3: "ok..."
ğŸ’¬ [AUDIO DETECTION] Client sent text message - No audio TTS needed unless always_audio mode
ğŸ“¸ [STEP 5] Building media context (1 messages)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– [STEP 6] Building AI System Prompt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ Participant Type: UNKNOWN
ğŸ’¬ Message: "ok"

ğŸ” Detecting intent for lead message...
âœ… Intent detected: general
â­ï¸ [OBJECTION] Objection detection DISABLED (aligned with public share)
ğŸ‘¤ Fetching/creating lead profile...
âœ… Lead profile: difficult (difficulty: 8.5/10)
ğŸ“… [APPOINTMENT CONTEXT] Checking for existing saved slots...
ğŸ’¾ [APPOINTMENT CONTEXT] Retrieved 9 saved slots from database
ğŸ“… [APPOINTMENT CONTEXT] Context maintained - AI can continue appointment flow
âœ… [APPOINTMENT CONTEXT] Final state: 9 slots available for AI prompt
ğŸ” [PROACTIVE CHECK] conversation.isProactiveLead=false, conversation.proactiveLeadId=null
â„¹ï¸ [PROACTIVE CHECK] This is a REACTIVE lead (isProactiveLead=false)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [TEMPLATE ENGINE] Checking agent instructions...
   agentInstructionsEnabled: true
   agentInstructions length: 14957 chars
   selectedTemplate: receptionist
âœ… [TEMPLATE ENGINE] Using CUSTOM TEMPLATE from database
   Template preview: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ RUOLO: RECEPTIONIST VIRTUALE (INBOUND)
â”â”â”â”â”â”...
âœ… [FEATURE BLOCKS] Conditional injection summary:
   - Knowledge Base: DISABLED (no items)
   - Booking: ENABLED
   - Objection Handling: DISABLED (removed Dec 2025)
   - Disqualification: ENABLED
   - Upselling: DISABLED (no block yet)
ğŸ“¤ [SYSTEM PROMPT] Ready (26287 chars): "ğŸ“… OGGI Ãˆ: martedÃ¬ 23 dicembre 2025  Sei l'assistente di Protocollo 3M. Il cliente Ã¨ un LEAD CALDO c..."
ğŸ“š [STEP 7] Checking for reset request and fetching message history
ğŸ“š [STEP 7] Found 15 historical messages
ğŸ§  [STEP 8] Calling Gemini AI (model selection based on provider)

ğŸ“Š [GEMINI TOKENS] Stima PRIMA della chiamata:
   ğŸ“ System Prompt: ~6,572 tokens (26,287 chars)
   ğŸ’¬ User Message: ~1 tokens (2 chars)
   ğŸ“œ History: ~599 tokens (2,395 chars)
   ğŸ”¢ TOTALE INPUT: ~7,172 tokens

â„¹ï¸ [FILE SEARCH] No FileSearchStore available (no agent or consultant store)
ğŸ”„ [RETRY] Attempt 1/3
   ğŸ§  [AI] Google AI Studio - Using model: gemini-3-flash-preview, thinking: enabled (low)
12:11:47 AM [express] GET /api/whatsapp/conversations 200 in 409ms :: {"conversations":[{"id":"036159â€¦
âœ… [RETRY] Success on attempt 1!
â±ï¸  [TIMING] Gemini API call: 1133ms

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [DEBUG] Analyzing Gemini Response Object
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ Response object keys: [
  'sdkHttpResponse',
  'candidates',
  'modelVersion',
  'responseId',
  'usageMetadata'
]
there are non-text parts thoughtSignature in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.
there are non-text parts thoughtSignature in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.
âœ… response.text is a property - using it...
there are non-text parts thoughtSignature in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.
ğŸ“ Extracted text length: 108
ğŸ“ Extracted text preview: Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.

Ti va meglio mattina o pomeriggio? ğŸ˜Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


ğŸ“Š [WHATSAPP AI] Token Breakdown for agent "FRT Agent":
   â”œâ”€â”€ System Prompt: 6,572 tokens
   â”œâ”€â”€ Conversation History: 747 tokens
   â”œâ”€â”€ User Message: 1 tokens
   â””â”€â”€ TOTAL INPUT: 7,320 tokens
there are non-text parts thoughtSignature in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.
there are non-text parts thoughtSignature in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.

ğŸ“Š [GEMINI TOKENS] Utilizzo DOPO la risposta:
   âœ… Response: ~27 tokens (108 chars)
   ğŸ”¢ TOTALE (input + output): ~7,199 tokens
   â±ï¸  Tempo di risposta: 1134ms
   ğŸ’° Costo stimato: $0.014398 (input + output)

âœ… [STEP 8] Gemini response received: "Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.

Ti va meglio mattina o pomeri..."
ğŸ’¾ [STEP 9] Saving AI response to database
âœ… [STEP 9] AI response saved with ID: 3fbeece5-cc82-4172-b7a5-eb806394dee3 (timing: 1134ms Gemini, 2731ms total)
ğŸ›ï¸ [AUDIO DECISION] Mode: always_text, ClientSentAudio: false â†’ sendAudio=false, sendText=true

ğŸ“ [TTS SKIP] TTS disabled or not needed (ttsEnabled=false, mode=always_text, clientAudio=false)

ğŸ“¤ [STEP 10] Sending WhatsApp message to +393519272875
12:11:47 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 2â€¦
âœ… Using agent from existing conversation: FRT Agent (d0983101-2809-4e4a-b838-d623d05453f6)

ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”’ DRY RUN MODE - Agent: FRT Agent
ğŸ”’ No real messages will be sent (simulated only)
ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“± Using From number: whatsapp:+393505720813 (Agent: FRT Agent)
ğŸ“¤ [DRY RUN] Would send WhatsApp message as plain text
ğŸ“‹ Message Details:
   From: whatsapp:+393505720813
   To: whatsapp:+393519272875
   Text length: 108 chars

ğŸ“ Message content:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.

Ti va meglio mattina o pomeriggio? ğŸ˜Š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… [DRY RUN] Simulated plain text message: DRY_RUN_PLAINTEXT_1766448707959_hl21k
ğŸ”’ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… [STEP 10] WhatsApp message sent: text

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” [BOOKING DECISION] Valutazione pre-requisiti per analisi booking
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“‹ PRE-REQUISITI:
   â”œâ”€â”€ bookingEnabled: âœ… SÃŒ
   â”œâ”€â”€ agentHasCalendar: âœ… SÃŒ (Google Calendar connesso)
   â”œâ”€â”€ effectiveUserId: âœ… ASSENTE (Ã¨ un lead)
   â””â”€â”€ Agent: FRT Agent
   ğŸ¯ DECISIONE: âœ… PROCEDERÃ€ con analisi booking
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¾ [APPOINTMENT BOOKING] Retrieved 9 proposed slots from database
   âœ… [ACCUMULATOR] Always proceeding with booking analysis (no pre-check skip)
ğŸ“… [APPOINTMENT BOOKING] Attempting to extract appointment confirmation from lead message
ğŸ“Š [EXTRACTION] Retrieved 10 messages for extraction
ğŸ“… [NEW BOOKING] Using extractBookingDataFromConversation() - aligned with public-share-router.ts
   ğŸ“š Analyzing 10 messages for new booking...
ğŸ” Finding AI provider for client 7cdfb7ae-d06b-40f6-9840-91f72772a390 (consultant: 7cdfb7ae-d06b-40f6-9840-91f72772a390)...
ğŸ“‹ Client preferred AI provider: vertex_admin
ğŸ” TIER 0: Checking SuperAdmin Gemini Keys (Google AI Studio)...
âœ… TIER 0: Using SuperAdmin Google AI Studio (Gemini 3)
   ğŸ”‘ Key: 1/1

ğŸ” [BOOKING SERVICE] Extracting data from 10 messages
   Mode: NEW BOOKING
   Timezone: Europe/Rome
   ğŸ“œ [FULL CONVERSATION] Messaggi passati all'AI per estrazione:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
AI: Fantastico ğŸ”¥ Ti dico subito, stiamo fissando le prossime consulenze.

Ti va meglio mattina o pomeriggio? ğŸ˜Š
LEAD: ok
AI: Capisco perfettamente, avere qualcuno che ti guidi e ti dia la strada giusta fa tutta la differenza, specialmente quando hai un obiettivo cosÃ¬ importante per una gara. ğŸ’ª

Senti, facciamo cosÃ¬: se potessimo aiutarti ad arrivare anche solo alla metÃ  del tuo obiettivo â€“ quindi mettere su 5 kg di massa muscolare solida â€“ ci dedicheresti 30 minuti del tuo tempo in una consulenza gratuita per capire insieme come impostare il lavoro? ğŸ˜Š
LEAD: il fatto di non avere un mentore
AI: Un obiettivo ambizioso, ma con il giusto piano di lavoro e recupero si puÃ² fare un gran bel percorso! ğŸ’ª 10 kg di massa muscolare cambierebbero completamente la tua struttura per la gara.

Oltre alla stanchezza che mi dicevi prima, cosa senti che ti sta bloccando davvero dal raggiungere questi 10 kg in piÃ¹ oggi? Qual Ã¨ l'ostacolo piÃ¹ grande che trovi nel quotidiano? ğŸ˜Š
LEAD: almeno 10 kg
AI: Capisco bene, tra il lavoro fisico e la corsa Ã¨ normale sentirsi un po' svuotati se non c'Ã¨ il giusto equilibrio. ğŸ’ª

Immagina di risolvere questo problema delle energie: che risultato concreto vorresti raggiungere per la tua gara? Ad esempio, quanti kg di massa muscolare vorresti aggiungere esattamente per sentirti pronto? ğŸ˜Š
LEAD: si mi mancano le enerrgie e cerco una mano
AI: Lavoro impegnativo quello del falegname, immagino che tu sia sempre in movimento! ğŸ’ª

Tra il lavoro e la corsa, sicuramente consumi tantissime energie. Qual Ã¨ la difficoltÃ  piÃ¹ grande che trovi nel cercare di mettere su massa? Senti che ti mancano le energie, non riesci a essere costante con i pesi o magari Ã¨ difficile gestire l'alimentazione con i tuoi ritmi? ğŸ˜Š
LEAD: faccio il falegname corro giÃ  tanto ma voglio mettere su massa per una gara
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“¦ [ACCUMULATOR] Loading existing extraction state...
   ğŸ“¦ [ACCUMULATOR] Loaded existing state: date=null, time=null, phone=null, email=null
   ğŸ§  [AI] Using model: gemini-2.5-flash, thinking: disabled
12:11:52 AM [express] GET /api/whatsapp/conversations 200 in 504ms :: {"conversations":[{"id":"036159â€¦
12:11:53 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 2â€¦
12:11:54 AM [express] POST /api/activity/session/heartbeat 200 in 304ms :: {"success":true,"lastActivâ€¦
12:11:58 AM [express] GET /api/whatsapp/conversations 304 in 508ms :: {"conversations":[{"id":"036159â€¦
   AI Response length: 1142 chars
   AI Response preview: ```json
{
  "isConfirming": false,
  "date": null,
  "time": null,
  "phone": null,
  "email": null,
  "name": null,
  "confidence": "low",
  "hasAllData": false,
  "reasoning": {
    "isConfirming": "Il lead risponde 'ok' alla domanda generica dell'AI 'Ti va meglio mattina o pomeriggio?', ma la con
   Parsed extraction result (raw): hasAllData=false, date=null, time=null

ğŸ§  [AI REASONING] Spiegazione decisioni AI:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ¯ CONFIRMING: Il lead risponde 'ok' alla domanda generica dell'AI 'Ti va meglio mattina o pomeriggio?', ma la conversazione non prosegue con la proposta e la conferma di uno slot specifico per un appuntamento. L'AI successivamente devia su domande di qualificazione ('ci dedicheresti 30 minuti del tuo tempo') e il lead continua a descrivere i suoi obiettivi e difficoltÃ , senza mai confermare una data o un orario. Di conseguenza, nessun appuntamento Ã¨ stato confermato.
   ğŸ“… DATE:  Nessuna data specifica per un appuntamento Ã¨ stata menzionata o confermata dal lead o dall'AI nella conversazione.
   ğŸ• TIME:  Nessun orario specifico per un appuntamento Ã¨ stato menzionato o confermato dal lead o dall'AI nella conversazione.
   ğŸ“ PHONE: Il numero di telefono non Ã¨ stato fornito dal lead in nessun messaggio della conversazione.
   ğŸ“§ EMAIL: L'indirizzo email non Ã¨ stato fornito dal lead in nessun messaggio della conversazione.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ“Š [ACCUMULATOR] Merged result: date=null, time=null, hasAllData=false
12:11:59 AM [express] GET /api/whatsapp/conversations/036159c0-707c-4e10-b20d-fef4b8099256/messages 3â€¦
   ğŸ’¾ [ACCUMULATOR] Updated state: date=null, time=null

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š [STEP 3] Data Extraction Results
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ Confirmation Status: âŒ NO
ğŸ“… Date:     âŒ MISSING
ğŸ• Time:     âŒ MISSING
ğŸ“ Phone:    âŒ MISSING
ğŸ“§ Email:    âŒ MISSING
ğŸ’¯ Confidence: LOW
âœ”ï¸ Complete Data: âŒ NO - Missing fields
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¬ [FIELD VALIDATION] Validazione dettagliata di ogni campo
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… [DATE VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato una data nella conversazione

ğŸ• [TIME VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un orario nella conversazione

ğŸ“ [PHONE VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un numero di telefono nella conversazione

ğŸ“§ [EMAIL VALIDATION]
   â”œâ”€â”€ Valore: null/undefined
   â”œâ”€â”€ Presente: âŒ NO
   â””â”€â”€ MOTIVO MANCANZA: L'AI non ha trovato un'email nella conversazione

ğŸ“‹ [RIEPILOGO VALIDAZIONE]
   â”œâ”€â”€ Campi presenti: 0/4
   â”œâ”€â”€ Campi mancanti: date, time, phone, email
   â”œâ”€â”€ hasAllData (dal servizio): false
   â””â”€â”€ DECISIONE: âŒ ATTENDI piÃ¹ dati dal lead
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â„¹ï¸ [APPOINTMENT BOOKING] Lead is not confirming appointment yet - continue conversation
âœ”ï¸ [STEP 11] Marking 1 pending messages as processed
âœ… Processed 1 messages for +393519272875

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â±ï¸  PERFORMANCE BREAKDOWN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”